# 大模型编码限制与最佳实践

## 1. 基本语法规范

### 1.1 类型使用
- **禁止**将类型作为值使用，如 `'string'`、`'number'`、`'boolean'`、`'Record'` 等
- **正确示例**：`let str: string = "Hello";`
- **错误示例**：`let str = 'string';`

### 1.2 错误处理
- **禁止**在 `Logger.error()` 调用中使用复杂的嵌套三元表达式判断错误类型
- **正确示例**：`Logger.error(TAG, 'Error message', error as Error);`
- **错误示例**：`Logger.error(TAG, 'Error', error instanceof Error ? error : new Error(String(error instanceof Error ? error : new Error(String(error)))));`

### 1.3 空值处理
- **禁止**在需要非空值的地方使用 `null`
- **正确示例**：使用可选链 `obj?.property` 或空值合并 `obj.property ?? defaultValue`
- **错误示例**：`const value = null;`（在不允许空值的上下文中）

## 2. ArkTS 特有限制

### 2.1 API 使用
- **禁止**使用已废弃的 API，如 HarmonyOS SDK 5.1.1 中废弃的旧版网络请求 API
- **正确示例**：使用 `@ohos.net.http` 模块进行网络请求
- **错误示例**：使用已废弃的 `@ohos.request` 模块

### 2.2 权限管理
- **必须**使用最新的权限管理 API `abilityAccessCtrl.createAtManager()`
- **正确示例**：`const atManager = abilityAccessCtrl.createAtManager();`
- **错误示例**：使用旧版的权限管理 API

### 2.3 文件系统操作
- **必须**使用 `@ohos.file.fs` 模块进行文件操作
- **禁止**使用已废弃的 `@ohos.file.fileIO` 模块
- **正确示例**：`fs.writeFileSync(filePath, content);`
- **错误示例**：`fileIO.openSync(filePath, fileIO.OpenMode.READ_WRITE);`

## 3. 设计模式实现

### 3.1 单例模式
- **必须**使用安全的单例实现，避免并发问题
- **正确示例**：
  ```typescript
  class Singleton {
    private static instance: Singleton | null = null;
    
    private constructor() {}
    
    public static getInstance(): Singleton {
      if (!Singleton.instance) {
        Singleton.instance = new Singleton();
      }
      return Singleton.instance;
    }
  }
  ```

### 3.2 异步操作
- **必须**使用 `async/await` 处理异步操作
- **禁止**使用回调地狱
- **正确示例**：
  ```typescript
  async function fetchData() {
    const response = await http.request(url);
    return response.data;
  }
  ```

## 4. 类型安全

### 4.1 接口设计
- **必须**为复杂数据结构定义接口或类型
- **禁止**使用 `any` 类型，除非绝对必要
- **正确示例**：
  ```typescript
  interface User {
    id: string;
    name: string;
    age: number;
  }
  ```

### 4.2 类型断言
- **谨慎**使用类型断言，确保断言的安全性
- **正确示例**：`const user = data as User;`
- **错误示例**：`const user = any(data);`

### 4.3 泛型使用
- **正确**使用泛型，避免类型擦除问题
- **正确示例**：
  ```typescript
  function getData<T>(url: string): Promise<T> {
    // 实现
  }
  ```

## 5. 性能优化

### 5.1 缓存管理
- **必须**实现合理的缓存过期策略
- **正确示例**：设置缓存的最大大小和过期时间
- **错误示例**：无限增长的缓存，不清理过期数据

### 5.2 资源管理
- **必须**正确释放资源，如 HTTP 请求、文件句柄等
- **正确示例**：`httpRequest.destroy();`
- **错误示例**：不关闭资源，导致内存泄漏

## 6. 日志记录

### 6.1 日志级别
- **正确**使用不同级别的日志：`debug`、`info`、`warn`、`error`
- **禁止**在生产环境中使用大量 `debug` 日志

### 6.2 日志内容
- **必须**包含足够的上下文信息，如标签、时间戳等
- **禁止**记录敏感信息，如密码、令牌等

## 7. 代码风格

### 7.1 命名规范
- **必须**使用驼峰命名法
- **类名**：首字母大写，如 `CacheManager`
- **方法和变量名**：首字母小写，如 `getCache()`
- **常量**：全大写，下划线分隔，如 `DEFAULT_EXPIRY`

### 7.2 注释规范
- **必须**为公共 API 添加 JSDoc 注释
- **禁止**不必要的注释，代码应自文档化
- **正确示例**：
  ```typescript
  /**
   * 获取缓存项
   * @param key 缓存键
   * @returns 缓存数据或 null
   */
  public get(key: string): any {
    // 实现
  }
  ```

## 8. 兼容性考虑

### 8.1 SDK 版本
- **必须**确保代码兼容 HarmonyOS SDK 5.1.1
- **正确示例**：使用 SDK 5.1.1 支持的 API
- **错误示例**：使用仅在更高版本 SDK 中可用的 API

### 8.2 设备适配
- **必须**考虑不同设备的性能差异
- **正确示例**：使用 `@State` 管理 UI 状态，避免不必要的重渲染

## 9. 安全规范

### 9.1 网络安全
- **必须**验证网络请求的 URL 和参数
- **禁止**直接使用用户输入构建 SQL 查询或命令

### 9.2 数据安全
- **必须**对敏感数据进行加密存储
- **禁止**明文存储密码等敏感信息

## 10. 测试规范

### 10.1 单元测试
- **必须**为关键功能编写单元测试
- **正确示例**：测试缓存管理的各种场景

### 10.2 集成测试
- **必须**测试组件之间的交互
- **正确示例**：测试网络请求与缓存的集成

## 11. 常见错误模式

### 11.1 过度复杂的表达式
- **禁止**使用多层嵌套的三元表达式
- **正确示例**：使用 if-else 语句或提前返回

### 11.2 重复代码
- **必须**提取重复代码为函数或方法
- **正确示例**：使用工具函数处理重复逻辑

### 11.3 硬编码
- **禁止**硬编码配置值，如 URL、端口等
- **正确示例**：使用配置文件或常量

## 12. 最佳实践

### 12.1 代码组织
- **必须**按功能模块组织代码
- **正确示例**：将网络请求、缓存管理、UI 组件分离到不同的目录

### 12.2 错误处理
- **必须**捕获并处理所有可能的异常
- **正确示例**：使用 try-catch 块处理异步操作

### 12.3 文档
- **必须**为项目提供完整的 README.md 和 API 文档
- **正确示例**：使用 JSDoc 生成 API 文档

通过遵循以上限制和最佳实践，可以避免大部分 ArkTS 编译器错误，提高代码质量和可维护性。