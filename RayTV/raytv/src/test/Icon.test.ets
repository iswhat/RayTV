/**
 * Iconç»„ä»¶å®Œæ•´æµ‹è¯•å¥—ä»¶ | Icon Component Complete Test Suite
 * P0çº§ä¼˜å…ˆçº§ - æ ¸å¿ƒå›¾æ ‡ç»„ä»¶æµ‹è¯•
 */

import { Icon } from '../components/Icon';
import { BaseComponent } from '../components/BaseComponent';

describe('Icon Component Tests', () => {
  let icon: Icon;
  
  beforeEach(() => {
    icon = new Icon({
      name: 'home',
      size: 24,
      color: '#333333'
    });
  });
  
  afterEach(() => {
    icon = null;
  });
  
  // ==================== åŸºç¡€åŠŸèƒ½æµ‹è¯• | Basic Functionality Tests ====================
  
  describe('åŸºç¡€åˆ›å»ºå’Œå±æ€§æµ‹è¯•', () => {
    it('åº”è¯¥æ­£ç¡®åˆ›å»ºIconå®ä¾‹', () => {
      expect(icon).toBeInstanceOf(Icon);
      expect(icon.props.name).toBe('home');
      expect(icon.props.size).toBe(24);
      expect(icon.props.color).toBe('#333333');
    });
    
    it('åº”è¯¥æ­£ç¡®å¤„ç†ä¸åŒçš„å›¾æ ‡åç§°', () => {
      const homeIcon = new Icon({ name: 'home' });
      const searchIcon = new Icon({ name: 'search' });
      const userIcon = new Icon({ name: 'user' });
      
      expect(homeIcon.props.name).toBe('home');
      expect(searchIcon.props.name).toBe('search');
      expect(userIcon.props.name).toBe('user');
    });
    
    it('åº”è¯¥æ­£ç¡®å¤„ç†å›¾æ ‡å¤§å°', () => {
      const smallIcon = new Icon({ name: 'home', size: 16 });
      const mediumIcon = new Icon({ name: 'home', size: 24 });
      const largeIcon = new Icon({ name: 'home', size: 32 });
      
      expect(smallIcon.props.size).toBe(16);
      expect(mediumIcon.props.size).toBe(24);
      expect(largeIcon.props.size).toBe(32);
    });
    
    it('åº”è¯¥æ­£ç¡®å¤„ç†å›¾æ ‡é¢œè‰²', () => {
      const redIcon = new Icon({ name: 'home', color: '#FF0000' });
      const blueIcon = new Icon({ name: 'home', color: '#0000FF' });
      const greenIcon = new Icon({ name: 'home', color: '#00FF00' });
      
      expect(redIcon.props.color).toBe('#FF0000');
      expect(blueIcon.props.color).toBe('#0000FF');
      expect(greenIcon.props.color).toBe('#00FF00');
    });
  });
  
  // ==================== å›¾æ ‡æ¸²æŸ“æµ‹è¯• | Icon Rendering Tests ====================
  
  describe('å›¾æ ‡æ¸²æŸ“æµ‹è¯•', () => {
    it('åº”è¯¥æ­£ç¡®æ¸²æŸ“åŸºç¡€å›¾æ ‡', () => {
      const rendered = icon.render();
      expect(rendered).toBeDefined();
      
      // éªŒè¯æ¸²æŸ“ç»“æœåŒ…å«æ­£ç¡®çš„æ–‡æœ¬
      // expect(rendered.textContent).toContain('ğŸ '); // å¦‚æœä½¿ç”¨emoji
    });
    
    it('åº”è¯¥æ­£ç¡®å¤„ç†ä¸åŒå°ºå¯¸çš„æ¸²æŸ“', () => {
      const sizes = [12, 16, 20, 24, 32, 48];
      
      sizes.forEach(size => {
        const sizedIcon = new Icon({ name: 'home', size: size });
        const rendered = sizedIcon.render();
        expect(rendered).toBeDefined();
      });
    });
    
    it('åº”è¯¥æ­£ç¡®å¤„ç†ä¸åŒé¢œè‰²çš„æ¸²æŸ“', () => {
      const colors = ['#FF0000', '#00FF00', '#0000FF', '#FFFF00', '#FF00FF'];
      
      colors.forEach(color => {
        const coloredIcon = new Icon({ name: 'home', color: color });
        const rendered = coloredIcon.render();
        expect(rendered).toBeDefined();
      });
    });
    
    it('åº”è¯¥æ­£ç¡®å¤„ç†ä¸»é¢˜é€‚é…', () => {
      const lightIcon = new Icon({ 
        name: 'home', 
        theme: 'light' 
      });
      
      const darkIcon = new Icon({ 
        name: 'home', 
        theme: 'dark' 
      });
      
      const renderedLight = lightIcon.render();
      const renderedDark = darkIcon.render();
      
      expect(renderedLight).toBeDefined();
      expect(renderedDark).toBeDefined();
    });
  });
  
  // ==================== å›¾æ ‡æ˜ å°„æµ‹è¯• | Icon Mapping Tests ====================
  
  describe('å›¾æ ‡æ˜ å°„æµ‹è¯•', () => {
    it('åº”è¯¥æ­£ç¡®æ˜ å°„å¸¸ç”¨å›¾æ ‡', () => {
      const iconMappings = {
        'home': 'ğŸ ',
        'search': 'ğŸ”',
        'user': 'ğŸ‘¤',
        'settings': 'âš™ï¸',
        'heart': 'â¤ï¸',
        'star': 'â­',
        'play': 'â–¶ï¸',
        'pause': 'â¸ï¸',
        'close': 'âŒ',
        'check': 'âœ…'
      };
      
      Object.entries(iconMappings).forEach(([name, expectedChar]) => {
        const testIcon = new Icon({ name: name });
        const rendered = testIcon.render();
        expect(rendered).toBeDefined();
        // éªŒè¯å›¾æ ‡å­—ç¬¦æ˜ å°„æ­£ç¡®
      });
    });
    
    it('åº”è¯¥æ­£ç¡®å¤„ç†æœªå®šä¹‰çš„å›¾æ ‡', () => {
      const unknownIcon = new Icon({ name: 'unknown-icon' });
      const rendered = unknownIcon.render();
      expect(rendered).toBeDefined();
      // åº”è¯¥æ˜¾ç¤ºé»˜è®¤æˆ–é—®å·å›¾æ ‡
    });
    
    it('åº”è¯¥æ­£ç¡®å¤„ç†ç©ºå›¾æ ‡åç§°', () => {
      const emptyIcon = new Icon({ name: '' });
      const rendered = emptyIcon.render();
      expect(rendered).toBeDefined();
    });
  });
  
  // ==================== äº¤äº’åŠŸèƒ½æµ‹è¯• | Interactive Functionality Tests ====================
  
  describe('äº¤äº’åŠŸèƒ½æµ‹è¯•', () => {
    it('åº”è¯¥æ­£ç¡®å¤„ç†ç‚¹å‡»äº‹ä»¶', () => {
      let clicked = false;
      const clickableIcon = new Icon({
        name: 'home',
        onClick: () => {
          clicked = true;
        }
      });
      
      clickableIcon.handleClick({} as ClickEvent);
      expect(clicked).toBe(true);
    });
    
    it('åº”è¯¥æ­£ç¡®å¤„ç†hoverçŠ¶æ€', () => {
      const initialState = icon.getState();
      expect(initialState.hovered).toBe(false);
      
      icon.handleMouseEnter({} as MouseEvent);
      const hoverState = icon.getState();
      expect(hoverState.hovered).toBe(true);
      
      icon.handleMouseLeave({} as MouseEvent);
      const finalState = icon.getState();
      expect(finalState.hovered).toBe(false);
    });
    
    it('åº”è¯¥æ­£ç¡®å¤„ç†ç„¦ç‚¹çŠ¶æ€', () => {
      const initialState = icon.getState();
      expect(initialState.focused).toBe(false);
      
      icon.handleFocus({} as FocusEvent);
      const focusState = icon.getState();
      expect(focusState.focused).toBe(true);
      
      icon.handleBlur({} as FocusEvent);
      const finalState = icon.getState();
      expect(finalState.focused).toBe(false);
    });
  });
  
  // ==================== å±æ€§æ›´æ–°æµ‹è¯• | Property Update Tests ====================
  
  describe('å±æ€§æ›´æ–°æµ‹è¯•', () => {
    it('åº”è¯¥æ­£ç¡®æ›´æ–°å›¾æ ‡åç§°', () => {
      expect(icon.props.name).toBe('home');
      
      icon.updateProps({ name: 'search' });
      expect(icon.props.name).toBe('search');
    });
    
    it('åº”è¯¥æ­£ç¡®æ›´æ–°å›¾æ ‡å¤§å°', () => {
      expect(icon.props.size).toBe(24);
      
      icon.updateProps({ size: 32 });
      expect(icon.props.size).toBe(32);
    });
    
    it('åº”è¯¥æ­£ç¡®æ›´æ–°å›¾æ ‡é¢œè‰²', () => {
      expect(icon.props.color).toBe('#333333');
      
      icon.updateProps({ color: '#FF0000' });
      expect(icon.props.color).toBe('#FF0000');
    });
    
    it('åº”è¯¥æ­£ç¡®æ‰¹é‡æ›´æ–°å±æ€§', () => {
      const newProps = {
        name: 'user',
        size: 20,
        color: '#00FF00',
        theme: 'dark' as const
      };
      
      icon.updateProps(newProps);
      
      expect(icon.props.name).toBe('user');
      expect(icon.props.size).toBe(20);
      expect(icon.props.color).toBe('#00FF00');
      expect(icon.props.theme).toBe('dark');
    });
  });
  
  // ==================== å“åº”å¼æµ‹è¯• | Responsive Tests ====================
  
  describe('å“åº”å¼åŠŸèƒ½æµ‹è¯•', () => {
    it('åº”è¯¥æ­£ç¡®å¤„ç†æ–­ç‚¹å˜åŒ–', () => {
      const responsiveIcon = new Icon({
        name: 'home',
        responsive: true,
        breakpoints: {
          xs: { size: 16 },
          md: { size: 24 },
          lg: { size: 32 }
        }
      });
      
      expect(responsiveIcon.props.responsive).toBe(true);
      // éªŒè¯æ–­ç‚¹é…ç½®æ­£ç¡®åº”ç”¨
    });
    
    it('åº”è¯¥æ­£ç¡®åº”ç”¨å“åº”å¼å¤§å°', () => {
      const icon = new Icon({
        name: 'home',
        responsive: true,
        breakpoints: {
          xs: { size: 12 },
          lg: { size: 28 }
        }
      });
      
      // éªŒè¯å“åº”å¼å¤§å°è®¡ç®—
      expect(icon.props.responsive).toBe(true);
    });
  });
  
  // ==================== è¾¹ç•Œæ¡ä»¶æµ‹è¯• | Boundary Condition Tests ====================
  
  describe('è¾¹ç•Œæ¡ä»¶æµ‹è¯•', () => {
    it('åº”è¯¥æ­£ç¡®å¤„ç†æå°å›¾æ ‡å°ºå¯¸', () => {
      const tinyIcon = new Icon({ name: 'home', size: 1 });
      expect(tinyIcon.props.size).toBe(1);
      
      const rendered = tinyIcon.render();
      expect(rendered).toBeDefined();
    });
    
    it('åº”è¯¥æ­£ç¡®å¤„ç†æå¤§å›¾æ ‡å°ºå¯¸', () => {
      const hugeIcon = new Icon({ name: 'home', size: 1000 });
      expect(hugeIcon.props.size).toBe(1000);
      
      const rendered = hugeIcon.render();
      expect(rendered).toBeDefined();
    });
    
    it('åº”è¯¥æ­£ç¡®å¤„ç†æ— æ•ˆé¢œè‰²å€¼', () => {
      const invalidColorIcon = new Icon({ 
        name: 'home', 
        color: 'invalid-color' 
      });
      expect(invalidColorIcon.props.color).toBe('invalid-color');
      
      const rendered = invalidColorIcon.render();
      expect(rendered).toBeDefined();
    });
    
    it('åº”è¯¥æ­£ç¡®å¤„ç†ç©ºå­—ç¬¦ä¸²é¢œè‰²', () => {
      const emptyColorIcon = new Icon({ 
        name: 'home', 
        color: '' 
      });
      expect(emptyColorIcon.props.color).toBe('');
    });
  });
  
  // ==================== æ€§èƒ½æµ‹è¯• | Performance Tests ====================
  
  describe('æ€§èƒ½æµ‹è¯•', () => {
    it('åº”è¯¥åœ¨åˆç†æ—¶é—´å†…åˆ›å»ºå®ä¾‹', () => {
      const startTime = performance.now();
      
      for (let i = 0; i < 1000; i++) {
        new Icon({ name: `icon-${i}`, size: 24 });
      }
      
      const endTime = performance.now();
      const duration = endTime - startTime;
      
      expect(duration).toBeLessThan(100); // 100mså†…å®Œæˆ1000æ¬¡åˆ›å»º
    });
    
    it('åº”è¯¥åœ¨åˆç†æ—¶é—´å†…æ›´æ–°å±æ€§', () => {
      const startTime = performance.now();
      
      for (let i = 0; i < 1000; i++) {
        icon.updateProps({ 
          name: `updated-${i}`, 
          size: 16 + (i % 20),
          color: `#${Math.floor(Math.random()*16777215).toString(16)}`
        });
      }
      
      const endTime = performance.now();
      const duration = endTime - startTime;
      
      expect(duration).toBeLessThan(50); // 50mså†…å®Œæˆ1000æ¬¡æ›´æ–°
    });
    
    it('åº”è¯¥åœ¨åˆç†æ—¶é—´å†…å¤„ç†æ¸²æŸ“', () => {
      const icons = [];
      for (let i = 0; i < 100; i++) {
        icons.push(new Icon({ name: `render-test-${i}`, size: 24 }));
      }
      
      const startTime = performance.now();
      
      icons.forEach(icon => {
        icon.render();
      });
      
      const endTime = performance.now();
      const duration = endTime - startTime;
      
      expect(duration).toBeLessThan(100); // 100mså†…å®Œæˆ100æ¬¡æ¸²æŸ“
    });
  });
  
  // ==================== é›†æˆæµ‹è¯• | Integration Tests ====================
  
  describe('é›†æˆæµ‹è¯•', () => {
    it('åº”è¯¥èƒ½å¤Ÿä¸å…¶ä»–ç»„ä»¶æ­£ç¡®é›†æˆ', () => {
      // åˆ›å»ºåŒ…å«å›¾æ ‡çš„å¤åˆç»„ä»¶
      class IconButton extends BaseComponent {
        private icon: Icon;
        private label: string;
        
        constructor(label: string, iconName: string) {
          super({});
          this.label = label;
          this.icon = new Icon({ name: iconName, size: 20 });
        }
        
        public render() {
          return Row() {
            this.icon.render()
            Text(this.label)
              .fontSize(14)
              .marginLeft(8)
          }
          .padding(12)
          .backgroundColor('#F0F0F0')
          .borderRadius(6);
        }
      }
      
      const iconButton = new IconButton('Home', 'home');
      const rendered = iconButton.render();
      expect(rendered).toBeDefined();
    });
    
    it('åº”è¯¥æ­£ç¡®å¤„ç†å›¾æ ‡åŠ¨ç”»', () => {
      const animatedIcon = new Icon({
        name: 'heart',
        animated: true,
        animation: {
          duration: 300,
          easing: 'easeInOut'
        }
      });
      
      const rendered = animatedIcon.render();
      expect(rendered).toBeDefined();
      expect(animatedIcon.props.animated).toBe(true);
    });
  });
});

// ==================== é”™è¯¯å¤„ç†æµ‹è¯• | Error Handling Tests ====================

describe('Iconé”™è¯¯å¤„ç†æµ‹è¯•', () => {
  it('åº”è¯¥ä¼˜é›…å¤„ç†æ¸²æŸ“å¼‚å¸¸', () => {
    // åˆ›å»ºä¼šæŠ›å‡ºå¼‚å¸¸çš„å›¾æ ‡
    class FaultyIcon extends Icon {
      public render() {
        throw new Error('Icon rendering failed');
      }
    }
    
    const faultyIcon = new FaultyIcon({ name: 'home' });
    
    expect(() => faultyIcon.render()).toThrow('Icon rendering failed');
  });
  
  it('åº”è¯¥æ­£ç¡®å¤„ç†æ— æ•ˆçš„å›¾æ ‡æ˜ å°„', () => {
    // æµ‹è¯•æ˜ å°„å‡½æ•°çš„å¥å£®æ€§
    const icon = new Icon({ name: 'home' });
    
    // å³ä½¿ä¼ å…¥æ— æ•ˆå‚æ•°ä¹Ÿåº”è¯¥ä¸ä¼šå´©æºƒ
    expect(() => icon.render()).not.toThrow();
  });
});

// ==================== å…¼å®¹æ€§æµ‹è¯• | Compatibility Tests ====================

describe('Iconå…¼å®¹æ€§æµ‹è¯•', () => {
  it('åº”è¯¥å‘åå…¼å®¹æ—§ç‰ˆæœ¬å±æ€§', () => {
    // æµ‹è¯•æ—§ç‰ˆæœ¬å¯èƒ½ä½¿ç”¨çš„å±æ€§
    const legacyIcon = new Icon({
      iconName: 'home', // æ—§å±æ€§å
      iconSize: 24,     // æ—§å±æ€§å
      iconColor: '#333333' // æ—§å±æ€§å
    } as any);
    
    expect(legacyIcon).toBeDefined();
  });
  
  it('åº”è¯¥æ­£ç¡®å¤„ç†ä¸åŒArkTSç‰ˆæœ¬å·®å¼‚', () => {
    // æµ‹è¯•åœ¨ä¸åŒç‰ˆæœ¬ä¸‹çš„è¡Œä¸ºä¸€è‡´æ€§
    const iconV1 = new Icon({ name: 'home' });
    const iconV2 = new Icon({ name: 'home' });
    
    // è¡Œä¸ºåº”è¯¥ä¸€è‡´
    const rendered1 = iconV1.render();
    const rendered2 = iconV2.render();
    
    expect(rendered1).toBeDefined();
    expect(rendered2).toBeDefined();
  });
});