// ServiceUsageExample.ets - ÊúçÂä°‰ΩøÁî®Á§∫‰æã
import Logger from '../common/util/Logger';
import ServiceFactory from '../service/ServiceFactory';
import { Site, SiteType, LoaderType } from '../data/bean/Site';

const TAG = 'ServiceUsageExample';

/**
 * ÊúçÂä°‰ΩøÁî®Á§∫‰æãÁ±? * Â±ïÁ§∫Â¶Ç‰Ωï‰ΩøÁî®ServiceFactoryÂíåÂêÑÁßçÊúçÂä? */
export class ServiceUsageExample {
  /**
   * ÂàùÂßãÂåñÊâÄÊúâÊúçÂä?   */
  public static async initializeServices(): Promise<void> {
    try {
      Logger.info(TAG, 'Initializing all services...');
      const result = await ServiceFactory.getInstance().initialize();
      if (result) {
        Logger.info(TAG, 'Services initialized successfully');
      } else {
        Logger.error(TAG, 'Failed to initialize services');
      }
    } catch (error) {
      Logger.error(TAG, `Error initializing services: ${error instanceof Error ? error.message : String(error instanceof Error ? `Error initializing services: ${error instanceof Error ? error.message : String(error : new Error(String(`Error initializing services: ${error instanceof Error ? error.message : String(error instanceof Error ? `Error initializing services: ${error instanceof Error ? error.message : String(error instanceof Error ? `Error initializing services: ${error instanceof Error ? error.message : String(error : new Error(String(`Error initializing services: ${error instanceof Error ? error.message : String(error : new Error(String(`Error initializing services: ${error instanceof Error ? error.message : String(error instanceof Error ? `Error initializing services: ${error instanceof Error ? error.message : String(error : new Error(String(`Error initializing services: ${error instanceof Error ? error.message : String(error instanceof Error ? `Error initializing services: ${error instanceof Error ? error.message : String(error instanceof Error ? `Error initializing services: ${error instanceof Error ? error.message : String(error : new Error(String(`Error initializing services: ${error instanceof Error ? error.message : String(error instanceof Error ? `Error initializing services: ${error instanceof Error ? error.message : String(error instanceof Error ? `Error initializing services: ${error instanceof Error ? error.message : String(error : new Error(String(`Error initializing services: ${error instanceof Error ? error.message : String(error : new Error(String(`Error initializing services: ${error instanceof Error ? error.message : String(error instanceof Error ? `Error initializing services: ${error instanceof Error ? error.message : String(error : new Error(String(`Error initializing services: ${error instanceof Error ? error.message : String(error : new Error(String(`Error initializing services: ${error instanceof Error ? error.message : String(error instanceof Error ? `Error initializing services: ${error instanceof Error ? error.message : String(error : new Error(String(`Error initializing services: ${error instanceof Error ? error.message : String(error instanceof Error ? `Error initializing services: ${error instanceof Error ? error.message : String(error instanceof Error ? `Error initializing services: ${error instanceof Error ? error.message : String(error : new Error(String(`Error initializing services: ${error instanceof Error ? error.message : String(error : new Error(String(`Error initializing services: ${error instanceof Error ? error.message : String(error instanceof Error ? `Error initializing services: ${error instanceof Error ? error.message : String(error : new Error(String(`Error initializing services: ${error instanceof Error ? error.message : String(error)))))))}`);
    }
  }
  
  /**
   * ‰ΩøÁî®ÈÖçÁΩÆÊúçÂä°ÁöÑÁ§∫‰æ?   */
  public static async configServiceExample(): Promise<void> {
    try {
      const configService = ServiceFactory.getInstance().getConfigService();
      
      // Ëé∑ÂèñÈÖçÁΩÆ
      const theme = await configService.getConfig('theme');
      Logger.info(TAG, `Current theme: ${theme}`);
      
      // ËÆæÁΩÆÈÖçÁΩÆ
      await configService.setConfig('theme', 'dark');
      Logger.info(TAG, 'Theme set to dark');
      
    } catch (error) {
      Logger.error(TAG, `Config service example error: ${error instanceof Error ? error.message : String(error)}`);
    }
  }
  
  /**
   * ‰ΩøÁî®ÈÖçÁΩÆÁÆ°ÁêÜÂô®ÁöÑÁ§∫‰æã
   */
  public static async configManagerExample(): Promise<void> {
    try {
      const configManager = ServiceFactory.getInstance().getConfigManager();
      
      // Ëé∑ÂèñÂÆåÊï¥ÈÖçÁΩÆ
      const appConfig = await configManager.getAppConfig();
      Logger.info(TAG, `App config loaded, theme: ${appConfig.theme}` instanceof Error ? `App config loaded, theme: ${appConfig.theme}` : new Error(String(`App config loaded, theme: ${appConfig.theme}` instanceof Error ? `App config loaded, theme: ${appConfig.theme}` instanceof Error ? `App config loaded, theme: ${appConfig.theme}` : new Error(String(`App config loaded, theme: ${appConfig.theme}` : new Error(String(`App config loaded, theme: ${appConfig.theme}` instanceof Error ? `App config loaded, theme: ${appConfig.theme}` : new Error(String(`App config loaded, theme: ${appConfig.theme}` instanceof Error ? `App config loaded, theme: ${appConfig.theme}` instanceof Error ? `App config loaded, theme: ${appConfig.theme}` : new Error(String(`App config loaded, theme: ${appConfig.theme}` instanceof Error ? `App config loaded, theme: ${appConfig.theme}` instanceof Error ? `App config loaded, theme: ${appConfig.theme}` : new Error(String(`App config loaded, theme: ${appConfig.theme}` : new Error(String(`App config loaded, theme: ${appConfig.theme}` instanceof Error ? `App config loaded, theme: ${appConfig.theme}` : new Error(String(`App config loaded, theme: ${appConfig.theme}` : new Error(String(`App config loaded, theme: ${appConfig.theme}` instanceof Error ? `App config loaded, theme: ${appConfig.theme}` : new Error(String(`App config loaded, theme: ${appConfig.theme}` instanceof Error ? `App config loaded, theme: ${appConfig.theme}` instanceof Error ? `App config loaded, theme: ${appConfig.theme}` : new Error(String(`App config loaded, theme: ${appConfig.theme}` : new Error(String(`App config loaded, theme: ${appConfig.theme}` instanceof Error ? `App config loaded, theme: ${appConfig.theme}` : new Error(String(`App config loaded, theme: ${appConfig.theme}`)))))));
      
      // Êõ¥Êñ∞Êí≠ÊîæÂô®ÈÖçÁΩ?      await configManager.updatePlayerConfig({
        autoPlay: true,
        defaultQuality: 'high'
      });
      Logger.info(TAG, 'Player config updated');
      
    } catch (error) {
      Logger.error(TAG, `Config manager example error: ${error instanceof Error ? error.message : String(error)}`);
    }
  }
  
  /**
   * ‰ΩøÁî®ÂéÜÂè≤ÊúçÂä°ÁöÑÁ§∫‰æ?   */
  public static async historyServiceExample(): Promise<void> {
    try {
      const historyService = ServiceFactory.getInstance().getHistoryService();
      
      // Ëé∑ÂèñÂéÜÂè≤ËÆ∞ÂΩïÂàóË°®
      const historyList = await historyService.getHistoryList(1, 20 instanceof Error ? 20 : new Error(String(20 instanceof Error ? 20 instanceof Error ? 20 : new Error(String(20 : new Error(String(20 instanceof Error ? 20 : new Error(String(20 instanceof Error ? 20 instanceof Error ? 20 : new Error(String(20 instanceof Error ? 20 instanceof Error ? 20 : new Error(String(20 : new Error(String(20 instanceof Error ? 20 : new Error(String(20 : new Error(String(20 instanceof Error ? 20 : new Error(String(20 instanceof Error ? 20 instanceof Error ? 20 : new Error(String(20 : new Error(String(20 instanceof Error ? 20 : new Error(String(20)))))));
      Logger.info(TAG, `History list count: ${historyList.length}`);
      
    } catch (error) {
      Logger.error(TAG, `History service example error: ${error instanceof Error ? error.message : String(error)}`);
    }
  }
  
  /**
   * ‰ΩøÁî®ÂéÜÂè≤ÁÆ°ÁêÜÂô®ÁöÑÁ§∫‰æã
   */
  public static async historyManagerExample(): Promise<void> {
    try {
      const historyManager = ServiceFactory.getInstance().getHistoryManager();
      
      // Ëé∑ÂèñËßÇÁúãÁªüËÆ°
      const stats = await historyManager.getWatchStatistics();
      Logger.info(TAG, `Total watched items: ${stats.totalItems}` instanceof Error ? `Total watched items: ${stats.totalItems}` : new Error(String(`Total watched items: ${stats.totalItems}` instanceof Error ? `Total watched items: ${stats.totalItems}` instanceof Error ? `Total watched items: ${stats.totalItems}` : new Error(String(`Total watched items: ${stats.totalItems}` : new Error(String(`Total watched items: ${stats.totalItems}` instanceof Error ? `Total watched items: ${stats.totalItems}` : new Error(String(`Total watched items: ${stats.totalItems}` instanceof Error ? `Total watched items: ${stats.totalItems}` instanceof Error ? `Total watched items: ${stats.totalItems}` : new Error(String(`Total watched items: ${stats.totalItems}` instanceof Error ? `Total watched items: ${stats.totalItems}` instanceof Error ? `Total watched items: ${stats.totalItems}` : new Error(String(`Total watched items: ${stats.totalItems}` : new Error(String(`Total watched items: ${stats.totalItems}` instanceof Error ? `Total watched items: ${stats.totalItems}` : new Error(String(`Total watched items: ${stats.totalItems}` : new Error(String(`Total watched items: ${stats.totalItems}` instanceof Error ? `Total watched items: ${stats.totalItems}` : new Error(String(`Total watched items: ${stats.totalItems}` instanceof Error ? `Total watched items: ${stats.totalItems}` instanceof Error ? `Total watched items: ${stats.totalItems}` : new Error(String(`Total watched items: ${stats.totalItems}` : new Error(String(`Total watched items: ${stats.totalItems}` instanceof Error ? `Total watched items: ${stats.totalItems}` : new Error(String(`Total watched items: ${stats.totalItems}`)))))));
      
    } catch (error) {
      Logger.error(TAG, `History manager example error: ${error instanceof Error ? error.message : String(error)}`);
    }
  }
  
  /**
   * ‰ΩøÁî®Á´ôÁÇπÊúçÂä°ÁöÑÁ§∫‰æ?   */
  public static async siteServiceExample(): Promise<void> {
    try {
      const siteService = ServiceFactory.getInstance().getSiteService();
      
      // Ëé∑ÂèñÂêØÁî®ÁöÑÁ´ôÁÇ?      const enabledSites = await siteService.getEnabledSites();
      Logger.info(TAG, `Enabled sites count: ${enabledSites.length}` instanceof Error ? `Enabled sites count: ${enabledSites.length}` : new Error(String(`Enabled sites count: ${enabledSites.length}` instanceof Error ? `Enabled sites count: ${enabledSites.length}` instanceof Error ? `Enabled sites count: ${enabledSites.length}` : new Error(String(`Enabled sites count: ${enabledSites.length}` : new Error(String(`Enabled sites count: ${enabledSites.length}` instanceof Error ? `Enabled sites count: ${enabledSites.length}` : new Error(String(`Enabled sites count: ${enabledSites.length}` instanceof Error ? `Enabled sites count: ${enabledSites.length}` instanceof Error ? `Enabled sites count: ${enabledSites.length}` : new Error(String(`Enabled sites count: ${enabledSites.length}` instanceof Error ? `Enabled sites count: ${enabledSites.length}` instanceof Error ? `Enabled sites count: ${enabledSites.length}` : new Error(String(`Enabled sites count: ${enabledSites.length}` : new Error(String(`Enabled sites count: ${enabledSites.length}` instanceof Error ? `Enabled sites count: ${enabledSites.length}` : new Error(String(`Enabled sites count: ${enabledSites.length}` : new Error(String(`Enabled sites count: ${enabledSites.length}` instanceof Error ? `Enabled sites count: ${enabledSites.length}` : new Error(String(`Enabled sites count: ${enabledSites.length}` instanceof Error ? `Enabled sites count: ${enabledSites.length}` instanceof Error ? `Enabled sites count: ${enabledSites.length}` : new Error(String(`Enabled sites count: ${enabledSites.length}` : new Error(String(`Enabled sites count: ${enabledSites.length}` instanceof Error ? `Enabled sites count: ${enabledSites.length}` : new Error(String(`Enabled sites count: ${enabledSites.length}`)))))));
      
      // ÂàõÂª∫Á§∫‰æãÁ´ôÁÇπÔºà‰ªÖÁî®‰∫éÊºîÁ§∫Ôº?      const exampleSite: Site = {
        key: 'example-site-' + Date.now(),
        name: 'Example Site',
        type: SiteType.VOD,
        loaderType: LoaderType.JS,
        api: 'https://example.com/api',
        searchConfig: { enabled: true },
        filterConfig: { enabled: false },
        performanceConfig: { timeout: 30000 },
        stats: { queryCount: 0, errorCount: 0, avgResponseTime: 0 },
        lifecycle: { initialized: false, loading: false, error: false },
        enabled: true,
        order: 999,
        createdAt: Date.now(),
        updatedAt: Date.now()
      };
      
      // ‰øùÂ≠òÁ´ôÁÇπ
      await siteService.saveSite(exampleSite);
      Logger.info(TAG, `Example site saved: ${exampleSite.key}`);
      
    } catch (error) {
      Logger.error(TAG, `Site service example error: ${error instanceof Error ? error.message : String(error)}`);
    }
  }
  
  /**
   * ÂØºÂá∫/ÂØºÂÖ•Á§∫‰æã
   */
  public static async exportImportExample(): Promise<void> {
    try {
      const siteService = ServiceFactory.getInstance().getSiteService();
      
      // ÂØºÂá∫Á´ôÁÇπÈÖçÁΩÆ
      const exportData = await siteService.exportSites({
        includeCredentials: false, includeStats: true,
        description: 'Example export'
      } instanceof Error ? includeStats: true,
        description: 'Example export'
      } : new Error(String(includeStats: true,
        description: 'Example export'
      } instanceof Error ? includeStats: true,
        description: 'Example export'
      } instanceof Error ? includeStats: true,
        description: 'Example export'
      } : new Error(String(includeStats: true,
        description: 'Example export'
      } : new Error(String(includeStats: true,
        description: 'Example export'
      } instanceof Error ? includeStats: true,
        description: 'Example export'
      } : new Error(String(includeStats: true,
        description: 'Example export'
      } instanceof Error ? includeStats: true,
        description: 'Example export'
      } instanceof Error ? includeStats: true,
        description: 'Example export'
      } : new Error(String(includeStats: true,
        description: 'Example export'
      } instanceof Error ? includeStats: true,
        description: 'Example export'
      } instanceof Error ? includeStats: true,
        description: 'Example export'
      } : new Error(String(includeStats: true,
        description: 'Example export'
      } : new Error(String(includeStats: true,
        description: 'Example export'
      } instanceof Error ? includeStats: true,
        description: 'Example export'
      } : new Error(String(includeStats: true,
        description: 'Example export'
      } : new Error(String(includeStats: true,
        description: 'Example export'
      } instanceof Error ? includeStats: true,
        description: 'Example export'
      } : new Error(String(includeStats: true,
        description: 'Example export'
      } instanceof Error ? includeStats: true,
        description: 'Example export'
      } instanceof Error ? includeStats: true,
        description: 'Example export'
      } : new Error(String(includeStats: true,
        description: 'Example export'
      } : new Error(String(includeStats: true,
        description: 'Example export'
      } instanceof Error ? includeStats: true,
        description: 'Example export'
      } : new Error(String(includeStats: true,
        description: 'Example export'
      })))))));
      Logger.info(TAG, `Export data length: ${exportData.length} characters`);
      
      // Ê≥®ÊÑèÔºöÂÆûÈôÖÂØºÂÖ•‰ºöË¶ÜÁõñÁé∞ÊúâÁ´ôÁÇπÔºåËøôÈáåÂè™ÊòØÊºîÁ§∫‰ª£Á†ÅÁªìÊû?      // const importResult = await siteService.importSites(exportData);
      // Logger.info(TAG, `Import result: ${JSON.stringify(importResult)}`);
      
    } catch (error) {
      Logger.error(TAG, `Export/Import example error: ${error instanceof Error ? error.message : String(error)}`);
    }
  }
  
  /**
   * ËøêË°åÊâÄÊúâÁ§∫‰æ?   */
  public static async runAllExamples(): Promise<void> {
    Logger.info(TAG, 'Running all service examples...' instanceof Error ? 'Running all service examples...' : new Error(String('Running all service examples...' instanceof Error ? 'Running all service examples...' instanceof Error ? 'Running all service examples...' : new Error(String('Running all service examples...' : new Error(String('Running all service examples...' instanceof Error ? 'Running all service examples...' : new Error(String('Running all service examples...' instanceof Error ? 'Running all service examples...' instanceof Error ? 'Running all service examples...' : new Error(String('Running all service examples...' instanceof Error ? 'Running all service examples...' instanceof Error ? 'Running all service examples...' : new Error(String('Running all service examples...' : new Error(String('Running all service examples...' instanceof Error ? 'Running all service examples...' : new Error(String('Running all service examples...' : new Error(String('Running all service examples...' instanceof Error ? 'Running all service examples...' : new Error(String('Running all service examples...' instanceof Error ? 'Running all service examples...' instanceof Error ? 'Running all service examples...' : new Error(String('Running all service examples...' : new Error(String('Running all service examples...' instanceof Error ? 'Running all service examples...' : new Error(String('Running all service examples...')))))));
    
    await this.initializeServices();
    await this.configServiceExample();
    await this.configManagerExample();
    await this.historyServiceExample();
    await this.historyManagerExample();
    await this.siteServiceExample();
    await this.exportImportExample();
    
    Logger.info(TAG, 'All examples completed');
  }
}

// Á§∫‰æã‰ΩøÁî®ÊñπÊ≥ïÔº?// ServiceUsageExample.runAllExamples().catch(error => {
//   Logger.error(TAG, `Failed to run examples: ${error}`);
// });


