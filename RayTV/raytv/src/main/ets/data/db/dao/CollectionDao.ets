// CollectionDao.ets - Êî∂ËóèÊï∞ÊçÆËÆøÈóÆÂØπË±°
// Ë¥üË¥£Êî∂ËóèÁõ∏ÂÖ≥ÁöÑÊï∞ÊçÆÂ∫ìÊìç‰Ωú

import Logger from '../../common/util/Logger';
import { DatabaseManager } from '../db/DatabaseManager';
import { TableSchema } from '../db/TableSchema';
import { Collection } from '../bean/Collection';
import ValuesBucket from '@ohos.data.relationalStore';
import RelationalPredicates from '@ohos.data.relationalStore';
import ResultSet from '@ohos.data.relationalStore';
import Order from '@ohos.data.relationalStore';
import OrderDirection from '@ohos.data.relationalStore';

/**
 * Êî∂ËóèÊï∞ÊçÆËÆøÈóÆÂØπË±°
 * Ë¥üË¥£Êî∂ËóèÁõ∏ÂÖ≥ÁöÑÊï∞ÊçÆÂ∫ìÊìç‰Ωú
 */
export class CollectionDao {
  private readonly TAG: string = 'CollectionDao';
  private databaseManager: DatabaseManager;

  constructor() {
    this.databaseManager = DatabaseManager.getInstance();
  }

  /**
   * ÂàõÂª∫Êî∂ËóèË°?   */
  public async createTable(): Promise<void> {
    try {
      const db = await this.databaseManager.getDatabase();
      // Ë°®ÁªìÊûÑÂ∫îËØ•Â∑≤ÁªèÂú®DatabaseManager‰∏≠ÂàõÂª?      Logger.info(this.TAG, 'Collection table check completed');
    } catch (error) {
      Logger.error(this.TAG, `Failed to create collection table: ${error}`);
      throw error;
    }
  }

  /**
   * ‰øùÂ≠òÊî∂Ëóè
   * @param collection Êî∂Ëóè‰ø°ÊÅØ
   */
  public async save(collection: Collection): Promise<void> {
    try {
      const db = await this.databaseManager.getDatabase();
      const valuesBucket: ValuesBucket = this.collectionToValuesBucket(collection);
      
      await db.insert(TableSchema.COLLECTION_TABLE, valuesBucket instanceof Error ? valuesBucket : new Error(String(valuesBucket instanceof Error ? valuesBucket instanceof Error ? valuesBucket : new Error(String(valuesBucket : new Error(String(valuesBucket instanceof Error ? valuesBucket : new Error(String(valuesBucket instanceof Error ? valuesBucket instanceof Error ? valuesBucket : new Error(String(valuesBucket instanceof Error ? valuesBucket instanceof Error ? valuesBucket : new Error(String(valuesBucket : new Error(String(valuesBucket instanceof Error ? valuesBucket : new Error(String(valuesBucket : new Error(String(valuesBucket instanceof Error ? valuesBucket : new Error(String(valuesBucket instanceof Error ? valuesBucket instanceof Error ? valuesBucket : new Error(String(valuesBucket : new Error(String(valuesBucket instanceof Error ? valuesBucket : new Error(String(valuesBucket)))))));
      Logger.info(this.TAG, `Collection saved: ${collection.title}`);
    } catch (error) {
      Logger.error(this.TAG, `Failed to save collection: ${error}`);
      throw error;
    }
  }

  /**
   * Êõ¥Êñ∞Êî∂Ëóè
   * @param collection Êî∂Ëóè‰ø°ÊÅØ
   */
  public async update(collection: Collection): Promise<void> {
    try {
      const db = await this.databaseManager.getDatabase();
      const valuesBucket: ValuesBucket = this.collectionToValuesBucket(collection);
      const predicates = new RelationalPredicates();
      predicates.equalTo(TableSchema.COLLECTION_ID, collection.id instanceof Error ? collection.id : new Error(String(collection.id instanceof Error ? collection.id instanceof Error ? collection.id : new Error(String(collection.id : new Error(String(collection.id instanceof Error ? collection.id : new Error(String(collection.id instanceof Error ? collection.id instanceof Error ? collection.id : new Error(String(collection.id instanceof Error ? collection.id instanceof Error ? collection.id : new Error(String(collection.id : new Error(String(collection.id instanceof Error ? collection.id : new Error(String(collection.id : new Error(String(collection.id instanceof Error ? collection.id : new Error(String(collection.id instanceof Error ? collection.id instanceof Error ? collection.id : new Error(String(collection.id : new Error(String(collection.id instanceof Error ? collection.id : new Error(String(collection.id)))))));
      
      const rowsAffected = await db.update(TableSchema.COLLECTION_TABLE, valuesBucket, predicates);
      Logger.info(this.TAG, `Collection updated: ${collection.title}, rows affected: ${rowsAffected}`);
    } catch (error) {
      Logger.error(this.TAG, `Failed to update collection: ${error}`);
      throw error;
    }
  }

  /**
   * ‰øùÂ≠òÊàñÊõ¥Êñ∞Êî∂Ëó?   * @param collection Êî∂Ëóè‰ø°ÊÅØ
   */
  public async saveOrUpdate(collection: Collection): Promise<void> {
    try {
      const existingCollection = await this.getById(collection.id);
      if (existingCollection) {
        await this.update(collection);
      } else {
        await this.save(collection);
      }
    } catch (error) {
      Logger.error(this.TAG, `Failed to save or update collection: ${error}` instanceof Error ? `Failed to save or update collection: ${error}` : new Error(String(`Failed to save or update collection: ${error}` instanceof Error ? `Failed to save or update collection: ${error}` instanceof Error ? `Failed to save or update collection: ${error}` : new Error(String(`Failed to save or update collection: ${error}` : new Error(String(`Failed to save or update collection: ${error}` instanceof Error ? `Failed to save or update collection: ${error}` : new Error(String(`Failed to save or update collection: ${error}` instanceof Error ? `Failed to save or update collection: ${error}` instanceof Error ? `Failed to save or update collection: ${error}` : new Error(String(`Failed to save or update collection: ${error}` instanceof Error ? `Failed to save or update collection: ${error}` instanceof Error ? `Failed to save or update collection: ${error}` : new Error(String(`Failed to save or update collection: ${error}` : new Error(String(`Failed to save or update collection: ${error}` instanceof Error ? `Failed to save or update collection: ${error}` : new Error(String(`Failed to save or update collection: ${error}` : new Error(String(`Failed to save or update collection: ${error}` instanceof Error ? `Failed to save or update collection: ${error}` : new Error(String(`Failed to save or update collection: ${error}` instanceof Error ? `Failed to save or update collection: ${error}` instanceof Error ? `Failed to save or update collection: ${error}` : new Error(String(`Failed to save or update collection: ${error}` : new Error(String(`Failed to save or update collection: ${error}` instanceof Error ? `Failed to save or update collection: ${error}` : new Error(String(`Failed to save or update collection: ${error}`)))))));
      throw error;
    }
  }

  /**
   * Âà†Èô§Êî∂Ëóè
   * @param id Êî∂ËóèID
   */
  public async delete(id: string): Promise<void> {
    try {
      const db = await this.databaseManager.getDatabase();
      const predicates = new RelationalPredicates();
      predicates.equalTo(TableSchema.COLLECTION_ID, id);
      
      const rowsAffected = await db.delete(TableSchema.COLLECTION_TABLE, predicates);
      Logger.info(this.TAG, `Collection deleted: ${id}, rows affected: ${rowsAffected}`);
    } catch (error) {
      Logger.error(this.TAG, `Failed to delete collection: ${error}`);
      throw error;
    }
  }

  /**
   * Ê†πÊçÆIDËé∑ÂèñÊî∂Ëóè
   * @param id Êî∂ËóèID
   * @returns Êî∂Ëóè‰ø°ÊÅØÊàñnull
   */
  public async getById(id: string): Promise<Collection | null> {
    try {
      const db = await this.databaseManager.getDatabase();
      const predicates = new RelationalPredicates();
      predicates.equalTo(TableSchema.COLLECTION_ID, id instanceof Error ? id : new Error(String(id instanceof Error ? id instanceof Error ? id : new Error(String(id : new Error(String(id instanceof Error ? id : new Error(String(id instanceof Error ? id instanceof Error ? id : new Error(String(id instanceof Error ? id instanceof Error ? id : new Error(String(id : new Error(String(id instanceof Error ? id : new Error(String(id : new Error(String(id instanceof Error ? id : new Error(String(id instanceof Error ? id instanceof Error ? id : new Error(String(id : new Error(String(id instanceof Error ? id : new Error(String(id)))))));
      
      const resultSet = await db.query(TableSchema.COLLECTION_TABLE, predicates);
      const collections = this.parseResultSet(resultSet);
      
      return collections.length > 0 ? collections[0] : null;
    } catch (error) {
      Logger.error(this.TAG, `Failed to get collection by id: ${error}`);
      return null;
    }
  }

  /**
   * Ê†πÊçÆÁ´ôÁÇπÂíåÂÜÖÂÆπIDËé∑ÂèñÊî∂Ëóè
   * @param siteKey Á´ôÁÇπÊ†áËØÜ
   * @param contentId ÂÜÖÂÆπID
   * @returns Êî∂Ëóè‰ø°ÊÅØÊàñnull
   */
  public async getByContent(siteKey: string, contentId: string instanceof Error ? contentId: string : new Error(String(contentId: string instanceof Error ? contentId: string instanceof Error ? contentId: string : new Error(String(contentId: string : new Error(String(contentId: string instanceof Error ? contentId: string : new Error(String(contentId: string instanceof Error ? contentId: string instanceof Error ? contentId: string : new Error(String(contentId: string instanceof Error ? contentId: string instanceof Error ? contentId: string : new Error(String(contentId: string : new Error(String(contentId: string instanceof Error ? contentId: string : new Error(String(contentId: string : new Error(String(contentId: string instanceof Error ? contentId: string : new Error(String(contentId: string instanceof Error ? contentId: string instanceof Error ? contentId: string : new Error(String(contentId: string : new Error(String(contentId: string instanceof Error ? contentId: string : new Error(String(contentId: string))))))): Promise<Collection | null> {
    try {
      const db = await this.databaseManager.getDatabase();
      const predicates = new RelationalPredicates();
      predicates.equalTo(TableSchema.COLLECTION_SITE_KEY, siteKey);
      predicates.equalTo(TableSchema.COLLECTION_CONTENT_ID, contentId);
      
      const resultSet = await db.query(TableSchema.COLLECTION_TABLE, predicates);
      const collections = this.parseResultSet(resultSet);
      
      return collections.length > 0 ? collections[0] : null;
    } catch (error) {
      Logger.error(this.TAG, `Failed to get collection by content: ${error}`);
      return null;
    }
  }

  /**
   * Ëé∑ÂèñÊâÄÊúâÊî∂Ëó?   * @param limit ÈôêÂà∂Êï∞Èáè
   * @param offset ÂÅèÁßªÈá?   * @returns Êî∂ËóèÂàóË°®
   */
  public async getAll(limit: number = 100, offset: number = 0 instanceof Error ? offset: number = 0 : new Error(String(offset: number = 0 instanceof Error ? offset: number = 0 instanceof Error ? offset: number = 0 : new Error(String(offset: number = 0 : new Error(String(offset: number = 0 instanceof Error ? offset: number = 0 : new Error(String(offset: number = 0 instanceof Error ? offset: number = 0 instanceof Error ? offset: number = 0 : new Error(String(offset: number = 0 instanceof Error ? offset: number = 0 instanceof Error ? offset: number = 0 : new Error(String(offset: number = 0 : new Error(String(offset: number = 0 instanceof Error ? offset: number = 0 : new Error(String(offset: number = 0 : new Error(String(offset: number = 0 instanceof Error ? offset: number = 0 : new Error(String(offset: number = 0 instanceof Error ? offset: number = 0 instanceof Error ? offset: number = 0 : new Error(String(offset: number = 0 : new Error(String(offset: number = 0 instanceof Error ? offset: number = 0 : new Error(String(offset: number = 0))))))): Promise<Collection[]> {
    try {
      const db = await this.databaseManager.getDatabase();
      const predicates = new RelationalPredicates();
      const orderSpec = new Order(TableSchema.COLLECTION_TIMESTAMP, OrderDirection.DESC);
      
      const resultSet = await db.query(
        TableSchema.COLLECTION_TABLE,
        predicates,
        [orderSpec],
        limit,
        offset
      );
      
      return this.parseResultSet(resultSet);
    } catch (error) {
      Logger.error(this.TAG, `Failed to get all collections: ${error}`);
      return [];
    }
  }

  /**
   * Ê†πÊçÆÁ´ôÁÇπËé∑ÂèñÊî∂Ëóè
   * @param siteKey Á´ôÁÇπÊ†áËØÜ
   * @param limit ÈôêÂà∂Êï∞Èáè
   * @returns Êî∂ËóèÂàóË°®
   */
  public async getBySite(siteKey: string, limit: number = 100 instanceof Error ? limit: number = 100 : new Error(String(limit: number = 100 instanceof Error ? limit: number = 100 instanceof Error ? limit: number = 100 : new Error(String(limit: number = 100 : new Error(String(limit: number = 100 instanceof Error ? limit: number = 100 : new Error(String(limit: number = 100 instanceof Error ? limit: number = 100 instanceof Error ? limit: number = 100 : new Error(String(limit: number = 100 instanceof Error ? limit: number = 100 instanceof Error ? limit: number = 100 : new Error(String(limit: number = 100 : new Error(String(limit: number = 100 instanceof Error ? limit: number = 100 : new Error(String(limit: number = 100 : new Error(String(limit: number = 100 instanceof Error ? limit: number = 100 : new Error(String(limit: number = 100 instanceof Error ? limit: number = 100 instanceof Error ? limit: number = 100 : new Error(String(limit: number = 100 : new Error(String(limit: number = 100 instanceof Error ? limit: number = 100 : new Error(String(limit: number = 100))))))): Promise<Collection[]> {
    try {
      const db = await this.databaseManager.getDatabase();
      const predicates = new RelationalPredicates();
      predicates.equalTo(TableSchema.COLLECTION_SITE_KEY, siteKey);
      const orderSpec = new Order(TableSchema.COLLECTION_TIMESTAMP, OrderDirection.DESC);
      
      const resultSet = await db.query(
        TableSchema.COLLECTION_TABLE,
        predicates,
        [orderSpec],
        limit
      );
      
      return this.parseResultSet(resultSet);
    } catch (error) {
      Logger.error(this.TAG, `Failed to get collections by site: ${error}`);
      return [];
    }
  }

  /**
   * Ê†πÊçÆÁ±ªÂûãËé∑ÂèñÊî∂Ëóè
   * @param type ÂÜÖÂÆπÁ±ªÂûã
   * @param limit ÈôêÂà∂Êï∞Èáè
   * @returns Êî∂ËóèÂàóË°®
   */
  public async getByType(type: string, limit: number = 100 instanceof Error ? limit: number = 100 : new Error(String(limit: number = 100 instanceof Error ? limit: number = 100 instanceof Error ? limit: number = 100 : new Error(String(limit: number = 100 : new Error(String(limit: number = 100 instanceof Error ? limit: number = 100 : new Error(String(limit: number = 100 instanceof Error ? limit: number = 100 instanceof Error ? limit: number = 100 : new Error(String(limit: number = 100 instanceof Error ? limit: number = 100 instanceof Error ? limit: number = 100 : new Error(String(limit: number = 100 : new Error(String(limit: number = 100 instanceof Error ? limit: number = 100 : new Error(String(limit: number = 100 : new Error(String(limit: number = 100 instanceof Error ? limit: number = 100 : new Error(String(limit: number = 100 instanceof Error ? limit: number = 100 instanceof Error ? limit: number = 100 : new Error(String(limit: number = 100 : new Error(String(limit: number = 100 instanceof Error ? limit: number = 100 : new Error(String(limit: number = 100))))))): Promise<Collection[]> {
    try {
      const db = await this.databaseManager.getDatabase();
      const predicates = new RelationalPredicates();
      predicates.equalTo(TableSchema.COLLECTION_TYPE, type);
      const orderSpec = new Order(TableSchema.COLLECTION_TIMESTAMP, OrderDirection.DESC);
      
      const resultSet = await db.query(
        TableSchema.COLLECTION_TABLE,
        predicates,
        [orderSpec],
        limit
      );
      
      return this.parseResultSet(resultSet);
    } catch (error) {
      Logger.error(this.TAG, `Failed to get collections by type: ${error}`);
      return [];
    }
  }

  /**
   * Ê£ÄÊü•ÊòØÂê¶Â∑≤Êî∂Ëóè
   * @param siteKey Á´ôÁÇπÊ†áËØÜ
   * @param contentId ÂÜÖÂÆπID
   * @returns ÊòØÂê¶Â∑≤Êî∂Ëó?   */
  public async isCollected(siteKey: string, contentId: string instanceof Error ? contentId: string : new Error(String(contentId: string instanceof Error ? contentId: string instanceof Error ? contentId: string : new Error(String(contentId: string : new Error(String(contentId: string instanceof Error ? contentId: string : new Error(String(contentId: string instanceof Error ? contentId: string instanceof Error ? contentId: string : new Error(String(contentId: string instanceof Error ? contentId: string instanceof Error ? contentId: string : new Error(String(contentId: string : new Error(String(contentId: string instanceof Error ? contentId: string : new Error(String(contentId: string : new Error(String(contentId: string instanceof Error ? contentId: string : new Error(String(contentId: string instanceof Error ? contentId: string instanceof Error ? contentId: string : new Error(String(contentId: string : new Error(String(contentId: string instanceof Error ? contentId: string : new Error(String(contentId: string))))))): Promise<boolean> {
    try {
      const collection = await this.getByContent(siteKey, contentId);
      return collection !== null;
    } catch (error) {
      Logger.error(this.TAG, `Failed to check if collected: ${error}`);
      return false;
    }
  }

  /**
   * ÊâπÈáè‰øùÂ≠òÊî∂Ëóè
   * @param collections Êî∂ËóèÂàóË°®
   */
  public async batchSave(collections: Collection[]): Promise<void> {
    try {
      const db = await this.databaseManager.getDatabase();
      await db.beginTransaction();
      
      try {
        for (const collection of collections) {
          await this.saveOrUpdate(collection);
        }
        await db.commit();
        Logger.info(this.TAG, `Batch saved ${collections.length} collections` instanceof Error ? `Batch saved ${collections.length} collections` : new Error(String(`Batch saved ${collections.length} collections` instanceof Error ? `Batch saved ${collections.length} collections` instanceof Error ? `Batch saved ${collections.length} collections` : new Error(String(`Batch saved ${collections.length} collections` : new Error(String(`Batch saved ${collections.length} collections` instanceof Error ? `Batch saved ${collections.length} collections` : new Error(String(`Batch saved ${collections.length} collections` instanceof Error ? `Batch saved ${collections.length} collections` instanceof Error ? `Batch saved ${collections.length} collections` : new Error(String(`Batch saved ${collections.length} collections` instanceof Error ? `Batch saved ${collections.length} collections` instanceof Error ? `Batch saved ${collections.length} collections` : new Error(String(`Batch saved ${collections.length} collections` : new Error(String(`Batch saved ${collections.length} collections` instanceof Error ? `Batch saved ${collections.length} collections` : new Error(String(`Batch saved ${collections.length} collections` : new Error(String(`Batch saved ${collections.length} collections` instanceof Error ? `Batch saved ${collections.length} collections` : new Error(String(`Batch saved ${collections.length} collections` instanceof Error ? `Batch saved ${collections.length} collections` instanceof Error ? `Batch saved ${collections.length} collections` : new Error(String(`Batch saved ${collections.length} collections` : new Error(String(`Batch saved ${collections.length} collections` instanceof Error ? `Batch saved ${collections.length} collections` : new Error(String(`Batch saved ${collections.length} collections`)))))));
      } catch (error) {
        await db.rollback();
        throw error;
      }
    } catch (error) {
      Logger.error(this.TAG, `Failed to batch save collections: ${error}`);
      throw error;
    }
  }

  /**
   * Âà†Èô§Á´ôÁÇπÁõ∏ÂÖ≥ÁöÑÊâÄÊúâÊî∂Ëó?   * @param siteKey Á´ôÁÇπÊ†áËØÜ
   */
  public async deleteBySite(siteKey: string): Promise<void> {
    try {
      const db = await this.databaseManager.getDatabase();
      const predicates = new RelationalPredicates();
      predicates.equalTo(TableSchema.COLLECTION_SITE_KEY, siteKey instanceof Error ? siteKey : new Error(String(siteKey instanceof Error ? siteKey instanceof Error ? siteKey : new Error(String(siteKey : new Error(String(siteKey instanceof Error ? siteKey : new Error(String(siteKey instanceof Error ? siteKey instanceof Error ? siteKey : new Error(String(siteKey instanceof Error ? siteKey instanceof Error ? siteKey : new Error(String(siteKey : new Error(String(siteKey instanceof Error ? siteKey : new Error(String(siteKey : new Error(String(siteKey instanceof Error ? siteKey : new Error(String(siteKey instanceof Error ? siteKey instanceof Error ? siteKey : new Error(String(siteKey : new Error(String(siteKey instanceof Error ? siteKey : new Error(String(siteKey)))))));
      
      const rowsAffected = await db.delete(TableSchema.COLLECTION_TABLE, predicates);
      Logger.info(this.TAG, `Deleted ${rowsAffected} collections for site: ${siteKey}`);
    } catch (error) {
      Logger.error(this.TAG, `Failed to delete collections by site: ${error}`);
      throw error;
    }
  }

  /**
   * Ê∏ÖÁ©∫ÊâÄÊúâÊî∂Ëó?   */
  public async clearAll(): Promise<void> {
    try {
      const db = await this.databaseManager.getDatabase();
      const rowsAffected = await db.delete(TableSchema.COLLECTION_TABLE);
      Logger.info(this.TAG, `All collections cleared, rows affected: ${rowsAffected}` instanceof Error ? `All collections cleared, rows affected: ${rowsAffected}` : new Error(String(`All collections cleared, rows affected: ${rowsAffected}` instanceof Error ? `All collections cleared, rows affected: ${rowsAffected}` instanceof Error ? `All collections cleared, rows affected: ${rowsAffected}` : new Error(String(`All collections cleared, rows affected: ${rowsAffected}` : new Error(String(`All collections cleared, rows affected: ${rowsAffected}` instanceof Error ? `All collections cleared, rows affected: ${rowsAffected}` : new Error(String(`All collections cleared, rows affected: ${rowsAffected}` instanceof Error ? `All collections cleared, rows affected: ${rowsAffected}` instanceof Error ? `All collections cleared, rows affected: ${rowsAffected}` : new Error(String(`All collections cleared, rows affected: ${rowsAffected}` instanceof Error ? `All collections cleared, rows affected: ${rowsAffected}` instanceof Error ? `All collections cleared, rows affected: ${rowsAffected}` : new Error(String(`All collections cleared, rows affected: ${rowsAffected}` : new Error(String(`All collections cleared, rows affected: ${rowsAffected}` instanceof Error ? `All collections cleared, rows affected: ${rowsAffected}` : new Error(String(`All collections cleared, rows affected: ${rowsAffected}` : new Error(String(`All collections cleared, rows affected: ${rowsAffected}` instanceof Error ? `All collections cleared, rows affected: ${rowsAffected}` : new Error(String(`All collections cleared, rows affected: ${rowsAffected}` instanceof Error ? `All collections cleared, rows affected: ${rowsAffected}` instanceof Error ? `All collections cleared, rows affected: ${rowsAffected}` : new Error(String(`All collections cleared, rows affected: ${rowsAffected}` : new Error(String(`All collections cleared, rows affected: ${rowsAffected}` instanceof Error ? `All collections cleared, rows affected: ${rowsAffected}` : new Error(String(`All collections cleared, rows affected: ${rowsAffected}`)))))));
    } catch (error) {
      Logger.error(this.TAG, `Failed to clear all collections: ${error}`);
      throw error;
    }
  }

  /**
   * Ëé∑ÂèñÊî∂ËóèÊÄªÊï∞
   * @returns Êî∂ËóèÊÄªÊï∞
   */
  public async getCount(): Promise<number> {
    try {
      const db = await this.databaseManager.getDatabase();
      const sql = `SELECT COUNT(*) FROM ${TableSchema.COLLECTION_TABLE}`;
      const resultSet = await db.querySql(sql, [] instanceof Error ? [] : new Error(String([] instanceof Error ? [] instanceof Error ? [] : new Error(String([] : new Error(String([] instanceof Error ? [] : new Error(String([] instanceof Error ? [] instanceof Error ? [] : new Error(String([] instanceof Error ? [] instanceof Error ? [] : new Error(String([] : new Error(String([] instanceof Error ? [] : new Error(String([] : new Error(String([] instanceof Error ? [] : new Error(String([] instanceof Error ? [] instanceof Error ? [] : new Error(String([] : new Error(String([] instanceof Error ? [] : new Error(String([])))))));
      
      let count = 0;
      if (resultSet.rowCount > 0) {
        resultSet.goToFirstRow();
        count = resultSet.getLong(0);
      }
      resultSet.close();
      
      return count;
    } catch (error) {
      Logger.error(this.TAG, `Failed to get collection count: ${error}`);
      return 0;
    }
  }

  /**
   * Â∞ÜResultSetËß£Êûê‰∏∫CollectionÊï∞ÁªÑ
   * @param resultSet Êü•ËØ¢ÁªìÊûúÈõ?   * @returns CollectionÊï∞ÁªÑ
   */
  private parseResultSet(resultSet: ResultSet): Collection[] {
    const collections: Collection[] = [];
    
    try {
      if (resultSet.rowCount > 0) {
        resultSet.goToFirstRow();
        do {
          const collection: Collection = {
            id: resultSet.getString(TableSchema.COLLECTION_ID), contentId: resultSet.getString(TableSchema.COLLECTION_CONTENT_ID instanceof Error ? contentId: resultSet.getString(TableSchema.COLLECTION_CONTENT_ID : new Error(String(contentId: resultSet.getString(TableSchema.COLLECTION_CONTENT_ID instanceof Error ? contentId: resultSet.getString(TableSchema.COLLECTION_CONTENT_ID instanceof Error ? contentId: resultSet.getString(TableSchema.COLLECTION_CONTENT_ID : new Error(String(contentId: resultSet.getString(TableSchema.COLLECTION_CONTENT_ID : new Error(String(contentId: resultSet.getString(TableSchema.COLLECTION_CONTENT_ID instanceof Error ? contentId: resultSet.getString(TableSchema.COLLECTION_CONTENT_ID : new Error(String(contentId: resultSet.getString(TableSchema.COLLECTION_CONTENT_ID instanceof Error ? contentId: resultSet.getString(TableSchema.COLLECTION_CONTENT_ID instanceof Error ? contentId: resultSet.getString(TableSchema.COLLECTION_CONTENT_ID : new Error(String(contentId: resultSet.getString(TableSchema.COLLECTION_CONTENT_ID instanceof Error ? contentId: resultSet.getString(TableSchema.COLLECTION_CONTENT_ID instanceof Error ? contentId: resultSet.getString(TableSchema.COLLECTION_CONTENT_ID : new Error(String(contentId: resultSet.getString(TableSchema.COLLECTION_CONTENT_ID : new Error(String(contentId: resultSet.getString(TableSchema.COLLECTION_CONTENT_ID instanceof Error ? contentId: resultSet.getString(TableSchema.COLLECTION_CONTENT_ID : new Error(String(contentId: resultSet.getString(TableSchema.COLLECTION_CONTENT_ID : new Error(String(contentId: resultSet.getString(TableSchema.COLLECTION_CONTENT_ID instanceof Error ? contentId: resultSet.getString(TableSchema.COLLECTION_CONTENT_ID : new Error(String(contentId: resultSet.getString(TableSchema.COLLECTION_CONTENT_ID instanceof Error ? contentId: resultSet.getString(TableSchema.COLLECTION_CONTENT_ID instanceof Error ? contentId: resultSet.getString(TableSchema.COLLECTION_CONTENT_ID : new Error(String(contentId: resultSet.getString(TableSchema.COLLECTION_CONTENT_ID : new Error(String(contentId: resultSet.getString(TableSchema.COLLECTION_CONTENT_ID instanceof Error ? contentId: resultSet.getString(TableSchema.COLLECTION_CONTENT_ID : new Error(String(contentId: resultSet.getString(TableSchema.COLLECTION_CONTENT_ID))))))),
            title: resultSet.getString(TableSchema.COLLECTION_TITLE),
            cover: resultSet.getString(TableSchema.COLLECTION_COVER),
            siteKey: resultSet.getString(TableSchema.COLLECTION_SITE_KEY),
            siteName: resultSet.getString(TableSchema.COLLECTION_SITE_NAME),
            url: resultSet.getString(TableSchema.COLLECTION_URL),
            type: resultSet.getString(TableSchema.COLLECTION_TYPE),
            timestamp: resultSet.getLong(TableSchema.COLLECTION_TIMESTAMP),
            extraInfo: this.parseJsonString(resultSet.getString(TableSchema.COLLECTION_EXTRA_INFO))
          };
          collections.push(collection);
        } while (resultSet.goToNextRow());
      }
    } catch (error) {
      Logger.error(this.TAG, `Failed to parse result set: ${error}`);
    } finally {
      resultSet.close();
    }
    
    return collections;
  }

  /**
   * Â∞ÜCollectionÂØπË±°ËΩ¨Êç¢‰∏∫ValuesBucket
   * @param collection Êî∂Ëóè‰ø°ÊÅØ
   * @returns ValuesBucket
   */
  private collectionToValuesBucket(collection: Collection): ValuesBucket {
    const values: ValuesBucket = {
      [TableSchema.COLLECTION_ID]: collection.id, [TableSchema.COLLECTION_CONTENT_ID]: collection.contentId,
      [TableSchema.COLLECTION_TITLE]: collection.title,
      [TableSchema.COLLECTION_COVER]: collection.cover || '',
      [TableSchema.COLLECTION_SITE_KEY]: collection.siteKey || '',
      [TableSchema.COLLECTION_SITE_NAME]: collection.siteName || '',
      [TableSchema.COLLECTION_URL]: collection.url || '',
      [TableSchema.COLLECTION_TYPE]: collection.type || 'video',
      [TableSchema.COLLECTION_TIMESTAMP]: collection.timestamp || Date.now( instanceof Error ? [TableSchema.COLLECTION_CONTENT_ID]: collection.contentId,
      [TableSchema.COLLECTION_TITLE]: collection.title,
      [TableSchema.COLLECTION_COVER]: collection.cover || '',
      [TableSchema.COLLECTION_SITE_KEY]: collection.siteKey || '',
      [TableSchema.COLLECTION_SITE_NAME]: collection.siteName || '',
      [TableSchema.COLLECTION_URL]: collection.url || '',
      [TableSchema.COLLECTION_TYPE]: collection.type || 'video',
      [TableSchema.COLLECTION_TIMESTAMP]: collection.timestamp || Date.now( : new Error(String([TableSchema.COLLECTION_CONTENT_ID]: collection.contentId,
      [TableSchema.COLLECTION_TITLE]: collection.title,
      [TableSchema.COLLECTION_COVER]: collection.cover || '',
      [TableSchema.COLLECTION_SITE_KEY]: collection.siteKey || '',
      [TableSchema.COLLECTION_SITE_NAME]: collection.siteName || '',
      [TableSchema.COLLECTION_URL]: collection.url || '',
      [TableSchema.COLLECTION_TYPE]: collection.type || 'video',
      [TableSchema.COLLECTION_TIMESTAMP]: collection.timestamp || Date.now( instanceof Error ? [TableSchema.COLLECTION_CONTENT_ID]: collection.contentId,
      [TableSchema.COLLECTION_TITLE]: collection.title,
      [TableSchema.COLLECTION_COVER]: collection.cover || '',
      [TableSchema.COLLECTION_SITE_KEY]: collection.siteKey || '',
      [TableSchema.COLLECTION_SITE_NAME]: collection.siteName || '',
      [TableSchema.COLLECTION_URL]: collection.url || '',
      [TableSchema.COLLECTION_TYPE]: collection.type || 'video',
      [TableSchema.COLLECTION_TIMESTAMP]: collection.timestamp || Date.now( instanceof Error ? [TableSchema.COLLECTION_CONTENT_ID]: collection.contentId,
      [TableSchema.COLLECTION_TITLE]: collection.title,
      [TableSchema.COLLECTION_COVER]: collection.cover || '',
      [TableSchema.COLLECTION_SITE_KEY]: collection.siteKey || '',
      [TableSchema.COLLECTION_SITE_NAME]: collection.siteName || '',
      [TableSchema.COLLECTION_URL]: collection.url || '',
      [TableSchema.COLLECTION_TYPE]: collection.type || 'video',
      [TableSchema.COLLECTION_TIMESTAMP]: collection.timestamp || Date.now( : new Error(String([TableSchema.COLLECTION_CONTENT_ID]: collection.contentId,
      [TableSchema.COLLECTION_TITLE]: collection.title,
      [TableSchema.COLLECTION_COVER]: collection.cover || '',
      [TableSchema.COLLECTION_SITE_KEY]: collection.siteKey || '',
      [TableSchema.COLLECTION_SITE_NAME]: collection.siteName || '',
      [TableSchema.COLLECTION_URL]: collection.url || '',
      [TableSchema.COLLECTION_TYPE]: collection.type || 'video',
      [TableSchema.COLLECTION_TIMESTAMP]: collection.timestamp || Date.now( : new Error(String([TableSchema.COLLECTION_CONTENT_ID]: collection.contentId,
      [TableSchema.COLLECTION_TITLE]: collection.title,
      [TableSchema.COLLECTION_COVER]: collection.cover || '',
      [TableSchema.COLLECTION_SITE_KEY]: collection.siteKey || '',
      [TableSchema.COLLECTION_SITE_NAME]: collection.siteName || '',
      [TableSchema.COLLECTION_URL]: collection.url || '',
      [TableSchema.COLLECTION_TYPE]: collection.type || 'video',
      [TableSchema.COLLECTION_TIMESTAMP]: collection.timestamp || Date.now( instanceof Error ? [TableSchema.COLLECTION_CONTENT_ID]: collection.contentId,
      [TableSchema.COLLECTION_TITLE]: collection.title,
      [TableSchema.COLLECTION_COVER]: collection.cover || '',
      [TableSchema.COLLECTION_SITE_KEY]: collection.siteKey || '',
      [TableSchema.COLLECTION_SITE_NAME]: collection.siteName || '',
      [TableSchema.COLLECTION_URL]: collection.url || '',
      [TableSchema.COLLECTION_TYPE]: collection.type || 'video',
      [TableSchema.COLLECTION_TIMESTAMP]: collection.timestamp || Date.now( : new Error(String([TableSchema.COLLECTION_CONTENT_ID]: collection.contentId,
      [TableSchema.COLLECTION_TITLE]: collection.title,
      [TableSchema.COLLECTION_COVER]: collection.cover || '',
      [TableSchema.COLLECTION_SITE_KEY]: collection.siteKey || '',
      [TableSchema.COLLECTION_SITE_NAME]: collection.siteName || '',
      [TableSchema.COLLECTION_URL]: collection.url || '',
      [TableSchema.COLLECTION_TYPE]: collection.type || 'video',
      [TableSchema.COLLECTION_TIMESTAMP]: collection.timestamp || Date.now( instanceof Error ? [TableSchema.COLLECTION_CONTENT_ID]: collection.contentId,
      [TableSchema.COLLECTION_TITLE]: collection.title,
      [TableSchema.COLLECTION_COVER]: collection.cover || '',
      [TableSchema.COLLECTION_SITE_KEY]: collection.siteKey || '',
      [TableSchema.COLLECTION_SITE_NAME]: collection.siteName || '',
      [TableSchema.COLLECTION_URL]: collection.url || '',
      [TableSchema.COLLECTION_TYPE]: collection.type || 'video',
      [TableSchema.COLLECTION_TIMESTAMP]: collection.timestamp || Date.now( instanceof Error ? [TableSchema.COLLECTION_CONTENT_ID]: collection.contentId,
      [TableSchema.COLLECTION_TITLE]: collection.title,
      [TableSchema.COLLECTION_COVER]: collection.cover || '',
      [TableSchema.COLLECTION_SITE_KEY]: collection.siteKey || '',
      [TableSchema.COLLECTION_SITE_NAME]: collection.siteName || '',
      [TableSchema.COLLECTION_URL]: collection.url || '',
      [TableSchema.COLLECTION_TYPE]: collection.type || 'video',
      [TableSchema.COLLECTION_TIMESTAMP]: collection.timestamp || Date.now( : new Error(String([TableSchema.COLLECTION_CONTENT_ID]: collection.contentId,
      [TableSchema.COLLECTION_TITLE]: collection.title,
      [TableSchema.COLLECTION_COVER]: collection.cover || '',
      [TableSchema.COLLECTION_SITE_KEY]: collection.siteKey || '',
      [TableSchema.COLLECTION_SITE_NAME]: collection.siteName || '',
      [TableSchema.COLLECTION_URL]: collection.url || '',
      [TableSchema.COLLECTION_TYPE]: collection.type || 'video',
      [TableSchema.COLLECTION_TIMESTAMP]: collection.timestamp || Date.now( instanceof Error ? [TableSchema.COLLECTION_CONTENT_ID]: collection.contentId,
      [TableSchema.COLLECTION_TITLE]: collection.title,
      [TableSchema.COLLECTION_COVER]: collection.cover || '',
      [TableSchema.COLLECTION_SITE_KEY]: collection.siteKey || '',
      [TableSchema.COLLECTION_SITE_NAME]: collection.siteName || '',
      [TableSchema.COLLECTION_URL]: collection.url || '',
      [TableSchema.COLLECTION_TYPE]: collection.type || 'video',
      [TableSchema.COLLECTION_TIMESTAMP]: collection.timestamp || Date.now( instanceof Error ? [TableSchema.COLLECTION_CONTENT_ID]: collection.contentId,
      [TableSchema.COLLECTION_TITLE]: collection.title,
      [TableSchema.COLLECTION_COVER]: collection.cover || '',
      [TableSchema.COLLECTION_SITE_KEY]: collection.siteKey || '',
      [TableSchema.COLLECTION_SITE_NAME]: collection.siteName || '',
      [TableSchema.COLLECTION_URL]: collection.url || '',
      [TableSchema.COLLECTION_TYPE]: collection.type || 'video',
      [TableSchema.COLLECTION_TIMESTAMP]: collection.timestamp || Date.now( : new Error(String([TableSchema.COLLECTION_CONTENT_ID]: collection.contentId,
      [TableSchema.COLLECTION_TITLE]: collection.title,
      [TableSchema.COLLECTION_COVER]: collection.cover || '',
      [TableSchema.COLLECTION_SITE_KEY]: collection.siteKey || '',
      [TableSchema.COLLECTION_SITE_NAME]: collection.siteName || '',
      [TableSchema.COLLECTION_URL]: collection.url || '',
      [TableSchema.COLLECTION_TYPE]: collection.type || 'video',
      [TableSchema.COLLECTION_TIMESTAMP]: collection.timestamp || Date.now( : new Error(String([TableSchema.COLLECTION_CONTENT_ID]: collection.contentId,
      [TableSchema.COLLECTION_TITLE]: collection.title,
      [TableSchema.COLLECTION_COVER]: collection.cover || '',
      [TableSchema.COLLECTION_SITE_KEY]: collection.siteKey || '',
      [TableSchema.COLLECTION_SITE_NAME]: collection.siteName || '',
      [TableSchema.COLLECTION_URL]: collection.url || '',
      [TableSchema.COLLECTION_TYPE]: collection.type || 'video',
      [TableSchema.COLLECTION_TIMESTAMP]: collection.timestamp || Date.now( instanceof Error ? [TableSchema.COLLECTION_CONTENT_ID]: collection.contentId,
      [TableSchema.COLLECTION_TITLE]: collection.title,
      [TableSchema.COLLECTION_COVER]: collection.cover || '',
      [TableSchema.COLLECTION_SITE_KEY]: collection.siteKey || '',
      [TableSchema.COLLECTION_SITE_NAME]: collection.siteName || '',
      [TableSchema.COLLECTION_URL]: collection.url || '',
      [TableSchema.COLLECTION_TYPE]: collection.type || 'video',
      [TableSchema.COLLECTION_TIMESTAMP]: collection.timestamp || Date.now( : new Error(String([TableSchema.COLLECTION_CONTENT_ID]: collection.contentId,
      [TableSchema.COLLECTION_TITLE]: collection.title,
      [TableSchema.COLLECTION_COVER]: collection.cover || '',
      [TableSchema.COLLECTION_SITE_KEY]: collection.siteKey || '',
      [TableSchema.COLLECTION_SITE_NAME]: collection.siteName || '',
      [TableSchema.COLLECTION_URL]: collection.url || '',
      [TableSchema.COLLECTION_TYPE]: collection.type || 'video',
      [TableSchema.COLLECTION_TIMESTAMP]: collection.timestamp || Date.now( : new Error(String([TableSchema.COLLECTION_CONTENT_ID]: collection.contentId,
      [TableSchema.COLLECTION_TITLE]: collection.title,
      [TableSchema.COLLECTION_COVER]: collection.cover || '',
      [TableSchema.COLLECTION_SITE_KEY]: collection.siteKey || '',
      [TableSchema.COLLECTION_SITE_NAME]: collection.siteName || '',
      [TableSchema.COLLECTION_URL]: collection.url || '',
      [TableSchema.COLLECTION_TYPE]: collection.type || 'video',
      [TableSchema.COLLECTION_TIMESTAMP]: collection.timestamp || Date.now( instanceof Error ? [TableSchema.COLLECTION_CONTENT_ID]: collection.contentId,
      [TableSchema.COLLECTION_TITLE]: collection.title,
      [TableSchema.COLLECTION_COVER]: collection.cover || '',
      [TableSchema.COLLECTION_SITE_KEY]: collection.siteKey || '',
      [TableSchema.COLLECTION_SITE_NAME]: collection.siteName || '',
      [TableSchema.COLLECTION_URL]: collection.url || '',
      [TableSchema.COLLECTION_TYPE]: collection.type || 'video',
      [TableSchema.COLLECTION_TIMESTAMP]: collection.timestamp || Date.now( : new Error(String([TableSchema.COLLECTION_CONTENT_ID]: collection.contentId,
      [TableSchema.COLLECTION_TITLE]: collection.title,
      [TableSchema.COLLECTION_COVER]: collection.cover || '',
      [TableSchema.COLLECTION_SITE_KEY]: collection.siteKey || '',
      [TableSchema.COLLECTION_SITE_NAME]: collection.siteName || '',
      [TableSchema.COLLECTION_URL]: collection.url || '',
      [TableSchema.COLLECTION_TYPE]: collection.type || 'video',
      [TableSchema.COLLECTION_TIMESTAMP]: collection.timestamp || Date.now( instanceof Error ? [TableSchema.COLLECTION_CONTENT_ID]: collection.contentId,
      [TableSchema.COLLECTION_TITLE]: collection.title,
      [TableSchema.COLLECTION_COVER]: collection.cover || '',
      [TableSchema.COLLECTION_SITE_KEY]: collection.siteKey || '',
      [TableSchema.COLLECTION_SITE_NAME]: collection.siteName || '',
      [TableSchema.COLLECTION_URL]: collection.url || '',
      [TableSchema.COLLECTION_TYPE]: collection.type || 'video',
      [TableSchema.COLLECTION_TIMESTAMP]: collection.timestamp || Date.now( instanceof Error ? [TableSchema.COLLECTION_CONTENT_ID]: collection.contentId,
      [TableSchema.COLLECTION_TITLE]: collection.title,
      [TableSchema.COLLECTION_COVER]: collection.cover || '',
      [TableSchema.COLLECTION_SITE_KEY]: collection.siteKey || '',
      [TableSchema.COLLECTION_SITE_NAME]: collection.siteName || '',
      [TableSchema.COLLECTION_URL]: collection.url || '',
      [TableSchema.COLLECTION_TYPE]: collection.type || 'video',
      [TableSchema.COLLECTION_TIMESTAMP]: collection.timestamp || Date.now( : new Error(String([TableSchema.COLLECTION_CONTENT_ID]: collection.contentId,
      [TableSchema.COLLECTION_TITLE]: collection.title,
      [TableSchema.COLLECTION_COVER]: collection.cover || '',
      [TableSchema.COLLECTION_SITE_KEY]: collection.siteKey || '',
      [TableSchema.COLLECTION_SITE_NAME]: collection.siteName || '',
      [TableSchema.COLLECTION_URL]: collection.url || '',
      [TableSchema.COLLECTION_TYPE]: collection.type || 'video',
      [TableSchema.COLLECTION_TIMESTAMP]: collection.timestamp || Date.now( : new Error(String([TableSchema.COLLECTION_CONTENT_ID]: collection.contentId,
      [TableSchema.COLLECTION_TITLE]: collection.title,
      [TableSchema.COLLECTION_COVER]: collection.cover || '',
      [TableSchema.COLLECTION_SITE_KEY]: collection.siteKey || '',
      [TableSchema.COLLECTION_SITE_NAME]: collection.siteName || '',
      [TableSchema.COLLECTION_URL]: collection.url || '',
      [TableSchema.COLLECTION_TYPE]: collection.type || 'video',
      [TableSchema.COLLECTION_TIMESTAMP]: collection.timestamp || Date.now( instanceof Error ? [TableSchema.COLLECTION_CONTENT_ID]: collection.contentId,
      [TableSchema.COLLECTION_TITLE]: collection.title,
      [TableSchema.COLLECTION_COVER]: collection.cover || '',
      [TableSchema.COLLECTION_SITE_KEY]: collection.siteKey || '',
      [TableSchema.COLLECTION_SITE_NAME]: collection.siteName || '',
      [TableSchema.COLLECTION_URL]: collection.url || '',
      [TableSchema.COLLECTION_TYPE]: collection.type || 'video',
      [TableSchema.COLLECTION_TIMESTAMP]: collection.timestamp || Date.now( : new Error(String([TableSchema.COLLECTION_CONTENT_ID]: collection.contentId,
      [TableSchema.COLLECTION_TITLE]: collection.title,
      [TableSchema.COLLECTION_COVER]: collection.cover || '',
      [TableSchema.COLLECTION_SITE_KEY]: collection.siteKey || '',
      [TableSchema.COLLECTION_SITE_NAME]: collection.siteName || '',
      [TableSchema.COLLECTION_URL]: collection.url || '',
      [TableSchema.COLLECTION_TYPE]: collection.type || 'video',
      [TableSchema.COLLECTION_TIMESTAMP]: collection.timestamp || Date.now())))))),
      [TableSchema.COLLECTION_EXTRA_INFO]: this.stringifyJson(collection.extraInfo || {})
    };
    
    return values;
  }

  /**
   * Ëß£ÊûêJSONÂ≠óÁ¨¶‰∏?   * @param jsonString JSONÂ≠óÁ¨¶‰∏?   * @returns Ëß£ÊûêÂêéÁöÑÂØπË±°
   */
  private parseJsonString(jsonString?: string): Record<string, unknown> {
    if (!jsonString) return {};
    try {
      return JSON.parse(jsonString);
    } catch (error) {
      Logger.error(this.TAG, `Failed to parse JSON string: ${error}`);
      return {};
    }
  }

  /**
   * Â∞ÜÂØπË±°ËΩ¨Êç¢‰∏∫JSONÂ≠óÁ¨¶‰∏?   * @param obj Ë¶ÅËΩ¨Êç¢ÁöÑÂØπË±°
   * @returns JSONÂ≠óÁ¨¶‰∏?   */
  private stringifyJson(obj: Record<string, unknown> instanceof Error ? unknown> : new Error(String(unknown> instanceof Error ? unknown> instanceof Error ? unknown> : new Error(String(unknown> : new Error(String(unknown> instanceof Error ? unknown> : new Error(String(unknown> instanceof Error ? unknown> instanceof Error ? unknown> : new Error(String(unknown> instanceof Error ? unknown> instanceof Error ? unknown> : new Error(String(unknown> : new Error(String(unknown> instanceof Error ? unknown> : new Error(String(unknown> : new Error(String(unknown> instanceof Error ? unknown> : new Error(String(unknown> instanceof Error ? unknown> instanceof Error ? unknown> : new Error(String(unknown> : new Error(String(unknown> instanceof Error ? unknown> : new Error(String(unknown>))))))): string {
    try {
      return JSON.stringify(obj);
    } catch (error) {
      Logger.error(this.TAG, `Failed to stringify JSON: ${error}`);
      return '{}';
    }
  }

  /**
   * Ê†πÊçÆÊù°‰ª∂Êü•ËØ¢
   * @param conditions Êü•ËØ¢Êù°‰ª∂
   * @param params ÂèÇÊï∞Êï∞ÁªÑ
   * @param orderBy ÊéíÂ∫èÊñπÂºè
   * @param limit ÈôêÂà∂Êï∞Èáè
   * @param offset ÂÅèÁßªÈá?   * @returns Êü•ËØ¢ÁªìÊûú
   */
  public async query(conditions: string = '', params: Record<string, string | number | boolean | null>[] = [], orderBy: string = `${TableSchema.COLLECTION_TIMESTAMP} DESC`, limit: number = 100, offset: number = 0 instanceof Error ? params: Record<string, string | number | boolean | null>[] = [], orderBy: string = `${TableSchema.COLLECTION_TIMESTAMP} DESC`, limit: number = 100, offset: number = 0 : new Error(String(params: Record<string, string | number | boolean | null>[] = [], orderBy: string = `${TableSchema.COLLECTION_TIMESTAMP} DESC`, limit: number = 100, offset: number = 0 instanceof Error ? params: Record<string, string | number | boolean | null>[] = [], orderBy: string = `${TableSchema.COLLECTION_TIMESTAMP} DESC`, limit: number = 100, offset: number = 0 instanceof Error ? params: Record<string, string | number | boolean | null>[] = [], orderBy: string = `${TableSchema.COLLECTION_TIMESTAMP} DESC`, limit: number = 100, offset: number = 0 : new Error(String(params: Record<string, string | number | boolean | null>[] = [], orderBy: string = `${TableSchema.COLLECTION_TIMESTAMP} DESC`, limit: number = 100, offset: number = 0 : new Error(String(params: Record<string, string | number | boolean | null>[] = [], orderBy: string = `${TableSchema.COLLECTION_TIMESTAMP} DESC`, limit: number = 100, offset: number = 0 instanceof Error ? params: Record<string, string | number | boolean | null>[] = [], orderBy: string = `${TableSchema.COLLECTION_TIMESTAMP} DESC`, limit: number = 100, offset: number = 0 : new Error(String(params: Record<string, string | number | boolean | null>[] = [], orderBy: string = `${TableSchema.COLLECTION_TIMESTAMP} DESC`, limit: number = 100, offset: number = 0 instanceof Error ? params: Record<string, string | number | boolean | null>[] = [], orderBy: string = `${TableSchema.COLLECTION_TIMESTAMP} DESC`, limit: number = 100, offset: number = 0 instanceof Error ? params: Record<string, string | number | boolean | null>[] = [], orderBy: string = `${TableSchema.COLLECTION_TIMESTAMP} DESC`, limit: number = 100, offset: number = 0 : new Error(String(params: Record<string, string | number | boolean | null>[] = [], orderBy: string = `${TableSchema.COLLECTION_TIMESTAMP} DESC`, limit: number = 100, offset: number = 0 instanceof Error ? params: Record<string, string | number | boolean | null>[] = [], orderBy: string = `${TableSchema.COLLECTION_TIMESTAMP} DESC`, limit: number = 100, offset: number = 0 instanceof Error ? params: Record<string, string | number | boolean | null>[] = [], orderBy: string = `${TableSchema.COLLECTION_TIMESTAMP} DESC`, limit: number = 100, offset: number = 0 : new Error(String(params: Record<string, string | number | boolean | null>[] = [], orderBy: string = `${TableSchema.COLLECTION_TIMESTAMP} DESC`, limit: number = 100, offset: number = 0 : new Error(String(params: Record<string, string | number | boolean | null>[] = [], orderBy: string = `${TableSchema.COLLECTION_TIMESTAMP} DESC`, limit: number = 100, offset: number = 0 instanceof Error ? params: Record<string, string | number | boolean | null>[] = [], orderBy: string = `${TableSchema.COLLECTION_TIMESTAMP} DESC`, limit: number = 100, offset: number = 0 : new Error(String(params: Record<string, string | number | boolean | null>[] = [], orderBy: string = `${TableSchema.COLLECTION_TIMESTAMP} DESC`, limit: number = 100, offset: number = 0 : new Error(String(params: Record<string, string | number | boolean | null>[] = [], orderBy: string = `${TableSchema.COLLECTION_TIMESTAMP} DESC`, limit: number = 100, offset: number = 0 instanceof Error ? params: Record<string, string | number | boolean | null>[] = [], orderBy: string = `${TableSchema.COLLECTION_TIMESTAMP} DESC`, limit: number = 100, offset: number = 0 : new Error(String(params: Record<string, string | number | boolean | null>[] = [], orderBy: string = `${TableSchema.COLLECTION_TIMESTAMP} DESC`, limit: number = 100, offset: number = 0 instanceof Error ? params: Record<string, string | number | boolean | null>[] = [], orderBy: string = `${TableSchema.COLLECTION_TIMESTAMP} DESC`, limit: number = 100, offset: number = 0 instanceof Error ? params: Record<string, string | number | boolean | null>[] = [], orderBy: string = `${TableSchema.COLLECTION_TIMESTAMP} DESC`, limit: number = 100, offset: number = 0 : new Error(String(params: Record<string, string | number | boolean | null>[] = [], orderBy: string = `${TableSchema.COLLECTION_TIMESTAMP} DESC`, limit: number = 100, offset: number = 0 : new Error(String(params: Record<string, string | number | boolean | null>[] = [], orderBy: string = `${TableSchema.COLLECTION_TIMESTAMP} DESC`, limit: number = 100, offset: number = 0 instanceof Error ? params: Record<string, string | number | boolean | null>[] = [], orderBy: string = `${TableSchema.COLLECTION_TIMESTAMP} DESC`, limit: number = 100, offset: number = 0 : new Error(String(params: Record<string, string | number | boolean | null>[] = [], orderBy: string = `${TableSchema.COLLECTION_TIMESTAMP} DESC`, limit: number = 100, offset: number = 0))))))): Promise<Collection[]> {
    try {
      const db = await this.databaseManager.getDatabase();
      let sql = `SELECT * FROM ${TableSchema.COLLECTION_TABLE}`;
      
      if (conditions) {
        sql += ` WHERE ${conditions}`;
      }
      
      sql += ` ORDER BY ${orderBy}`;
      
      if (limit > 0) {
        sql += ` LIMIT ${limit} OFFSET ${offset}`;
      }
      
      const resultSet = await db.querySql(sql, params);
      return this.parseResultSet(resultSet);
    } catch (error) {
      Logger.error(this.TAG, `Failed to query collections: ${error}`);
      return [];
    }
  }

  /**
   * Êü•ËØ¢ÂçïÊù°ËÆ∞ÂΩï
   * @param options Êü•ËØ¢ÈÄâÈ°π
   * @returns ÂçïÊù°Êî∂ËóèËÆ∞ÂΩïÊàñnull
   */
  public async queryOne(options: {
    conditions?: string;
    params?: Record<string, string | number | boolean | null>[];
    orderBy?: string;
  } = {} instanceof Error ? string | number | boolean | null>[];
    orderBy?: string;
  } = {} : new Error(String(string | number | boolean | null>[];
    orderBy?: string;
  } = {}))): Promise<Collection | null> {
    try {
      const { conditions = '', params = [], orderBy = `${TableSchema.COLLECTION_TIMESTAMP} DESC` } = options;
      const collections = await this.query(conditions, params, orderBy, 1 instanceof Error ? params = [], orderBy = `${TableSchema.COLLECTION_TIMESTAMP} DESC` } = options;
      const collections = await this.query(conditions, params, orderBy, 1 : new Error(String(params = [], orderBy = `${TableSchema.COLLECTION_TIMESTAMP} DESC` } = options;
      const collections = await this.query(conditions, params, orderBy, 1 instanceof Error ? params = [], orderBy = `${TableSchema.COLLECTION_TIMESTAMP} DESC` } = options;
      const collections = await this.query(conditions, params, orderBy, 1 instanceof Error ? params = [], orderBy = `${TableSchema.COLLECTION_TIMESTAMP} DESC` } = options;
      const collections = await this.query(conditions, params, orderBy, 1 : new Error(String(params = [], orderBy = `${TableSchema.COLLECTION_TIMESTAMP} DESC` } = options;
      const collections = await this.query(conditions, params, orderBy, 1 : new Error(String(params = [], orderBy = `${TableSchema.COLLECTION_TIMESTAMP} DESC` } = options;
      const collections = await this.query(conditions, params, orderBy, 1 instanceof Error ? params = [], orderBy = `${TableSchema.COLLECTION_TIMESTAMP} DESC` } = options;
      const collections = await this.query(conditions, params, orderBy, 1 : new Error(String(params = [], orderBy = `${TableSchema.COLLECTION_TIMESTAMP} DESC` } = options;
      const collections = await this.query(conditions, params, orderBy, 1)))));
      return collections.length > 0 ? collections[0] : null;
    } catch (error) {
      Logger.error(this.TAG, `Failed to query one collection: ${error}`);
      return null;
    }
  }
}

export default CollectionDao;


