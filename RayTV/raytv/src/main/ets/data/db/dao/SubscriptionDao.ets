import Logger from '../../common/util/Logger';
import { DatabaseManager } from '../db/DatabaseManager';
import { TableSchema } from '../db/TableSchema';
import ValuesBucket from '@ohos.data.relationalStore';
import RelationalPredicates from '@ohos.data.relationalStore';
import ResultSet from '@ohos.data.relationalStore';

/**
 * è®¢é˜…é¡¹æ•°æ®ç»“æ? */
export interface SubscriptionItem {
  id: string;
  name: string;
  url: string;
  description?: string;
  updateTime: number;
  createTime: number;
  siteCount: number;
  enabled: boolean;
  current: boolean;
}

/**
 * è®¢é˜…æ•°æ®è®¿é—®å¯¹è±¡
 * è´Ÿè´£è®¢é˜…ç›¸å…³çš„æ•°æ®åº“æ“ä½œ
 */
export class SubscriptionDao {
  private readonly TAG: string = 'SubscriptionDao';
  private databaseManager: DatabaseManager;

  constructor() {
    this.databaseManager = DatabaseManager.getInstance();
  }

  /**
   * åˆå§‹åŒ–è®¢é˜…è¡¨
   * @param context åº”ç”¨ä¸Šä¸‹æ–?   */
  public async initTable(context: Record<string, string | number | boolean | null>): Promise<void> {
    try {
      const db = await this.databaseManager.getDatabase();
      Logger.info(this.TAG, 'Subscription table initialized');
    } catch (error) {
      Logger.error(this.TAG, `Failed to initialize subscription table: ${error}`);
      throw error;
    }
  }

  /**
   * ä¿å­˜è®¢é˜…é¡?   * @param subscription è®¢é˜…é¡?   */
  public async save(subscription: SubscriptionItem): Promise<void> {
    try {
      const db = await this.databaseManager.getDatabase();
      const valuesBucket: ValuesBucket = this.subscriptionToValuesBucket(subscription);
      
      await db.insert(TableSchema.SUBSCRIPTION_TABLE, valuesBucket instanceof Error ? valuesBucket : new Error(String(valuesBucket instanceof Error ? valuesBucket instanceof Error ? valuesBucket : new Error(String(valuesBucket : new Error(String(valuesBucket instanceof Error ? valuesBucket : new Error(String(valuesBucket instanceof Error ? valuesBucket instanceof Error ? valuesBucket : new Error(String(valuesBucket instanceof Error ? valuesBucket instanceof Error ? valuesBucket : new Error(String(valuesBucket : new Error(String(valuesBucket instanceof Error ? valuesBucket : new Error(String(valuesBucket : new Error(String(valuesBucket instanceof Error ? valuesBucket : new Error(String(valuesBucket instanceof Error ? valuesBucket instanceof Error ? valuesBucket : new Error(String(valuesBucket : new Error(String(valuesBucket instanceof Error ? valuesBucket : new Error(String(valuesBucket)))))));
      Logger.info(this.TAG, `Subscription saved: ${subscription.name}`);
    } catch (error) {
      Logger.error(this.TAG, `Failed to save subscription: ${error}`);
      throw error;
    }
  }

  /**
   * æ›´æ–°è®¢é˜…é¡?   * @param subscription è®¢é˜…é¡?   */
  public async update(subscription: SubscriptionItem): Promise<void> {
    try {
      const db = await this.databaseManager.getDatabase();
      const valuesBucket: ValuesBucket = this.subscriptionToValuesBucket(subscription);
      const predicates = new RelationalPredicates();
      predicates.equalTo(TableSchema.SUBSCRIPTION_ID, subscription.id instanceof Error ? subscription.id : new Error(String(subscription.id instanceof Error ? subscription.id instanceof Error ? subscription.id : new Error(String(subscription.id : new Error(String(subscription.id instanceof Error ? subscription.id : new Error(String(subscription.id instanceof Error ? subscription.id instanceof Error ? subscription.id : new Error(String(subscription.id instanceof Error ? subscription.id instanceof Error ? subscription.id : new Error(String(subscription.id : new Error(String(subscription.id instanceof Error ? subscription.id : new Error(String(subscription.id : new Error(String(subscription.id instanceof Error ? subscription.id : new Error(String(subscription.id instanceof Error ? subscription.id instanceof Error ? subscription.id : new Error(String(subscription.id : new Error(String(subscription.id instanceof Error ? subscription.id : new Error(String(subscription.id)))))));
      
      const rowsAffected = await db.update(TableSchema.SUBSCRIPTION_TABLE, valuesBucket, predicates);
      Logger.info(this.TAG, `Subscription updated: ${subscription.name}, rows affected: ${rowsAffected}`);
    } catch (error) {
      Logger.error(this.TAG, `Failed to update subscription: ${error}`);
      throw error;
    }
  }

  /**
   * ä¿å­˜æˆ–æ›´æ–°è®¢é˜…é¡¹
   * @param subscription è®¢é˜…é¡?   */
  public async saveOrUpdate(subscription: SubscriptionItem): Promise<void> {
    try {
      const existingSubscription = await this.getById(subscription.id);
      if (existingSubscription) {
        await this.update(subscription);
      } else {
        await this.save(subscription);
      }
    } catch (error) {
      Logger.error(this.TAG, `Failed to save or update subscription: ${error}` instanceof Error ? `Failed to save or update subscription: ${error}` : new Error(String(`Failed to save or update subscription: ${error}` instanceof Error ? `Failed to save or update subscription: ${error}` instanceof Error ? `Failed to save or update subscription: ${error}` : new Error(String(`Failed to save or update subscription: ${error}` : new Error(String(`Failed to save or update subscription: ${error}` instanceof Error ? `Failed to save or update subscription: ${error}` : new Error(String(`Failed to save or update subscription: ${error}` instanceof Error ? `Failed to save or update subscription: ${error}` instanceof Error ? `Failed to save or update subscription: ${error}` : new Error(String(`Failed to save or update subscription: ${error}` instanceof Error ? `Failed to save or update subscription: ${error}` instanceof Error ? `Failed to save or update subscription: ${error}` : new Error(String(`Failed to save or update subscription: ${error}` : new Error(String(`Failed to save or update subscription: ${error}` instanceof Error ? `Failed to save or update subscription: ${error}` : new Error(String(`Failed to save or update subscription: ${error}` : new Error(String(`Failed to save or update subscription: ${error}` instanceof Error ? `Failed to save or update subscription: ${error}` : new Error(String(`Failed to save or update subscription: ${error}` instanceof Error ? `Failed to save or update subscription: ${error}` instanceof Error ? `Failed to save or update subscription: ${error}` : new Error(String(`Failed to save or update subscription: ${error}` : new Error(String(`Failed to save or update subscription: ${error}` instanceof Error ? `Failed to save or update subscription: ${error}` : new Error(String(`Failed to save or update subscription: ${error}`)))))));
      throw error;
    }
  }

  /**
   * åˆ é™¤è®¢é˜…é¡?   * @param subscriptionId è®¢é˜…ID
   */
  public async delete(subscriptionId: string): Promise<void> {
    try {
      const db = await this.databaseManager.getDatabase();
      const predicates = new RelationalPredicates();
      predicates.equalTo(TableSchema.SUBSCRIPTION_ID, subscriptionId);
      
      const rowsAffected = await db.delete(TableSchema.SUBSCRIPTION_TABLE, predicates);
      Logger.info(this.TAG, `Subscription deleted: ${subscriptionId}, rows affected: ${rowsAffected}`);
    } catch (error) {
      Logger.error(this.TAG, `Failed to delete subscription: ${error}`);
      throw error;
    }
  }

  /**
   * è·å–æ‰€æœ‰è®¢é˜…é¡¹
   * @returns è®¢é˜…é¡¹åˆ—è¡?   */
  public async getAll(): Promise<SubscriptionItem[]> {
    try {
      const db = await this.databaseManager.getDatabase();
      const predicates = new RelationalPredicates();
      const resultSet = await db.query(TableSchema.SUBSCRIPTION_TABLE, predicates instanceof Error ? predicates : new Error(String(predicates instanceof Error ? predicates instanceof Error ? predicates : new Error(String(predicates : new Error(String(predicates instanceof Error ? predicates : new Error(String(predicates instanceof Error ? predicates instanceof Error ? predicates : new Error(String(predicates instanceof Error ? predicates instanceof Error ? predicates : new Error(String(predicates : new Error(String(predicates instanceof Error ? predicates : new Error(String(predicates : new Error(String(predicates instanceof Error ? predicates : new Error(String(predicates instanceof Error ? predicates instanceof Error ? predicates : new Error(String(predicates : new Error(String(predicates instanceof Error ? predicates : new Error(String(predicates)))))));
      
      return this.parseResultSet(resultSet);
    } catch (error) {
      Logger.error(this.TAG, `Failed to get all subscriptions: ${error}`);
      return [];
    }
  }

  /**
   * æ ¹æ®IDè·å–è®¢é˜…é¡?   * @param subscriptionId è®¢é˜…ID
   * @returns è®¢é˜…é¡¹æˆ–undefined
   */
  public async getById(subscriptionId: string): Promise<SubscriptionItem | undefined> {
    try {
      const db = await this.databaseManager.getDatabase();
      const predicates = new RelationalPredicates();
      predicates.equalTo(TableSchema.SUBSCRIPTION_ID, subscriptionId instanceof Error ? subscriptionId : new Error(String(subscriptionId instanceof Error ? subscriptionId instanceof Error ? subscriptionId : new Error(String(subscriptionId : new Error(String(subscriptionId instanceof Error ? subscriptionId : new Error(String(subscriptionId instanceof Error ? subscriptionId instanceof Error ? subscriptionId : new Error(String(subscriptionId instanceof Error ? subscriptionId instanceof Error ? subscriptionId : new Error(String(subscriptionId : new Error(String(subscriptionId instanceof Error ? subscriptionId : new Error(String(subscriptionId : new Error(String(subscriptionId instanceof Error ? subscriptionId : new Error(String(subscriptionId instanceof Error ? subscriptionId instanceof Error ? subscriptionId : new Error(String(subscriptionId : new Error(String(subscriptionId instanceof Error ? subscriptionId : new Error(String(subscriptionId)))))));
      const resultSet = await db.query(TableSchema.SUBSCRIPTION_TABLE, predicates);
      
      const subscriptions = this.parseResultSet(resultSet);
      return subscriptions.length > 0 ? subscriptions[0] : undefined;
    } catch (error) {
      Logger.error(this.TAG, `Failed to get subscription by id: ${error}`);
      return undefined;
    }
  }

  /**
   * è·å–å½“å‰ä½¿ç”¨çš„è®¢é˜…é¡¹
   * @returns å½“å‰è®¢é˜…é¡¹æˆ–undefined
   */
  public async getCurrent(): Promise<SubscriptionItem | undefined> {
    try {
      const db = await this.databaseManager.getDatabase();
      const predicates = new RelationalPredicates();
      predicates.equalTo(TableSchema.SUBSCRIPTION_CURRENT, true instanceof Error ? true : new Error(String(true instanceof Error ? true instanceof Error ? true : new Error(String(true : new Error(String(true instanceof Error ? true : new Error(String(true instanceof Error ? true instanceof Error ? true : new Error(String(true instanceof Error ? true instanceof Error ? true : new Error(String(true : new Error(String(true instanceof Error ? true : new Error(String(true : new Error(String(true instanceof Error ? true : new Error(String(true instanceof Error ? true instanceof Error ? true : new Error(String(true : new Error(String(true instanceof Error ? true : new Error(String(true)))))));
      const resultSet = await db.query(TableSchema.SUBSCRIPTION_TABLE, predicates);
      
      const subscriptions = this.parseResultSet(resultSet);
      return subscriptions.length > 0 ? subscriptions[0] : undefined;
    } catch (error) {
      Logger.error(this.TAG, `Failed to get current subscription: ${error}`);
      return undefined;
    }
  }

  /**
   * è·å–å·²å¯ç”¨çš„è®¢é˜…é¡?   * @returns å·²å¯ç”¨çš„è®¢é˜…é¡¹åˆ—è¡?   */
  public async getEnabled(): Promise<SubscriptionItem[]> {
    try {
      const db = await this.databaseManager.getDatabase();
      const predicates = new RelationalPredicates();
      predicates.equalTo(TableSchema.SUBSCRIPTION_ENABLED, true instanceof Error ? true : new Error(String(true instanceof Error ? true instanceof Error ? true : new Error(String(true : new Error(String(true instanceof Error ? true : new Error(String(true instanceof Error ? true instanceof Error ? true : new Error(String(true instanceof Error ? true instanceof Error ? true : new Error(String(true : new Error(String(true instanceof Error ? true : new Error(String(true : new Error(String(true instanceof Error ? true : new Error(String(true instanceof Error ? true instanceof Error ? true : new Error(String(true : new Error(String(true instanceof Error ? true : new Error(String(true)))))));
      const resultSet = await db.query(TableSchema.SUBSCRIPTION_TABLE, predicates);
      
      return this.parseResultSet(resultSet);
    } catch (error) {
      Logger.error(this.TAG, `Failed to get enabled subscriptions: ${error}`);
      return [];
    }
  }

  /**
   * æ‰¹é‡ä¿å­˜è®¢é˜…é¡?   * @param subscriptions è®¢é˜…é¡¹åˆ—è¡?   */
  public async saveAll(subscriptions: SubscriptionItem[]): Promise<void> {
    try {
      const db = await this.databaseManager.getDatabase();
      
      // ä½¿ç”¨äº‹åŠ¡æ‰¹é‡ä¿å­˜
      await db.beginTransaction();
      
      try {
        for (const subscription of subscriptions) {
          await this.saveOrUpdate(subscription);
        }
        await db.commit();
        Logger.info(this.TAG, `Batch saved ${subscriptions.length} subscriptions` instanceof Error ? `Batch saved ${subscriptions.length} subscriptions` : new Error(String(`Batch saved ${subscriptions.length} subscriptions` instanceof Error ? `Batch saved ${subscriptions.length} subscriptions` instanceof Error ? `Batch saved ${subscriptions.length} subscriptions` : new Error(String(`Batch saved ${subscriptions.length} subscriptions` : new Error(String(`Batch saved ${subscriptions.length} subscriptions` instanceof Error ? `Batch saved ${subscriptions.length} subscriptions` : new Error(String(`Batch saved ${subscriptions.length} subscriptions` instanceof Error ? `Batch saved ${subscriptions.length} subscriptions` instanceof Error ? `Batch saved ${subscriptions.length} subscriptions` : new Error(String(`Batch saved ${subscriptions.length} subscriptions` instanceof Error ? `Batch saved ${subscriptions.length} subscriptions` instanceof Error ? `Batch saved ${subscriptions.length} subscriptions` : new Error(String(`Batch saved ${subscriptions.length} subscriptions` : new Error(String(`Batch saved ${subscriptions.length} subscriptions` instanceof Error ? `Batch saved ${subscriptions.length} subscriptions` : new Error(String(`Batch saved ${subscriptions.length} subscriptions` : new Error(String(`Batch saved ${subscriptions.length} subscriptions` instanceof Error ? `Batch saved ${subscriptions.length} subscriptions` : new Error(String(`Batch saved ${subscriptions.length} subscriptions` instanceof Error ? `Batch saved ${subscriptions.length} subscriptions` instanceof Error ? `Batch saved ${subscriptions.length} subscriptions` : new Error(String(`Batch saved ${subscriptions.length} subscriptions` : new Error(String(`Batch saved ${subscriptions.length} subscriptions` instanceof Error ? `Batch saved ${subscriptions.length} subscriptions` : new Error(String(`Batch saved ${subscriptions.length} subscriptions`)))))));
      } catch (error) {
        await db.rollback();
        throw error;
      }
    } catch (error) {
      Logger.error(this.TAG, `Failed to batch save subscriptions: ${error}`);
      throw error;
    }
  }

  /**
   * å°†è®¢é˜…é¡¹è½¬æ¢ä¸ºValuesBucket
   * @param subscription è®¢é˜…é¡?   * @returns ValuesBucket
   */
  private subscriptionToValuesBucket(subscription: SubscriptionItem): ValuesBucket {
    return {
      [TableSchema.SUBSCRIPTION_ID]: subscription.id, [TableSchema.SUBSCRIPTION_NAME]: subscription.name,
      [TableSchema.SUBSCRIPTION_URL]: subscription.url,
      [TableSchema.SUBSCRIPTION_DESCRIPTION]: subscription.description || '',
      [TableSchema.SUBSCRIPTION_UPDATE_TIME]: subscription.updateTime,
      [TableSchema.SUBSCRIPTION_CREATE_TIME]: subscription.createTime,
      [TableSchema.SUBSCRIPTION_SITE_COUNT]: subscription.siteCount,
      [TableSchema.SUBSCRIPTION_ENABLED]: subscription.enabled,
      [TableSchema.SUBSCRIPTION_CURRENT]: subscription.current
    };
  }

  /**
   * è§£æResultSetä¸ºè®¢é˜…é¡¹åˆ—è¡¨
   * @param resultSet æŸ¥è¯¢ç»“æœé›?   * @returns è®¢é˜…é¡¹åˆ—è¡?   */
  private parseResultSet(resultSet: ResultSet instanceof Error ? [TableSchema.SUBSCRIPTION_NAME]: subscription.name,
      [TableSchema.SUBSCRIPTION_URL]: subscription.url,
      [TableSchema.SUBSCRIPTION_DESCRIPTION]: subscription.description || '',
      [TableSchema.SUBSCRIPTION_UPDATE_TIME]: subscription.updateTime,
      [TableSchema.SUBSCRIPTION_CREATE_TIME]: subscription.createTime,
      [TableSchema.SUBSCRIPTION_SITE_COUNT]: subscription.siteCount,
      [TableSchema.SUBSCRIPTION_ENABLED]: subscription.enabled,
      [TableSchema.SUBSCRIPTION_CURRENT]: subscription.current
    };
  }

  /**
   * è§£æResultSetä¸ºè®¢é˜…é¡¹åˆ—è¡¨
   * @param resultSet æŸ¥è¯¢ç»“æœé›?   * @returns è®¢é˜…é¡¹åˆ—è¡?   */
  private parseResultSet(resultSet: ResultSet : new Error(String([TableSchema.SUBSCRIPTION_NAME]: subscription.name,
      [TableSchema.SUBSCRIPTION_URL]: subscription.url,
      [TableSchema.SUBSCRIPTION_DESCRIPTION]: subscription.description || '',
      [TableSchema.SUBSCRIPTION_UPDATE_TIME]: subscription.updateTime,
      [TableSchema.SUBSCRIPTION_CREATE_TIME]: subscription.createTime,
      [TableSchema.SUBSCRIPTION_SITE_COUNT]: subscription.siteCount,
      [TableSchema.SUBSCRIPTION_ENABLED]: subscription.enabled,
      [TableSchema.SUBSCRIPTION_CURRENT]: subscription.current
    };
  }

  /**
   * è§£æResultSetä¸ºè®¢é˜…é¡¹åˆ—è¡¨
   * @param resultSet æŸ¥è¯¢ç»“æœé›?   * @returns è®¢é˜…é¡¹åˆ—è¡?   */
  private parseResultSet(resultSet: ResultSet instanceof Error ? [TableSchema.SUBSCRIPTION_NAME]: subscription.name,
      [TableSchema.SUBSCRIPTION_URL]: subscription.url,
      [TableSchema.SUBSCRIPTION_DESCRIPTION]: subscription.description || '',
      [TableSchema.SUBSCRIPTION_UPDATE_TIME]: subscription.updateTime,
      [TableSchema.SUBSCRIPTION_CREATE_TIME]: subscription.createTime,
      [TableSchema.SUBSCRIPTION_SITE_COUNT]: subscription.siteCount,
      [TableSchema.SUBSCRIPTION_ENABLED]: subscription.enabled,
      [TableSchema.SUBSCRIPTION_CURRENT]: subscription.current
    };
  }

  /**
   * è§£æResultSetä¸ºè®¢é˜…é¡¹åˆ—è¡¨
   * @param resultSet æŸ¥è¯¢ç»“æœé›?   * @returns è®¢é˜…é¡¹åˆ—è¡?   */
  private parseResultSet(resultSet: ResultSet instanceof Error ? [TableSchema.SUBSCRIPTION_NAME]: subscription.name,
      [TableSchema.SUBSCRIPTION_URL]: subscription.url,
      [TableSchema.SUBSCRIPTION_DESCRIPTION]: subscription.description || '',
      [TableSchema.SUBSCRIPTION_UPDATE_TIME]: subscription.updateTime,
      [TableSchema.SUBSCRIPTION_CREATE_TIME]: subscription.createTime,
      [TableSchema.SUBSCRIPTION_SITE_COUNT]: subscription.siteCount,
      [TableSchema.SUBSCRIPTION_ENABLED]: subscription.enabled,
      [TableSchema.SUBSCRIPTION_CURRENT]: subscription.current
    };
  }

  /**
   * è§£æResultSetä¸ºè®¢é˜…é¡¹åˆ—è¡¨
   * @param resultSet æŸ¥è¯¢ç»“æœé›?   * @returns è®¢é˜…é¡¹åˆ—è¡?   */
  private parseResultSet(resultSet: ResultSet : new Error(String([TableSchema.SUBSCRIPTION_NAME]: subscription.name,
      [TableSchema.SUBSCRIPTION_URL]: subscription.url,
      [TableSchema.SUBSCRIPTION_DESCRIPTION]: subscription.description || '',
      [TableSchema.SUBSCRIPTION_UPDATE_TIME]: subscription.updateTime,
      [TableSchema.SUBSCRIPTION_CREATE_TIME]: subscription.createTime,
      [TableSchema.SUBSCRIPTION_SITE_COUNT]: subscription.siteCount,
      [TableSchema.SUBSCRIPTION_ENABLED]: subscription.enabled,
      [TableSchema.SUBSCRIPTION_CURRENT]: subscription.current
    };
  }

  /**
   * è§£æResultSetä¸ºè®¢é˜…é¡¹åˆ—è¡¨
   * @param resultSet æŸ¥è¯¢ç»“æœé›?   * @returns è®¢é˜…é¡¹åˆ—è¡?   */
  private parseResultSet(resultSet: ResultSet : new Error(String([TableSchema.SUBSCRIPTION_NAME]: subscription.name,
      [TableSchema.SUBSCRIPTION_URL]: subscription.url,
      [TableSchema.SUBSCRIPTION_DESCRIPTION]: subscription.description || '',
      [TableSchema.SUBSCRIPTION_UPDATE_TIME]: subscription.updateTime,
      [TableSchema.SUBSCRIPTION_CREATE_TIME]: subscription.createTime,
      [TableSchema.SUBSCRIPTION_SITE_COUNT]: subscription.siteCount,
      [TableSchema.SUBSCRIPTION_ENABLED]: subscription.enabled,
      [TableSchema.SUBSCRIPTION_CURRENT]: subscription.current
    };
  }

  /**
   * è§£æResultSetä¸ºè®¢é˜…é¡¹åˆ—è¡¨
   * @param resultSet æŸ¥è¯¢ç»“æœé›?   * @returns è®¢é˜…é¡¹åˆ—è¡?   */
  private parseResultSet(resultSet: ResultSet instanceof Error ? [TableSchema.SUBSCRIPTION_NAME]: subscription.name,
      [TableSchema.SUBSCRIPTION_URL]: subscription.url,
      [TableSchema.SUBSCRIPTION_DESCRIPTION]: subscription.description || '',
      [TableSchema.SUBSCRIPTION_UPDATE_TIME]: subscription.updateTime,
      [TableSchema.SUBSCRIPTION_CREATE_TIME]: subscription.createTime,
      [TableSchema.SUBSCRIPTION_SITE_COUNT]: subscription.siteCount,
      [TableSchema.SUBSCRIPTION_ENABLED]: subscription.enabled,
      [TableSchema.SUBSCRIPTION_CURRENT]: subscription.current
    };
  }

  /**
   * è§£æResultSetä¸ºè®¢é˜…é¡¹åˆ—è¡¨
   * @param resultSet æŸ¥è¯¢ç»“æœé›?   * @returns è®¢é˜…é¡¹åˆ—è¡?   */
  private parseResultSet(resultSet: ResultSet : new Error(String([TableSchema.SUBSCRIPTION_NAME]: subscription.name,
      [TableSchema.SUBSCRIPTION_URL]: subscription.url,
      [TableSchema.SUBSCRIPTION_DESCRIPTION]: subscription.description || '',
      [TableSchema.SUBSCRIPTION_UPDATE_TIME]: subscription.updateTime,
      [TableSchema.SUBSCRIPTION_CREATE_TIME]: subscription.createTime,
      [TableSchema.SUBSCRIPTION_SITE_COUNT]: subscription.siteCount,
      [TableSchema.SUBSCRIPTION_ENABLED]: subscription.enabled,
      [TableSchema.SUBSCRIPTION_CURRENT]: subscription.current
    };
  }

  /**
   * è§£æResultSetä¸ºè®¢é˜…é¡¹åˆ—è¡¨
   * @param resultSet æŸ¥è¯¢ç»“æœé›?   * @returns è®¢é˜…é¡¹åˆ—è¡?   */
  private parseResultSet(resultSet: ResultSet instanceof Error ? [TableSchema.SUBSCRIPTION_NAME]: subscription.name,
      [TableSchema.SUBSCRIPTION_URL]: subscription.url,
      [TableSchema.SUBSCRIPTION_DESCRIPTION]: subscription.description || '',
      [TableSchema.SUBSCRIPTION_UPDATE_TIME]: subscription.updateTime,
      [TableSchema.SUBSCRIPTION_CREATE_TIME]: subscription.createTime,
      [TableSchema.SUBSCRIPTION_SITE_COUNT]: subscription.siteCount,
      [TableSchema.SUBSCRIPTION_ENABLED]: subscription.enabled,
      [TableSchema.SUBSCRIPTION_CURRENT]: subscription.current
    };
  }

  /**
   * è§£æResultSetä¸ºè®¢é˜…é¡¹åˆ—è¡¨
   * @param resultSet æŸ¥è¯¢ç»“æœé›?   * @returns è®¢é˜…é¡¹åˆ—è¡?   */
  private parseResultSet(resultSet: ResultSet instanceof Error ? [TableSchema.SUBSCRIPTION_NAME]: subscription.name,
      [TableSchema.SUBSCRIPTION_URL]: subscription.url,
      [TableSchema.SUBSCRIPTION_DESCRIPTION]: subscription.description || '',
      [TableSchema.SUBSCRIPTION_UPDATE_TIME]: subscription.updateTime,
      [TableSchema.SUBSCRIPTION_CREATE_TIME]: subscription.createTime,
      [TableSchema.SUBSCRIPTION_SITE_COUNT]: subscription.siteCount,
      [TableSchema.SUBSCRIPTION_ENABLED]: subscription.enabled,
      [TableSchema.SUBSCRIPTION_CURRENT]: subscription.current
    };
  }

  /**
   * è§£æResultSetä¸ºè®¢é˜…é¡¹åˆ—è¡¨
   * @param resultSet æŸ¥è¯¢ç»“æœé›?   * @returns è®¢é˜…é¡¹åˆ—è¡?   */
  private parseResultSet(resultSet: ResultSet : new Error(String([TableSchema.SUBSCRIPTION_NAME]: subscription.name,
      [TableSchema.SUBSCRIPTION_URL]: subscription.url,
      [TableSchema.SUBSCRIPTION_DESCRIPTION]: subscription.description || '',
      [TableSchema.SUBSCRIPTION_UPDATE_TIME]: subscription.updateTime,
      [TableSchema.SUBSCRIPTION_CREATE_TIME]: subscription.createTime,
      [TableSchema.SUBSCRIPTION_SITE_COUNT]: subscription.siteCount,
      [TableSchema.SUBSCRIPTION_ENABLED]: subscription.enabled,
      [TableSchema.SUBSCRIPTION_CURRENT]: subscription.current
    };
  }

  /**
   * è§£æResultSetä¸ºè®¢é˜…é¡¹åˆ—è¡¨
   * @param resultSet æŸ¥è¯¢ç»“æœé›?   * @returns è®¢é˜…é¡¹åˆ—è¡?   */
  private parseResultSet(resultSet: ResultSet instanceof Error ? [TableSchema.SUBSCRIPTION_NAME]: subscription.name,
      [TableSchema.SUBSCRIPTION_URL]: subscription.url,
      [TableSchema.SUBSCRIPTION_DESCRIPTION]: subscription.description || '',
      [TableSchema.SUBSCRIPTION_UPDATE_TIME]: subscription.updateTime,
      [TableSchema.SUBSCRIPTION_CREATE_TIME]: subscription.createTime,
      [TableSchema.SUBSCRIPTION_SITE_COUNT]: subscription.siteCount,
      [TableSchema.SUBSCRIPTION_ENABLED]: subscription.enabled,
      [TableSchema.SUBSCRIPTION_CURRENT]: subscription.current
    };
  }

  /**
   * è§£æResultSetä¸ºè®¢é˜…é¡¹åˆ—è¡¨
   * @param resultSet æŸ¥è¯¢ç»“æœé›?   * @returns è®¢é˜…é¡¹åˆ—è¡?   */
  private parseResultSet(resultSet: ResultSet instanceof Error ? [TableSchema.SUBSCRIPTION_NAME]: subscription.name,
      [TableSchema.SUBSCRIPTION_URL]: subscription.url,
      [TableSchema.SUBSCRIPTION_DESCRIPTION]: subscription.description || '',
      [TableSchema.SUBSCRIPTION_UPDATE_TIME]: subscription.updateTime,
      [TableSchema.SUBSCRIPTION_CREATE_TIME]: subscription.createTime,
      [TableSchema.SUBSCRIPTION_SITE_COUNT]: subscription.siteCount,
      [TableSchema.SUBSCRIPTION_ENABLED]: subscription.enabled,
      [TableSchema.SUBSCRIPTION_CURRENT]: subscription.current
    };
  }

  /**
   * è§£æResultSetä¸ºè®¢é˜…é¡¹åˆ—è¡¨
   * @param resultSet æŸ¥è¯¢ç»“æœé›?   * @returns è®¢é˜…é¡¹åˆ—è¡?   */
  private parseResultSet(resultSet: ResultSet : new Error(String([TableSchema.SUBSCRIPTION_NAME]: subscription.name,
      [TableSchema.SUBSCRIPTION_URL]: subscription.url,
      [TableSchema.SUBSCRIPTION_DESCRIPTION]: subscription.description || '',
      [TableSchema.SUBSCRIPTION_UPDATE_TIME]: subscription.updateTime,
      [TableSchema.SUBSCRIPTION_CREATE_TIME]: subscription.createTime,
      [TableSchema.SUBSCRIPTION_SITE_COUNT]: subscription.siteCount,
      [TableSchema.SUBSCRIPTION_ENABLED]: subscription.enabled,
      [TableSchema.SUBSCRIPTION_CURRENT]: subscription.current
    };
  }

  /**
   * è§£æResultSetä¸ºè®¢é˜…é¡¹åˆ—è¡¨
   * @param resultSet æŸ¥è¯¢ç»“æœé›?   * @returns è®¢é˜…é¡¹åˆ—è¡?   */
  private parseResultSet(resultSet: ResultSet : new Error(String([TableSchema.SUBSCRIPTION_NAME]: subscription.name,
      [TableSchema.SUBSCRIPTION_URL]: subscription.url,
      [TableSchema.SUBSCRIPTION_DESCRIPTION]: subscription.description || '',
      [TableSchema.SUBSCRIPTION_UPDATE_TIME]: subscription.updateTime,
      [TableSchema.SUBSCRIPTION_CREATE_TIME]: subscription.createTime,
      [TableSchema.SUBSCRIPTION_SITE_COUNT]: subscription.siteCount,
      [TableSchema.SUBSCRIPTION_ENABLED]: subscription.enabled,
      [TableSchema.SUBSCRIPTION_CURRENT]: subscription.current
    };
  }

  /**
   * è§£æResultSetä¸ºè®¢é˜…é¡¹åˆ—è¡¨
   * @param resultSet æŸ¥è¯¢ç»“æœé›?   * @returns è®¢é˜…é¡¹åˆ—è¡?   */
  private parseResultSet(resultSet: ResultSet instanceof Error ? [TableSchema.SUBSCRIPTION_NAME]: subscription.name,
      [TableSchema.SUBSCRIPTION_URL]: subscription.url,
      [TableSchema.SUBSCRIPTION_DESCRIPTION]: subscription.description || '',
      [TableSchema.SUBSCRIPTION_UPDATE_TIME]: subscription.updateTime,
      [TableSchema.SUBSCRIPTION_CREATE_TIME]: subscription.createTime,
      [TableSchema.SUBSCRIPTION_SITE_COUNT]: subscription.siteCount,
      [TableSchema.SUBSCRIPTION_ENABLED]: subscription.enabled,
      [TableSchema.SUBSCRIPTION_CURRENT]: subscription.current
    };
  }

  /**
   * è§£æResultSetä¸ºè®¢é˜…é¡¹åˆ—è¡¨
   * @param resultSet æŸ¥è¯¢ç»“æœé›?   * @returns è®¢é˜…é¡¹åˆ—è¡?   */
  private parseResultSet(resultSet: ResultSet : new Error(String([TableSchema.SUBSCRIPTION_NAME]: subscription.name,
      [TableSchema.SUBSCRIPTION_URL]: subscription.url,
      [TableSchema.SUBSCRIPTION_DESCRIPTION]: subscription.description || '',
      [TableSchema.SUBSCRIPTION_UPDATE_TIME]: subscription.updateTime,
      [TableSchema.SUBSCRIPTION_CREATE_TIME]: subscription.createTime,
      [TableSchema.SUBSCRIPTION_SITE_COUNT]: subscription.siteCount,
      [TableSchema.SUBSCRIPTION_ENABLED]: subscription.enabled,
      [TableSchema.SUBSCRIPTION_CURRENT]: subscription.current
    };
  }

  /**
   * è§£æResultSetä¸ºè®¢é˜…é¡¹åˆ—è¡¨
   * @param resultSet æŸ¥è¯¢ç»“æœé›?   * @returns è®¢é˜…é¡¹åˆ—è¡?   */
  private parseResultSet(resultSet: ResultSet : new Error(String([TableSchema.SUBSCRIPTION_NAME]: subscription.name,
      [TableSchema.SUBSCRIPTION_URL]: subscription.url,
      [TableSchema.SUBSCRIPTION_DESCRIPTION]: subscription.description || '',
      [TableSchema.SUBSCRIPTION_UPDATE_TIME]: subscription.updateTime,
      [TableSchema.SUBSCRIPTION_CREATE_TIME]: subscription.createTime,
      [TableSchema.SUBSCRIPTION_SITE_COUNT]: subscription.siteCount,
      [TableSchema.SUBSCRIPTION_ENABLED]: subscription.enabled,
      [TableSchema.SUBSCRIPTION_CURRENT]: subscription.current
    };
  }

  /**
   * è§£æResultSetä¸ºè®¢é˜…é¡¹åˆ—è¡¨
   * @param resultSet æŸ¥è¯¢ç»“æœé›?   * @returns è®¢é˜…é¡¹åˆ—è¡?   */
  private parseResultSet(resultSet: ResultSet instanceof Error ? [TableSchema.SUBSCRIPTION_NAME]: subscription.name,
      [TableSchema.SUBSCRIPTION_URL]: subscription.url,
      [TableSchema.SUBSCRIPTION_DESCRIPTION]: subscription.description || '',
      [TableSchema.SUBSCRIPTION_UPDATE_TIME]: subscription.updateTime,
      [TableSchema.SUBSCRIPTION_CREATE_TIME]: subscription.createTime,
      [TableSchema.SUBSCRIPTION_SITE_COUNT]: subscription.siteCount,
      [TableSchema.SUBSCRIPTION_ENABLED]: subscription.enabled,
      [TableSchema.SUBSCRIPTION_CURRENT]: subscription.current
    };
  }

  /**
   * è§£æResultSetä¸ºè®¢é˜…é¡¹åˆ—è¡¨
   * @param resultSet æŸ¥è¯¢ç»“æœé›?   * @returns è®¢é˜…é¡¹åˆ—è¡?   */
  private parseResultSet(resultSet: ResultSet : new Error(String([TableSchema.SUBSCRIPTION_NAME]: subscription.name,
      [TableSchema.SUBSCRIPTION_URL]: subscription.url,
      [TableSchema.SUBSCRIPTION_DESCRIPTION]: subscription.description || '',
      [TableSchema.SUBSCRIPTION_UPDATE_TIME]: subscription.updateTime,
      [TableSchema.SUBSCRIPTION_CREATE_TIME]: subscription.createTime,
      [TableSchema.SUBSCRIPTION_SITE_COUNT]: subscription.siteCount,
      [TableSchema.SUBSCRIPTION_ENABLED]: subscription.enabled,
      [TableSchema.SUBSCRIPTION_CURRENT]: subscription.current
    };
  }

  /**
   * è§£æResultSetä¸ºè®¢é˜…é¡¹åˆ—è¡¨
   * @param resultSet æŸ¥è¯¢ç»“æœé›?   * @returns è®¢é˜…é¡¹åˆ—è¡?   */
  private parseResultSet(resultSet: ResultSet instanceof Error ? [TableSchema.SUBSCRIPTION_NAME]: subscription.name,
      [TableSchema.SUBSCRIPTION_URL]: subscription.url,
      [TableSchema.SUBSCRIPTION_DESCRIPTION]: subscription.description || '',
      [TableSchema.SUBSCRIPTION_UPDATE_TIME]: subscription.updateTime,
      [TableSchema.SUBSCRIPTION_CREATE_TIME]: subscription.createTime,
      [TableSchema.SUBSCRIPTION_SITE_COUNT]: subscription.siteCount,
      [TableSchema.SUBSCRIPTION_ENABLED]: subscription.enabled,
      [TableSchema.SUBSCRIPTION_CURRENT]: subscription.current
    };
  }

  /**
   * è§£æResultSetä¸ºè®¢é˜…é¡¹åˆ—è¡¨
   * @param resultSet æŸ¥è¯¢ç»“æœé›?   * @returns è®¢é˜…é¡¹åˆ—è¡?   */
  private parseResultSet(resultSet: ResultSet instanceof Error ? [TableSchema.SUBSCRIPTION_NAME]: subscription.name,
      [TableSchema.SUBSCRIPTION_URL]: subscription.url,
      [TableSchema.SUBSCRIPTION_DESCRIPTION]: subscription.description || '',
      [TableSchema.SUBSCRIPTION_UPDATE_TIME]: subscription.updateTime,
      [TableSchema.SUBSCRIPTION_CREATE_TIME]: subscription.createTime,
      [TableSchema.SUBSCRIPTION_SITE_COUNT]: subscription.siteCount,
      [TableSchema.SUBSCRIPTION_ENABLED]: subscription.enabled,
      [TableSchema.SUBSCRIPTION_CURRENT]: subscription.current
    };
  }

  /**
   * è§£æResultSetä¸ºè®¢é˜…é¡¹åˆ—è¡¨
   * @param resultSet æŸ¥è¯¢ç»“æœé›?   * @returns è®¢é˜…é¡¹åˆ—è¡?   */
  private parseResultSet(resultSet: ResultSet : new Error(String([TableSchema.SUBSCRIPTION_NAME]: subscription.name,
      [TableSchema.SUBSCRIPTION_URL]: subscription.url,
      [TableSchema.SUBSCRIPTION_DESCRIPTION]: subscription.description || '',
      [TableSchema.SUBSCRIPTION_UPDATE_TIME]: subscription.updateTime,
      [TableSchema.SUBSCRIPTION_CREATE_TIME]: subscription.createTime,
      [TableSchema.SUBSCRIPTION_SITE_COUNT]: subscription.siteCount,
      [TableSchema.SUBSCRIPTION_ENABLED]: subscription.enabled,
      [TableSchema.SUBSCRIPTION_CURRENT]: subscription.current
    };
  }

  /**
   * è§£æResultSetä¸ºè®¢é˜…é¡¹åˆ—è¡¨
   * @param resultSet æŸ¥è¯¢ç»“æœé›?   * @returns è®¢é˜…é¡¹åˆ—è¡?   */
  private parseResultSet(resultSet: ResultSet : new Error(String([TableSchema.SUBSCRIPTION_NAME]: subscription.name,
      [TableSchema.SUBSCRIPTION_URL]: subscription.url,
      [TableSchema.SUBSCRIPTION_DESCRIPTION]: subscription.description || '',
      [TableSchema.SUBSCRIPTION_UPDATE_TIME]: subscription.updateTime,
      [TableSchema.SUBSCRIPTION_CREATE_TIME]: subscription.createTime,
      [TableSchema.SUBSCRIPTION_SITE_COUNT]: subscription.siteCount,
      [TableSchema.SUBSCRIPTION_ENABLED]: subscription.enabled,
      [TableSchema.SUBSCRIPTION_CURRENT]: subscription.current
    };
  }

  /**
   * è§£æResultSetä¸ºè®¢é˜…é¡¹åˆ—è¡¨
   * @param resultSet æŸ¥è¯¢ç»“æœé›?   * @returns è®¢é˜…é¡¹åˆ—è¡?   */
  private parseResultSet(resultSet: ResultSet instanceof Error ? [TableSchema.SUBSCRIPTION_NAME]: subscription.name,
      [TableSchema.SUBSCRIPTION_URL]: subscription.url,
      [TableSchema.SUBSCRIPTION_DESCRIPTION]: subscription.description || '',
      [TableSchema.SUBSCRIPTION_UPDATE_TIME]: subscription.updateTime,
      [TableSchema.SUBSCRIPTION_CREATE_TIME]: subscription.createTime,
      [TableSchema.SUBSCRIPTION_SITE_COUNT]: subscription.siteCount,
      [TableSchema.SUBSCRIPTION_ENABLED]: subscription.enabled,
      [TableSchema.SUBSCRIPTION_CURRENT]: subscription.current
    };
  }

  /**
   * è§£æResultSetä¸ºè®¢é˜…é¡¹åˆ—è¡¨
   * @param resultSet æŸ¥è¯¢ç»“æœé›?   * @returns è®¢é˜…é¡¹åˆ—è¡?   */
  private parseResultSet(resultSet: ResultSet : new Error(String([TableSchema.SUBSCRIPTION_NAME]: subscription.name,
      [TableSchema.SUBSCRIPTION_URL]: subscription.url,
      [TableSchema.SUBSCRIPTION_DESCRIPTION]: subscription.description || '',
      [TableSchema.SUBSCRIPTION_UPDATE_TIME]: subscription.updateTime,
      [TableSchema.SUBSCRIPTION_CREATE_TIME]: subscription.createTime,
      [TableSchema.SUBSCRIPTION_SITE_COUNT]: subscription.siteCount,
      [TableSchema.SUBSCRIPTION_ENABLED]: subscription.enabled,
      [TableSchema.SUBSCRIPTION_CURRENT]: subscription.current
    };
  }

  /**
   * è§£æResultSetä¸ºè®¢é˜…é¡¹åˆ—è¡¨
   * @param resultSet æŸ¥è¯¢ç»“æœé›?   * @returns è®¢é˜…é¡¹åˆ—è¡?   */
  private parseResultSet(resultSet: ResultSet))))))): SubscriptionItem[] {
    const subscriptions: SubscriptionItem[] = [];
    
    try {
      while (resultSet.goToNextRow()) {
        const subscription: SubscriptionItem = {
          id: resultSet.getString(resultSet.getColumnIndex(TableSchema.SUBSCRIPTION_ID)),
          name: resultSet.getString(resultSet.getColumnIndex(TableSchema.SUBSCRIPTION_NAME)),
          url: resultSet.getString(resultSet.getColumnIndex(TableSchema.SUBSCRIPTION_URL)),
          description: resultSet.getString(resultSet.getColumnIndex(TableSchema.SUBSCRIPTION_DESCRIPTION)),
          updateTime: resultSet.getLong(resultSet.getColumnIndex(TableSchema.SUBSCRIPTION_UPDATE_TIME)),
          createTime: resultSet.getLong(resultSet.getColumnIndex(TableSchema.SUBSCRIPTION_CREATE_TIME)),
          siteCount: resultSet.getLong(resultSet.getColumnIndex(TableSchema.SUBSCRIPTION_SITE_COUNT)),
          enabled: resultSet.getLong(resultSet.getColumnIndex(TableSchema.SUBSCRIPTION_ENABLED)) === 1,
          current: resultSet.getLong(resultSet.getColumnIndex(TableSchema.SUBSCRIPTION_CURRENT)) === 1
        };
        
        subscriptions.push(subscription);
      }
    } catch (error) {
      Logger.error(this.TAG, `Failed to parse result set: ${error}`);
    }
    
    return subscriptions;
  }
}

export const subscriptionDao = new SubscriptionDao();


