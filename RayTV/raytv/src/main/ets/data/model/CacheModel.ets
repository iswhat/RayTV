// CacheModel - ç¼“å­˜ç›¸å…³æ¨¡å‹å®šä¹‰
// å®šä¹‰åº”ç”¨ç¼“å­˜ã€æ•°æ®ç¼“å­˜ç­‰ç›¸å…³çš„æ•°æ®æ¨¡å?

/**
 * ç¼“å­˜å€¼ç±»å‹åˆ«å?- æ”¯æŒçš„å…·ä½“ç¼“å­˜æ•°æ®ç±»å?
 */
export type CacheValue =
  | string              // å­—ç¬¦ä¸?
  | number              // æ•°å­—
  | boolean             // å¸ƒå°”å€?
  | ArrayBuffer         // äºŒè¿›åˆ¶æ•°æ?
  | Object              // å¯¹è±¡ç±»å‹ (ä½¿ç”¨Objectæ›¿ä»£Record<string, unknown>ç¬¦åˆArkTSè§„èŒƒ)
  | string[]            // å­—ç¬¦ä¸²æ•°ç»?
  | number[]            // æ•°å­—æ•°ç»„
  | boolean[];          // å¸ƒå°”å€¼æ•°ç»?

/**
 * ç¼“å­˜ç±»å‹æšä¸¾
 */
export enum CacheType {
  /**
   * å†…å­˜ç¼“å­˜
   */
  MEMORY = 'memory',
  
  /**
   * ç£ç›˜ç¼“å­˜
   */
  DISK = 'disk',
  
  /**
   * ç½‘ç»œç¼“å­˜
   */
  NETWORK = 'network',
  
  /**
   * å›¾ç‰‡ç¼“å­˜
   */
  IMAGE = 'image',
  
  /**
   * è§†é¢‘ç¼“å­˜
   */
  VIDEO = 'video',
  
  /**
   * éŸ³é¢‘ç¼“å­˜
   */
  AUDIO = 'audio',
  
  /**
   * æ–‡æœ¬ç¼“å­˜
   */
  TEXT = 'text',
  
  /**
   * JSONç¼“å­˜
   */
  JSON = 'json',
  
  /**
   * å­—å¹•ç¼“å­˜
   */
  SUBTITLE = 'subtitle',
  
  /**
   * ä¸´æ—¶ç¼“å­˜
   */
  TEMPORARY = 'temporary',
  
  /**
   * åº”ç”¨ç¼“å­˜
   */
  APP = 'app'
}

/**
 * ç¼“å­˜ç­–ç•¥æšä¸¾
 */
export enum CacheStrategy {
  /**
   * ä»…å†…å­?
   */
  MEMORY_ONLY = 'memory_only',
  
  /**
   * ä»…ç£ç›?
   */
  DISK_ONLY = 'disk_only',
  
  /**
   * å†…å­˜ä¼˜å…ˆ
   */
  MEMORY_FIRST = 'memory_first',
  
  /**
   * ç£ç›˜ä¼˜å…ˆ
   */
  DISK_FIRST = 'disk_first',
  
  /**
   * åŒé‡ç¼“å­˜
   */
  BOTH = 'both',
  
  /**
   * è‡ªå®šä¹?
   */
  CUSTOM = 'custom'
}

/**
 * ç¼“å­˜ä¼˜å…ˆçº§æšä¸?
 */
export enum CachePriority {
  /**
   * ä½ä¼˜å…ˆçº§
   */
  LOW = 'low',
  
  /**
   * ä¸­ä¼˜å…ˆçº§
   */
  MEDIUM = 'medium',
  
  /**
   * é«˜ä¼˜å…ˆçº§
   */
  HIGH = 'high',
  
  /**
   * æœ€é«˜ä¼˜å…ˆçº§
   */
  HIGHEST = 'highest',
  
  /**
   * æŒä¹…åŒ–ï¼ˆæ°¸ä¸è‡ªåŠ¨æ¸…é™¤ï¼?
   */
  PERSISTENT = 'persistent'
}

/**
 * ç¼“å­˜é¡¹æ¥å?
 */
export interface CacheItem {
  /**
   * ç¼“å­˜é”?
   */
  key: string;
  
  /**
   * ç¼“å­˜å€?
   */
  value: CacheValue;
  
  /**
   * ç¼“å­˜ç±»å‹
   */
  type: CacheType;
  
  /**
   * åˆ›å»ºæ—¶é—´
   */
  createdAt: number;
  
  /**
   * æœ€åè®¿é—®æ—¶é—?
   */
  lastAccessedAt: number;
  
  /**
   * è¿‡æœŸæ—¶é—´
   */
  expiresAt?: number;
  
  /**
   * æ•°æ®å¤§å°ï¼ˆå­—èŠ‚ï¼‰
   */
  size: number;
  
  /**
   * ä¼˜å…ˆçº?
   */
  priority: CachePriority;
  
  /**
   * è®¿é—®æ¬¡æ•°
   */
  accessCount: number;
  
  /**
   * ç¼“å­˜ç‰ˆæœ¬
   */
  version?: string;
  
  /**
   * æ˜¯å¦åŠ å¯†
   */
  encrypted: boolean;
  
  /**
   * æ ‡ç­¾
   */
  tags?: string[];
}

/**
 * ç¼“å­˜å…ƒæ•°æ®æ¥å?
 */
export interface CacheMetadata {
  /**
   * ç¼“å­˜é”?
   */
  key: string;
  
  /**
   * ç¼“å­˜ç±»å‹
   */
  type: CacheType;
  
  /**
   * åˆ›å»ºæ—¶é—´
   */
  createdAt: number;
  
  /**
   * æœ€åè®¿é—®æ—¶é—?
   */
  lastAccessedAt: number;
  
  /**
   * è¿‡æœŸæ—¶é—´
   */
  expiresAt?: number;
  
  /**
   * æ•°æ®å¤§å°ï¼ˆå­—èŠ‚ï¼‰
   */
  size: number;
  
  /**
   * ä¼˜å…ˆçº?
   */
  priority: CachePriority;
  
  /**
   * è®¿é—®æ¬¡æ•°
   */
  accessCount: number;
  
  /**
   * æ˜¯å¦å‹ç¼©
   */
  compressed: boolean;
  
  /**
   * æ˜¯å¦åŠ å¯†
   */
  encrypted: boolean;
  
  /**
   * ç¼“å­˜ç­–ç•¥
   */
  strategy: CacheStrategy;
  
  /**
   * æ¥æº
   */
  source?: string;
}

/**
 * ç¼“å­˜é…ç½®æ¥å£
 */
export interface CacheConfig {
  /**
   * ç¼“å­˜åç§°
   */
  name: string;
  
  /**
   * ç¼“å­˜è·¯å¾„
   */
  path: string;
  
  /**
   * æœ€å¤§ç¼“å­˜å¤§å°ï¼ˆå­—èŠ‚ï¼?
   */
  maxSize: number;
  
  /**
   * é»˜è®¤è¿‡æœŸæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
   */
  defaultExpireTime: number;
  
  /**
   * ç¼“å­˜ç­–ç•¥
   */
  strategy: CacheStrategy;
  
  /**
   * æ˜¯å¦è‡ªåŠ¨æ¸…ç†
   */
  autoCleanup: boolean;
  
  /**
   * æ¸…ç†é—´éš”ï¼ˆæ¯«ç§’ï¼‰
   */
  cleanupInterval: number;
  
  /**
   * æ˜¯å¦å‹ç¼©æ•°æ®
   */
  compressionEnabled: boolean;
  
  /**
   * æ˜¯å¦åŠ å¯†æ•°æ®
   */
  encryptionEnabled: boolean;
  
  /**
   * å†…å­˜ç¼“å­˜æœ€å¤§æ¡ç›®æ•°
   */
  maxMemoryEntries: number;
  
  /**
   * æ˜¯å¦ä½¿ç”¨LRUç­–ç•¥
   */
  useLru: boolean;
  
  /**
   * å­˜å‚¨æ¨¡å¼
   */
  storageMode: 'file' | 'database' | 'hybrid';
}

/**
 * ç¼“å­˜ç»Ÿè®¡æ¥å£
 */
export interface CacheStats {
  /**
   * å½“å‰ç¼“å­˜å¤§å°ï¼ˆå­—èŠ‚ï¼‰
   */
  currentSize: number;
  
  /**
   * æœ€å¤§ç¼“å­˜å¤§å°ï¼ˆå­—èŠ‚ï¼?
   */
  maxSize: number;
  
  /**
   * ç¼“å­˜æ¡ç›®æ•?
   */
  itemCount: number;
  
  /**
   * å†…å­˜ç¼“å­˜å¤§å°
   */
  memoryCacheSize: number;
  
  /**
   * ç£ç›˜ç¼“å­˜å¤§å°
   */
  diskCacheSize: number;
  
  /**
   * å‘½ä¸­ç?
   */
  hitRate: number;
  
  /**
   * æœªå‘½ä¸­ç‡
   */
  missRate: number;
  
  /**
   * è¿‡æœŸæ¡ç›®æ•?
   */
  expiredCount: number;
  
  /**
   * æœ€åæ¸…ç†æ—¶é—?
   */
  lastCleanupTime: number;
  
  /**
   * æŒ‰ç±»å‹ç»Ÿè®?
   */
  byType: {
    [key in CacheType]: {
      count: number;
      size: number;
    }
  };
}

/**
 * ç¼“å­˜æ¸…ç†é€‰é¡¹æ¥å£
 */
export interface CacheCleanupOptions {
  /**
   * æ¸…ç†ç±»å‹
   */
  types?: CacheType[];
  
  /**
   * æ¸…ç†è¿‡æœŸé¡?
   */
  expired?: boolean;
  
  /**
   * æ¸…ç†æœ€å°ä¼˜å…ˆçº§
   */
  minPriority?: CachePriority;
  
  /**
   * ä¿ç•™å¤§å°ï¼ˆå­—èŠ‚ï¼‰
   */
  keepSize?: number;
  
  /**
   * ä¿ç•™æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰å†…çš„ç¼“å­˜
   */
  keepTime?: number;
  
  /**
   * æ’é™¤çš„é”®
   */
  excludeKeys?: string[];
  
  /**
   * æ’é™¤çš„æ ‡ç­?
   */
  excludeTags?: string[];
  
  /**
   * æ˜¯å¦æ‰§è¡Œå®é™…æ¸…ç†
   */
  dryRun?: boolean;
  
  /**
   * æ˜¯å¦æ¸…ç†å…¨éƒ¨
   */
  all?: boolean;
}

/**
 * ç¼“å­˜æ¸…ç†ç»“æœæ¥å£
 */
export interface CacheCleanupResult {
  /**
   * æ¸…ç†çš„æ¡ç›®æ•°
   */
  removedCount: number;
  
  /**
   * é‡Šæ”¾çš„ç©ºé—´ï¼ˆå­—èŠ‚ï¼?
   */
  freedSpace: number;
  
  /**
   * æ¸…ç†æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
   */
  cleanupTime: number;
  
  /**
   * æ˜¯å¦ä¸ºæ¨¡æ‹Ÿè¿è¡?
   */
  isDryRun: boolean;
  
  /**
   * æŒ‰ç±»å‹æ¸…ç†ç»Ÿè®?
   */
  byType: {
    [key in CacheType]?: {
      count: number;
      size: number;
    }
  };
}

/**
 * ç¼“å­˜æœç´¢å‚æ•°æ¥å£
 */
export interface CacheSearchParams {
  /**
   * æœç´¢é”®æ¨¡å¼?
   */
  keyPattern?: string;
  
  /**
   * ç¼“å­˜ç±»å‹
   */
  types?: CacheType[];
  
  /**
   * æœ€å°ä¼˜å…ˆçº§
   */
  minPriority?: CachePriority;
  
  /**
   * åˆ›å»ºæ—¶é—´èŒƒå›´ï¼ˆå¼€å§‹ï¼‰
   */
  createdAfter?: number;
  
  /**
   * åˆ›å»ºæ—¶é—´èŒƒå›´ï¼ˆç»“æŸï¼‰
   */
  createdBefore?: number;
  
  /**
   * æ˜¯å¦åŒ…å«è¿‡æœŸé¡?
   */
  includeExpired?: boolean;
  
  /**
   * æ ‡ç­¾è¿‡æ»¤
   */
  tags?: string[];
  
  /**
   * æ’åºå­—æ®µ
   */
  sortBy?: 'createdAt' | 'lastAccessedAt' | 'size' | 'accessCount' | 'priority';
  
  /**
   * æ’åºæ–¹å‘
   */
  sortOrder?: 'asc' | 'desc';
  
  /**
   * åˆ†é¡µå¤§å°
   */
  limit?: number;
  
  /**
   * åˆ†é¡µåç§»
   */
  offset?: number;
}

/**
 * ç¼“å­˜æœç´¢ç»“æœæ¥å£
 */
export interface CacheSearchResult {
  /**
   * ç¼“å­˜æ¡ç›®åˆ—è¡¨
   */
  items: CacheMetadata[];
  
  /**
   * æ€»æ¡ç›®æ•°
   */
  totalCount: number;
  
  /**
   * æ˜¯å¦è¿˜æœ‰æ›´å¤š
   */
  hasMore: boolean;
  
  /**
   * æœç´¢æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
   */
  searchTime: number;
}

/**
 * é¢„åŠ è½½ç¼“å­˜é€‰é¡¹æ¥å£
 */
export interface PreloadCacheOptions {
  /**
   * ç¼“å­˜é”?
   */
  keys: string[];
  
  /**
   * é¢„åŠ è½½ç±»å?
   */
  type: CacheType;
  
  /**
   * ä¼˜å…ˆçº?
   */
  priority?: CachePriority;
  
  /**
   * è¿‡æœŸæ—¶é—´
   */
  expireTime?: number;
  
  /**
   * é¢„åŠ è½½å›è°?
   */
  onProgress?: (progress: number) => void;
}

/**
 * ç¼“å­˜äº‹ä»¶ç±»å‹æšä¸¾
 */
export enum CacheEventType {
  /**
   * æ·»åŠ ç¼“å­˜
   */
  ADDED = 'added',
  
  /**
   * è·å–ç¼“å­˜
   */
  GET = 'get',
  
  /**
   * åˆ é™¤ç¼“å­˜
   */
  DELETED = 'deleted',
  
  /**
   * æ›´æ–°ç¼“å­˜
   */
  UPDATED = 'updated',
  
  /**
   * æ¸…ç†ç¼“å­˜
   */
  CLEANED = 'cleaned',
  
  /**
   * è¿‡æœŸ
   */
  EXPIRED = 'expired',
  
  /**
   * å¤§å°å˜åŒ–
   */
  SIZE_CHANGED = 'size_changed',
  
  /**
   * å‘½ä¸­ç‡å˜åŒ?
   */
  HIT_RATE_CHANGED = 'hit_rate_changed'
}

/**
 * ç¼“å­˜äº‹ä»¶æ•°æ®æ¥å£
 */
export interface CacheEventData {
  /**
   * æ¸…ç†ç»Ÿè®¡ï¼ˆé’ˆå¯¹CLEANEDäº‹ä»¶ï¼?
   */
  cleanupStats?: {
    removedCount: number;
    freedSpace: number;
  };
  
  /**
   * å‘½ä¸­ç‡æ•°æ®ï¼ˆé’ˆå¯¹HIT_RATE_CHANGEDäº‹ä»¶ï¼?
   */
  hitRateData?: {
    hitRate: number;
    totalRequests: number;
    hits: number;
    misses: number;
  };
  
  /**
   * å¤§å°å˜åŒ–æ•°æ®ï¼ˆé’ˆå¯¹SIZE_CHANGEDäº‹ä»¶ï¼?
   */
  sizeChangeData?: {
    previousSize: number;
    currentSize: number;
    changeAmount: number;
  };
  
  /**
   * è‡ªå®šä¹‰æ•°æ?
   */
  customData?: Record<string, string | number | boolean>;
}

/**
 * ç¼“å­˜äº‹ä»¶æ¥å£
 */
export interface CacheEvent {
  /**
   * äº‹ä»¶ç±»å‹
   */
  type: CacheEventType;
  
  /**
   * ç¼“å­˜é”?
   */
  key?: string;
  
  /**
   * ç¼“å­˜å¤§å°
   */
  size?: number;
  
  /**
   * æ—¶é—´æˆ?
   */
  timestamp: number;
  
  /**
   * äº‹ä»¶æ•°æ®
   */
  data?: CacheEventData;
}

/**
 * ç¼“å­˜å‹ç¼©é…ç½®æ¥å£
 */
export interface CacheCompressionConfig {
  /**
   * æ˜¯å¦å¯ç”¨
   */
  enabled: boolean;
  
  /**
   * å‹ç¼©çº§åˆ«
   */
  level: number;
  
  /**
   * å‹ç¼©é˜ˆå€¼ï¼ˆå­—èŠ‚ï¼?
   */
  threshold: number;
  
  /**
   * å‹ç¼©ç®—æ³•
   */
  algorithm: 'gzip' | 'deflate' | 'lz4' | 'zstd';
}

/**
 * ç¼“å­˜åŠ å¯†é…ç½®æ¥å£
 */
export interface CacheEncryptionConfig {
  /**
   * æ˜¯å¦å¯ç”¨
   */
  enabled: boolean;
  
  /**
   * åŠ å¯†ç®—æ³•
   */
  algorithm: 'aes' | 'rsa' | '3des';
  
  /**
   * å¯†é’¥
   */
  key?: string;
  
  /**
   * å¯†é’¥åˆ«å
   */
  keyAlias?: string;
  
  /**
   * åŠ å¯†æ¨¡å¼
   */
  mode?: 'cbc' | 'gcm' | 'ctr';
}

/**
 * ç¼“å­˜ç‰ˆæœ¬æ§åˆ¶æ¥å£
 */
export interface CacheVersion {
  /**
   * ç‰ˆæœ¬å?
   */
  version: string;
  
  /**
   * ä¸Šæ¬¡æ›´æ–°æ—¶é—´
   */
  lastUpdated: number;
  
  /**
   * ç¼“å­˜æ¡ç›®æ•?
   */
  itemCount: number;
  
  /**
   * ç¼“å­˜å¤§å°
   */
  totalSize: number;
}

/**
 * æ‰¹é‡ç¼“å­˜æ“ä½œç»“æœæ¥å£
 */
export interface BatchCacheResult {
  /**
   * æˆåŠŸçš„é”®
   */
  successKeys: string[];
  
  /**
   * å¤±è´¥çš„é”®
   */
  failedKeys: string[];
  
  /**
   * å¤±è´¥åŸå› 
   */
  failures: Record<string, string>;
  
  /**
   * æ€»æ“ä½œæ—¶é—?
   */
  operationTime: number;
  
  /**
   * æ“ä½œç±»å‹
   */
  operationType: 'get' | 'set' | 'delete' | 'update';
}
