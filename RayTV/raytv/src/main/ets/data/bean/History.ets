// History.ets - å†å²è®°å½•æ•°æ®æ¨¡å‹
// å®šä¹‰ç”¨æˆ·è§‚çœ‹å†å²è®°å½•çš„æ•°æ®ç»“æ?
/**
 * å†å²è®°å½•ç±»å‹æšä¸¾
 */
export enum HistoryType {
  VOD = 'vod',          // ç‚¹æ’­å†…å®¹
  LIVE = 'live',        // ç›´æ’­å†…å®¹
  COLLECTION = 'collection', // æ”¶è—å†…å®¹
  SEARCH = 'search',    // æœç´¢å†å²
  RECENTLY_VIEWED = 'recently_viewed' // æœ€è¿‘æµè§?}

/**
 * å†…å®¹ç±»å‹æšä¸¾
 */
export enum ContentType {
  MOVIE = 'movie',      // ç”µå½±
  TV_SERIES = 'tv_series', // ç”µè§†å‰?  ANIME = 'anime',      // åŠ¨æ¼«
  VARIETY = 'variety',  // ç»¼è‰º
  DOCUMENTARY = 'documentary', // çºªå½•ç‰?  LIVE_CHANNEL = 'live_channel', // ç›´æ’­é¢‘é“
  LIVE_EVENT = 'live_event' // ç›´æ’­äº‹ä»¶
}

/**
 * æ’­æ”¾çŠ¶æ€æšä¸? */
export enum PlaybackStatus {
  NOT_STARTED = 'not_started', // æœªå¼€å§?  IN_PROGRESS = 'in_progress', // è¿›è¡Œä¸?  PAUSED = 'paused',     // æš‚åœ
  COMPLETED = 'completed', // å·²å®Œæˆ?  ERROR = 'error'        // é”™è¯¯
}

/**
 * å†å²è®°å½•æ•°æ®æ¨¡å‹
 */
export interface History {
  id: string;           // å†å²è®°å½•å”¯ä¸€ID
  contentId: string;    // å†…å®¹ID
  contentName: string;  // å†…å®¹åç§°
  type: HistoryType;    // å†å²è®°å½•ç±»å‹
  contentType: ContentType; // å†…å®¹ç±»å‹
  sourceKey: string;    // æ•°æ®æºæ ‡è¯?  cover: string;        // å°é¢URL
  poster?: string;      // æµ·æŠ¥URL
  backdrop?: string;    // èƒŒæ™¯å›¾URL
  position: number;     // æ’­æ”¾ä½ç½®ï¼ˆæ¯«ç§’ï¼‰
  duration: number;     // æ€»æ—¶é•¿ï¼ˆæ¯«ç§’ï¼?  progress: number;     // æ’­æ”¾è¿›åº¦ç™¾åˆ†æ¯”ï¼ˆ0-100ï¼?  playbackStatus: PlaybackStatus; // æ’­æ”¾çŠ¶æ€?  episodeName?: string; // å‰§é›†åç§°
  episodeId?: string;   // å‰§é›†ID
  seasonName?: string;  // å­£åç§?  seasonId?: string;    // å­£ID
  sourceName?: string;  // è§†é¢‘æºåç§?  sourceUrl?: string;   // è§†é¢‘æºURL
  playCount: number;    // æ’­æ”¾æ¬¡æ•°
  totalWatchTime: number; // æ€»è§‚çœ‹æ—¶é•¿ï¼ˆæ¯«ç§’ï¼?  lastPlayedAt: number; // æœ€åæ’­æ”¾æ—¶é—?  firstPlayedAt: number; // é¦–æ¬¡æ’­æ”¾æ—¶é—´
  createdAt: number;    // åˆ›å»ºæ—¶é—´
  updatedAt: number;    // æ›´æ–°æ—¶é—´
  deviceId?: string;    // è®¾å¤‡ID
  deviceName?: string;  // è®¾å¤‡åç§°
  userAgent?: string;   // è§‚çœ‹æ—¶çš„ç”¨æˆ·ä»£ç†
  resolution?: string;  // è§‚çœ‹åˆ†è¾¨ç?  bitrate?: number;     // è§‚çœ‹æ¯”ç‰¹ç?  language?: string;    // è¯­è¨€
  subtitles?: string[]; // å­—å¹•åˆ—è¡¨
  audioTracks?: string[]; // éŸ³è½¨åˆ—è¡¨
  selectedAudioTrack?: string; // é€‰ä¸­çš„éŸ³è½?  selectedSubtitle?: string; // é€‰ä¸­çš„å­—å¹?  playbackSpeed?: number; // æ’­æ”¾é€Ÿåº¦
  volume?: number;      // éŸ³é‡è®¾ç½®
  brightness?: number;  // äº®åº¦è®¾ç½®
  contrast?: number;    // å¯¹æ¯”åº¦è®¾ç½?  saturation?: number;  // é¥±å’Œåº¦è®¾ç½?  hue?: number;         // è‰²è°ƒè®¾ç½®
  playbackNotes?: string; // æ’­æ”¾ç¬”è®°
  watchTimeList?: WatchTimeRecord[]; // è§‚çœ‹æ—¶é—´è®°å½•åˆ—è¡¨
}

/**
 * å†å²è®°å½•åˆ†ç»„æ¥å£
 */
export interface HistoryGroup {
  date: string;         // æ—¥æœŸæ ‡è¯†ï¼ˆYYYY-MM-DDï¼?  label: string;        // æ˜¾ç¤ºæ ‡ç­¾ï¼ˆä»Šå¤©ã€æ˜¨å¤©ã€æœ¬å‘¨ç­‰ï¼?  histories: History[]; // è¯¥æ—¥æœŸä¸‹çš„å†å²è®°å½•åˆ—è¡?  count: number;        // è®°å½•æ•°é‡
  totalWatchTime: number; // æ€»è§‚çœ‹æ—¶é•?}

/**
 * å†å²è®°å½•åˆ—è¡¨å“åº”æ¥å£
 */
export interface HistoryListResponse {
  groups: HistoryGroup[]; // åˆ†ç»„åˆ—è¡¨
  totalCount: number;   // æ€»è®°å½•æ•°
  totalWatchTime: number; // æ€»è§‚çœ‹æ—¶é•?  hasMore: boolean;     // æ˜¯å¦æœ‰æ›´å¤?  page?: number;        // å½“å‰é¡µç 
  pageSize?: number;    // æ¯é¡µæ•°é‡
}

/**
 * å†å²è®°å½•ç»Ÿè®¡æ¥å£
 */
export interface HistoryStats {
  totalCount: number;   // æ€»è®°å½•æ•°
  totalWatchTime: number; // æ€»è§‚çœ‹æ—¶é•¿ï¼ˆæ¯«ç§’ï¼?  averageWatchTime: number; // å¹³å‡è§‚çœ‹æ—¶é•¿
  recentDays: number;   // æœ€è¿‘å¤šå°‘å¤©çš„æ•°æ?  byType: Record<HistoryType, number>; // æŒ‰ç±»å‹ç»Ÿè®?  byContentType: Record<ContentType, number>; // æŒ‰å†…å®¹ç±»å‹ç»Ÿè®?  bySource: Record<string, number>; // æŒ‰æ•°æ®æºç»Ÿè®¡
  topContent: {
    contentId: string;
    contentName: string;
    watchCount: number;
    totalWatchTime: number;
  }[];
  lastWatchTime?: number; // æœ€åè§‚çœ‹æ—¶é—?  dailyAverage?: number; // æ—¥å‡è§‚çœ‹æ¬¡æ•°
}

/**
 * å†å²è®°å½•ç­›é€‰æ¡ä»¶æ¥å? */
export interface HistoryFilter {
  type?: HistoryType;   // å†å²è®°å½•ç±»å‹
  contentType?: ContentType; // å†…å®¹ç±»å‹
  sourceKey?: string;   // æ•°æ®æºæ ‡è¯?  startDate?: number;   // å¼€å§‹æ—¥æœ?  endDate?: number;     // ç»“æŸæ—¥æœŸ
  minProgress?: number; // æœ€å°è¿›åº¦ç™¾åˆ†æ¯”
  maxProgress?: number; // æœ€å¤§è¿›åº¦ç™¾åˆ†æ¯”
  playCount?: number;   // æ’­æ”¾æ¬¡æ•°ç­›é€?  searchKeyword?: string; // æœç´¢å…³é”®è¯?}

/**
 * å†å²è®°å½•æ’åºé€‰é¡¹æšä¸¾
 */
export enum HistorySortOption {
  LAST_PLAYED_AT_DESC = 'lastPlayedAt_desc', // æŒ‰æœ€åæ’­æ”¾æ—¶é—´é™åº?  LAST_PLAYED_AT_ASC = 'lastPlayedAt_asc',   // æŒ‰æœ€åæ’­æ”¾æ—¶é—´å‡åº?  CREATED_AT_DESC = 'createdAt_desc',        // æŒ‰åˆ›å»ºæ—¶é—´é™åº?  CREATED_AT_ASC = 'createdAt_asc',          // æŒ‰åˆ›å»ºæ—¶é—´å‡åº?  PLAY_COUNT_DESC = 'playCount_desc',        // æŒ‰æ’­æ”¾æ¬¡æ•°é™åº?  PLAY_COUNT_ASC = 'playCount_asc',          // æŒ‰æ’­æ”¾æ¬¡æ•°å‡åº?  PROGRESS_DESC = 'progress_desc',           // æŒ‰æ’­æ”¾è¿›åº¦é™åº?  PROGRESS_ASC = 'progress_asc',             // æŒ‰æ’­æ”¾è¿›åº¦å‡åº?  WATCH_TIME_DESC = 'watchTime_desc',        // æŒ‰è§‚çœ‹æ—¶é•¿é™åº?  WATCH_TIME_ASC = 'watchTime_asc'           // æŒ‰è§‚çœ‹æ—¶é•¿å‡åº?}

/**
 * å†å²è®°å½•æ¸…é™¤é€‰é¡¹æ¥å£
 */
export interface HistoryClearOptions {
  beforeDate?: number;  // æ¸…é™¤æŒ‡å®šæ—¥æœŸä¹‹å‰çš„è®°å½?  minProgress?: number; // æ¸…é™¤å°äºæŒ‡å®šè¿›åº¦çš„è®°å½?  type?: HistoryType;   // æ¸…é™¤æŒ‡å®šç±»å‹çš„è®°å½?  contentType?: ContentType; // æ¸…é™¤æŒ‡å®šå†…å®¹ç±»å‹çš„è®°å½?  sourceKey?: string;   // æ¸…é™¤æŒ‡å®šæ•°æ®æºçš„è®°å½•
  selectedIds?: string[]; // æ¸…é™¤æŒ‡å®šIDçš„è®°å½?  excludeCompleted?: boolean; // æ’é™¤å·²å®Œæˆçš„è®°å½•
  excludeInProgress?: boolean; // æ’é™¤è¿›è¡Œä¸­çš„è®°å½•
}

/**
 * å†å²è®°å½•åŒæ­¥çŠ¶æ€æ¥å? */
export interface HistorySyncStatus {
  isEnabled: boolean;   // æ˜¯å¦å¯ç”¨åŒæ­¥
  lastSyncTime?: number; // æœ€ååŒæ­¥æ—¶é—?  syncCount: number;    // åŒæ­¥è®°å½•æ•?  status: 'idle' | 'syncing' | 'success' | 'failed'; // åŒæ­¥çŠ¶æ€?  errorMessage?: string; // é”™è¯¯ä¿¡æ¯
  syncDirection: 'upload' | 'download' | 'bidirectional'; // åŒæ­¥æ–¹å‘
}

/**
 * å†å²è®°å½•å¯¼å‡ºé…ç½®æ¥å£
 */
export interface HistoryExportConfig {
  format: 'json' | 'csv' | 'pdf'; // å¯¼å‡ºæ ¼å¼
  includeDetails?: boolean; // æ˜¯å¦åŒ…å«è¯¦ç»†ä¿¡æ¯
  includeStats?: boolean;   // æ˜¯å¦åŒ…å«ç»Ÿè®¡ä¿¡æ¯
  filter?: HistoryFilter;   // å¯¼å‡ºç­›é€‰æ¡ä»?  password?: string;        // åŠ å¯†å¯†ç 
  compress?: boolean;       // æ˜¯å¦å‹ç¼©
}

/**
 * è§‚çœ‹è¿›åº¦æé†’æ¥å£
 */
export interface ProgressReminder {
  historyId: string;    // å†å²è®°å½•ID
  contentId: string;    // å†…å®¹ID
  contentName: string;  // å†…å®¹åç§°
  progress: number;     // å½“å‰è¿›åº¦
  remainingTime: number; // å‰©ä½™æ—¶é—´
  episodeName?: string; // å‰§é›†åç§°
  reminderTime: number; // æé†’æ—¶é—´
  isRead: boolean;      // æ˜¯å¦å·²è¯»
  createdAt: number;    // åˆ›å»ºæ—¶é—´
}

/**
 * è®¾å¤‡è§‚çœ‹è®°å½•æ¥å£
 */
export interface DeviceWatchRecord {
  deviceId: string;     // è®¾å¤‡ID
  deviceName: string;   // è®¾å¤‡åç§°
  lastSyncTime: number; // æœ€ååŒæ­¥æ—¶é—?  recordCount: number;  // è®°å½•æ•°é‡
  totalWatchTime: number; // æ€»è§‚çœ‹æ—¶é•?  lastContent?: {
    contentId: string;
    contentName: string;
    lastPlayedAt: number;
    progress: number;
  };
}

/**
 * è§‚çœ‹æ—¶é—´è®°å½•æ¥å£
 */
export interface WatchTimeRecord {
  startTime: number;  // å¼€å§‹æ—¶é—?  endTime: number;    // ç»“æŸæ—¶é—´
  duration: number;   // è§‚çœ‹æ—¶é•¿
}
