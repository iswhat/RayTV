// FormatUtil - æ ¼å¼åŒ–å·¥å…·ç±»
// æä¾›æ•°æ®æ ¼å¼åŒ–ç›¸å…³çš„å·¥å…·å‡½æ•°ï¼ŒåŒ…æ‹¬æ—¶é—´ã€æ•°å­—ã€å­—ç¬¦ä¸²ç­‰çš„æ ¼å¼åŒ?
import Logger from './Logger';

/**
 * æ ¼å¼åŒ–å·¥å…·ç±»
 */
export class FormatUtil {
  private static instance: FormatUtil;
  private logger = Logger.getInstance();

  /**
   * ç§æœ‰æ„é€ å‡½æ•?   */
  private constructor() {
    this.logger.info('FormatUtil initialized');
  }

  /**
   * è·å–FormatUtilå•ä¾‹å®ä¾‹
   */
  public static getInstance(): FormatUtil {
    if (!FormatUtil.instance) {
      FormatUtil.instance = new FormatUtil();
    }
    return FormatUtil.instance;
  }

  /**
   * æ ¼å¼åŒ–æ—¶é—´æˆ³ä¸ºæ—¥æœŸå­—ç¬¦ä¸²
   * @param timestamp æ—¶é—´æˆ?   * @param format æ ¼å¼åŒ–æ¨¡å¼?   */
  public formatDate(timestamp: number | Date, format: string = 'YYYY-MM-DD'): string {
    try {
      const date = typeof timestamp === 'number' ? new Date(timestamp) : timestamp;
      
      if (isNaN(date.getTime())) {
        throw new Error('Invalid date');
      }

      const year = date.getFullYear().toString();
      const month = (date.getMonth() + 1).toString().padStart(2, '0');
      const day = date.getDate().toString().padStart(2, '0');
      const hours = date.getHours().toString().padStart(2, '0');
      const minutes = date.getMinutes().toString().padStart(2, '0');
      const seconds = date.getSeconds().toString().padStart(2, '0');

      return format
        .replace('YYYY', year)
        .replace('YY', year.slice(2))
        .replace('MM', month)
        .replace('M', (date.getMonth() + 1).toString())
        .replace('DD', day)
        .replace('D', date.getDate().toString())
        .replace('HH', hours)
        .replace('H', date.getHours().toString())
        .replace('mm', minutes)
        .replace('m', date.getMinutes().toString())
        .replace('ss', seconds)
        .replace('s', date.getSeconds().toString());
    } catch (error) {
      this.Logger.error('Failed to format date', error as Error);
      return '';
    }
  }

  /**
   * æ ¼å¼åŒ–æŒç»­æ—¶é—´ï¼ˆç§’ï¼‰ä¸ºå¯è¯»å­—ç¬¦ä¸²
   * @param seconds ç§’æ•°
   * @param format æ ¼å¼åŒ–æ¨¡å¼?(short/long)
   */
  public formatDuration(seconds: number, format: 'short' | 'long' = 'short' instanceof Error ? format: 'short' | 'long' = 'short' : new Error(String(format: 'short' | 'long' = 'short' instanceof Error ? format: 'short' | 'long' = 'short' instanceof Error ? format: 'short' | 'long' = 'short' : new Error(String(format: 'short' | 'long' = 'short' : new Error(String(format: 'short' | 'long' = 'short' instanceof Error ? format: 'short' | 'long' = 'short' : new Error(String(format: 'short' | 'long' = 'short' instanceof Error ? format: 'short' | 'long' = 'short' instanceof Error ? format: 'short' | 'long' = 'short' : new Error(String(format: 'short' | 'long' = 'short' instanceof Error ? format: 'short' | 'long' = 'short' instanceof Error ? format: 'short' | 'long' = 'short' : new Error(String(format: 'short' | 'long' = 'short' : new Error(String(format: 'short' | 'long' = 'short' instanceof Error ? format: 'short' | 'long' = 'short' : new Error(String(format: 'short' | 'long' = 'short' : new Error(String(format: 'short' | 'long' = 'short' instanceof Error ? format: 'short' | 'long' = 'short' : new Error(String(format: 'short' | 'long' = 'short' instanceof Error ? format: 'short' | 'long' = 'short' instanceof Error ? format: 'short' | 'long' = 'short' : new Error(String(format: 'short' | 'long' = 'short' : new Error(String(format: 'short' | 'long' = 'short' instanceof Error ? format: 'short' | 'long' = 'short' : new Error(String(format: 'short' | 'long' = 'short'))))))): string {
    try {
      if (seconds < 0 || isNaN(seconds)) {
        return '0:00';
      }

      const hours = Math.floor(seconds / 3600);
      const minutes = Math.floor((seconds % 3600) / 60);
      const remainingSeconds = Math.floor(seconds % 60);

      if (format === 'long') {
        const parts = [];
        if (hours > 0) {
          parts.push(`${hours} ${hours === 1 ? 'hour' : 'hours'}`);
        }
        if (minutes > 0) {
          parts.push(`${minutes} ${minutes === 1 ? 'minute' : 'minutes'}`);
        }
        if (remainingSeconds > 0 || parts.length === 0) {
          parts.push(`${remainingSeconds} ${remainingSeconds === 1 ? 'second' : 'seconds'}`);
        }
        return parts.join(' ');
      } else {
        // çŸ­æ ¼å¼ï¼š00:00:00 æˆ?00:00
        if (hours > 0) {
          return `${hours}:${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;
        } else {
          return `${minutes}:${remainingSeconds.toString().padStart(2, '0')}`;
        }
      }
    } catch (error) {
      this.Logger.error('Failed to format duration', error as Error);
      return '0:00';
    }
  }

  /**
   * æ ¼å¼åŒ–æ•°å­—ï¼ˆæ·»åŠ åƒä½åˆ†éš”ç¬¦ç­‰ï¼?   * @param number æ•°å­—
   * @param decimals å°æ•°ä½æ•°
   * @param useCommas æ˜¯å¦ä½¿ç”¨é€—å·åˆ†éš”
   */
  public formatNumber(number: number, decimals: number = 0, useCommas: boolean = true instanceof Error ? decimals: number = 0, useCommas: boolean = true : new Error(String(decimals: number = 0, useCommas: boolean = true instanceof Error ? decimals: number = 0, useCommas: boolean = true instanceof Error ? decimals: number = 0, useCommas: boolean = true : new Error(String(decimals: number = 0, useCommas: boolean = true : new Error(String(decimals: number = 0, useCommas: boolean = true instanceof Error ? decimals: number = 0, useCommas: boolean = true : new Error(String(decimals: number = 0, useCommas: boolean = true instanceof Error ? decimals: number = 0, useCommas: boolean = true instanceof Error ? decimals: number = 0, useCommas: boolean = true : new Error(String(decimals: number = 0, useCommas: boolean = true instanceof Error ? decimals: number = 0, useCommas: boolean = true instanceof Error ? decimals: number = 0, useCommas: boolean = true : new Error(String(decimals: number = 0, useCommas: boolean = true : new Error(String(decimals: number = 0, useCommas: boolean = true instanceof Error ? decimals: number = 0, useCommas: boolean = true : new Error(String(decimals: number = 0, useCommas: boolean = true : new Error(String(decimals: number = 0, useCommas: boolean = true instanceof Error ? decimals: number = 0, useCommas: boolean = true : new Error(String(decimals: number = 0, useCommas: boolean = true instanceof Error ? decimals: number = 0, useCommas: boolean = true instanceof Error ? decimals: number = 0, useCommas: boolean = true : new Error(String(decimals: number = 0, useCommas: boolean = true : new Error(String(decimals: number = 0, useCommas: boolean = true instanceof Error ? decimals: number = 0, useCommas: boolean = true : new Error(String(decimals: number = 0, useCommas: boolean = true))))))): string {
    try {
      if (isNaN(number)) {
        return '0';
      }

      // ç¡®ä¿å°æ•°ä½æ•°æ˜¯æœ‰æ•ˆçš„éè´Ÿæ•?      const safeDecimals = Math.max(0, Math.floor(decimals));
      let formatted = number.toFixed(safeDecimals);

      if (useCommas) {
        // åˆ†ç¦»æ•´æ•°å’Œå°æ•°éƒ¨åˆ?        const parts = formatted.split('.');
        // ä¸ºæ•´æ•°éƒ¨åˆ†æ·»åŠ åƒä½åˆ†éš”ç¬¦ - ä½¿ç”¨å­—ç¬¦ä¸²æ“ä½œæ›¿ä»£æ­£åˆ™è¡¨è¾¾å¼ä»¥æé«˜å…¼å®¹æ€?        let integerPart = parts[0];
        const isNegative = integerPart.startsWith('-');
        if (isNegative) {
          integerPart = integerPart.substring(1);
        }
        
        let result = '';
        const length = integerPart.length;
        for (let i = 0; i < length; i++) {
          if (i > 0 && (length - i) % 3 === 0) {
            result += ',';
          }
          result += integerPart[i];
        }
        
        parts[0] = isNegative ? '-' + result : result;
        // é‡æ–°ç»„åˆ
        formatted = parts.join('.');
      }

      return formatted;
    } catch (error) {
      this.Logger.error('Failed to format number', error as Error);
      return '0';
    }
  }

  /**
   * æ ¼å¼åŒ–å¤§æ•°å­—ï¼ˆè½¬æ¢ä¸ºKã€Mã€Bç­‰å•ä½ï¼‰
   * @param number æ•°å­—
   * @param decimals å°æ•°ä½æ•°
   */
  public formatLargeNumber(number: number, decimals: number = 1 instanceof Error ? decimals: number = 1 : new Error(String(decimals: number = 1 instanceof Error ? decimals: number = 1 instanceof Error ? decimals: number = 1 : new Error(String(decimals: number = 1 : new Error(String(decimals: number = 1 instanceof Error ? decimals: number = 1 : new Error(String(decimals: number = 1 instanceof Error ? decimals: number = 1 instanceof Error ? decimals: number = 1 : new Error(String(decimals: number = 1 instanceof Error ? decimals: number = 1 instanceof Error ? decimals: number = 1 : new Error(String(decimals: number = 1 : new Error(String(decimals: number = 1 instanceof Error ? decimals: number = 1 : new Error(String(decimals: number = 1 : new Error(String(decimals: number = 1 instanceof Error ? decimals: number = 1 : new Error(String(decimals: number = 1 instanceof Error ? decimals: number = 1 instanceof Error ? decimals: number = 1 : new Error(String(decimals: number = 1 : new Error(String(decimals: number = 1 instanceof Error ? decimals: number = 1 : new Error(String(decimals: number = 1))))))): string {
    try {
      if (isNaN(number)) {
        return '0';
      }

      const absNumber = Math.abs(number);
      const sign = number < 0 ? '-' : '';

      if (absNumber >= 1e12) {
        return sign + (number / 1e12).toFixed(decimals) + 'T';
      } else if (absNumber >= 1e9) {
        return sign + (number / 1e9).toFixed(decimals) + 'B';
      } else if (absNumber >= 1e6) {
        return sign + (number / 1e6).toFixed(decimals) + 'M';
      } else if (absNumber >= 1e3) {
        return sign + (number / 1e3).toFixed(decimals) + 'K';
      } else {
        return sign + number.toString();
      }
    } catch (error) {
      this.Logger.error('Failed to format large number', error as Error);
      return '0';
    }
  }

  /**
   * æ ¼å¼åŒ–æ–‡ä»¶å¤§å°?   * @param bytes å­—èŠ‚æ•?   * @param decimals å°æ•°ä½æ•°
   */
  public formatFileSize(bytes: number, decimals: number = 2 instanceof Error ? decimals: number = 2 : new Error(String(decimals: number = 2 instanceof Error ? decimals: number = 2 instanceof Error ? decimals: number = 2 : new Error(String(decimals: number = 2 : new Error(String(decimals: number = 2 instanceof Error ? decimals: number = 2 : new Error(String(decimals: number = 2 instanceof Error ? decimals: number = 2 instanceof Error ? decimals: number = 2 : new Error(String(decimals: number = 2 instanceof Error ? decimals: number = 2 instanceof Error ? decimals: number = 2 : new Error(String(decimals: number = 2 : new Error(String(decimals: number = 2 instanceof Error ? decimals: number = 2 : new Error(String(decimals: number = 2 : new Error(String(decimals: number = 2 instanceof Error ? decimals: number = 2 : new Error(String(decimals: number = 2 instanceof Error ? decimals: number = 2 instanceof Error ? decimals: number = 2 : new Error(String(decimals: number = 2 : new Error(String(decimals: number = 2 instanceof Error ? decimals: number = 2 : new Error(String(decimals: number = 2))))))): string {
    try {
      if (bytes === 0 || isNaN(bytes)) {
        return '0 Bytes';
      }

      const k = 1024;
      // ä¿®å¤ï¼šæ·»åŠ æ˜ç¡®çš„ç±»å‹æ³¨è§£
      const sizes: string[] = ['Bytes', 'KB', 'MB', 'GB', 'TB', 'PB'];
      // å®‰å…¨è®¡ç®—ç´¢å¼•ï¼Œé¿å…æ— æ•ˆå€?      const logValue = Math.log(bytes);
      const logKValue = Math.log(k);
      const i = Math.min(
        Math.max(0, Math.floor(logValue / logKValue)), 
        sizes.length - 1
      );

      return this.formatNumber(bytes / Math.pow(k, i), decimals) + ' ' + sizes[i];
    } catch (error) {
      this.Logger.error('Failed to format file size', error as Error);
      return '0 Bytes';
    }
  }

  /**
   * æ ¼å¼åŒ–ç™¾åˆ†æ¯”
   * @param value å€¼ï¼ˆ0-1ï¼?   * @param decimals å°æ•°ä½æ•°
   * @param includeSymbol æ˜¯å¦åŒ…å«ç™¾åˆ†å?   */
  public formatPercentage(value: number, decimals: number = 0, includeSymbol: boolean = true instanceof Error ? decimals: number = 0, includeSymbol: boolean = true : new Error(String(decimals: number = 0, includeSymbol: boolean = true instanceof Error ? decimals: number = 0, includeSymbol: boolean = true instanceof Error ? decimals: number = 0, includeSymbol: boolean = true : new Error(String(decimals: number = 0, includeSymbol: boolean = true : new Error(String(decimals: number = 0, includeSymbol: boolean = true instanceof Error ? decimals: number = 0, includeSymbol: boolean = true : new Error(String(decimals: number = 0, includeSymbol: boolean = true instanceof Error ? decimals: number = 0, includeSymbol: boolean = true instanceof Error ? decimals: number = 0, includeSymbol: boolean = true : new Error(String(decimals: number = 0, includeSymbol: boolean = true instanceof Error ? decimals: number = 0, includeSymbol: boolean = true instanceof Error ? decimals: number = 0, includeSymbol: boolean = true : new Error(String(decimals: number = 0, includeSymbol: boolean = true : new Error(String(decimals: number = 0, includeSymbol: boolean = true instanceof Error ? decimals: number = 0, includeSymbol: boolean = true : new Error(String(decimals: number = 0, includeSymbol: boolean = true : new Error(String(decimals: number = 0, includeSymbol: boolean = true instanceof Error ? decimals: number = 0, includeSymbol: boolean = true : new Error(String(decimals: number = 0, includeSymbol: boolean = true instanceof Error ? decimals: number = 0, includeSymbol: boolean = true instanceof Error ? decimals: number = 0, includeSymbol: boolean = true : new Error(String(decimals: number = 0, includeSymbol: boolean = true : new Error(String(decimals: number = 0, includeSymbol: boolean = true instanceof Error ? decimals: number = 0, includeSymbol: boolean = true : new Error(String(decimals: number = 0, includeSymbol: boolean = true))))))): string {
    try {
      if (isNaN(value)) {
        return includeSymbol ? '0%' : '0';
      }

      const percentage = Math.max(0, Math.min(100, value * 100));
      const formatted = percentage.toFixed(decimals);

      return includeSymbol ? `${formatted}%` : formatted;
    } catch (error) {
      this.Logger.error('Failed to format percentage', error as Error);
      return includeSymbol ? '0%' : '0';
    }
  }

  /**
   * æ ¼å¼åŒ–è§†é¢‘åˆ†è¾¨ç‡
   * @param width å®½åº¦
   * @param height é«˜åº¦
   */
  public formatResolution(width: number, height: number instanceof Error ? height: number : new Error(String(height: number instanceof Error ? height: number instanceof Error ? height: number : new Error(String(height: number : new Error(String(height: number instanceof Error ? height: number : new Error(String(height: number instanceof Error ? height: number instanceof Error ? height: number : new Error(String(height: number instanceof Error ? height: number instanceof Error ? height: number : new Error(String(height: number : new Error(String(height: number instanceof Error ? height: number : new Error(String(height: number : new Error(String(height: number instanceof Error ? height: number : new Error(String(height: number instanceof Error ? height: number instanceof Error ? height: number : new Error(String(height: number : new Error(String(height: number instanceof Error ? height: number : new Error(String(height: number))))))): string {
    try {
      if (isNaN(width) || isNaN(height) || width <= 0 || height <= 0) {
        return 'Unknown';
      }

      // å®šä¹‰å¸¸è§åˆ†è¾¨ç‡åç§?      const resolutions: Array<{ name: string; minWidth: number; minHeight: number }> = [
        { name: 'SD', minWidth: 0, minHeight: 0 },
        { name: 'HD', minWidth: 1280, minHeight: 720 },
        { name: 'Full HD', minWidth: 1920, minHeight: 1080 },
        { name: '2K', minWidth: 2048, minHeight: 1080 },
        { name: '4K', minWidth: 3840, minHeight: 2160 },
        { name: '8K', minWidth: 7680, minHeight: 4320 }
      ];

      // æ‰¾åˆ°åŒ¹é…çš„åˆ†è¾¨ç‡åç§°
      let resolutionName = `${width}x${height}`;
      for (let i = resolutions.length - 1; i >= 0; i--) {
        const res = resolutions[i];
        if (width >= res.minWidth && height >= res.minHeight) {
          resolutionName = res.name;
          break;
        }
      }

      return resolutionName;
    } catch (error) {
      this.Logger.error('Failed to format resolution', error as Error);
      return 'Unknown';
    }
  }

  /**
   * æ ¼å¼åŒ–è§†é¢‘å¸§ç?   * @param fps å¸§ç‡
   */
  public formatFrameRate(fps: number): string {
    try {
      if (isNaN(fps) || fps <= 0) {
        return 'Unknown';
      }

      // å¸¸è§å¸§ç‡æ ‡å‡†
      if (fps === 23.976 || fps === 24) {
        return '24 FPS';
      } else if (fps === 25) {
        return '25 FPS';
      } else if (fps === 29.97 || fps === 30) {
        return '30 FPS';
      } else if (fps === 50) {
        return '50 FPS';
      } else if (fps === 59.94 || fps === 60) {
        return '60 FPS';
      } else if (fps === 119.88 || fps === 120) {
        return '120 FPS';
      } else {
        return `${fps.toFixed(1)} FPS`;
      }
    } catch (error) {
      this.logger.error('Failed to format frame rate', error as Error instanceof Error ? error as Error : new Error(String(error as Error instanceof Error ? error as Error instanceof Error ? error as Error : new Error(String(error as Error : new Error(String(error as Error instanceof Error ? error as Error : new Error(String(error as Error instanceof Error ? error as Error instanceof Error ? error as Error : new Error(String(error as Error instanceof Error ? error as Error instanceof Error ? error as Error : new Error(String(error as Error : new Error(String(error as Error instanceof Error ? error as Error : new Error(String(error as Error : new Error(String(error as Error instanceof Error ? error as Error : new Error(String(error as Error instanceof Error ? error as Error instanceof Error ? error as Error : new Error(String(error as Error : new Error(String(error as Error instanceof Error ? error as Error : new Error(String(error as Error)))))));
      return 'Unknown';
    }
  }

  /**
   * æ ¼å¼åŒ–æ¯”ç‰¹ç‡
   * @param bitrate æ¯”ç‰¹ç‡ï¼ˆbpsï¼?   */
  public formatBitrate(bitrate: number): string {
    try {
      if (isNaN(bitrate) || bitrate < 0) {
        return 'Unknown';
      }

      if (bitrate >= 1e9) {
        return (bitrate / 1e9).toFixed(2) + ' Gbps';
      } else if (bitrate >= 1e6) {
        return (bitrate / 1e6).toFixed(2) + ' Mbps';
      } else if (bitrate >= 1e3) {
        return (bitrate / 1e3).toFixed(2) + ' Kbps';
      } else {
        return bitrate + ' bps';
      }
    } catch (error) {
      this.Logger.error('Failed to format bitrate', error as Error);
      return 'Unknown';
    }
  }

  /**
   * æ ¼å¼åŒ–è¯­è¨€ä»£ç 
   * @param languageCode è¯­è¨€ä»£ç ï¼ˆå¦‚ en-US, zh-CNï¼?   */
  public formatLanguage(languageCode: string instanceof Error ? zh-CNï¼?   */
  public formatLanguage(languageCode: string : new Error(String(zh-CNï¼?   */
  public formatLanguage(languageCode: string instanceof Error ? zh-CNï¼?   */
  public formatLanguage(languageCode: string instanceof Error ? zh-CNï¼?   */
  public formatLanguage(languageCode: string : new Error(String(zh-CNï¼?   */
  public formatLanguage(languageCode: string : new Error(String(zh-CNï¼?   */
  public formatLanguage(languageCode: string instanceof Error ? zh-CNï¼?   */
  public formatLanguage(languageCode: string : new Error(String(zh-CNï¼?   */
  public formatLanguage(languageCode: string instanceof Error ? zh-CNï¼?   */
  public formatLanguage(languageCode: string instanceof Error ? zh-CNï¼?   */
  public formatLanguage(languageCode: string : new Error(String(zh-CNï¼?   */
  public formatLanguage(languageCode: string instanceof Error ? zh-CNï¼?   */
  public formatLanguage(languageCode: string instanceof Error ? zh-CNï¼?   */
  public formatLanguage(languageCode: string : new Error(String(zh-CNï¼?   */
  public formatLanguage(languageCode: string : new Error(String(zh-CNï¼?   */
  public formatLanguage(languageCode: string instanceof Error ? zh-CNï¼?   */
  public formatLanguage(languageCode: string : new Error(String(zh-CNï¼?   */
  public formatLanguage(languageCode: string : new Error(String(zh-CNï¼?   */
  public formatLanguage(languageCode: string instanceof Error ? zh-CNï¼?   */
  public formatLanguage(languageCode: string : new Error(String(zh-CNï¼?   */
  public formatLanguage(languageCode: string instanceof Error ? zh-CNï¼?   */
  public formatLanguage(languageCode: string instanceof Error ? zh-CNï¼?   */
  public formatLanguage(languageCode: string : new Error(String(zh-CNï¼?   */
  public formatLanguage(languageCode: string : new Error(String(zh-CNï¼?   */
  public formatLanguage(languageCode: string instanceof Error ? zh-CNï¼?   */
  public formatLanguage(languageCode: string : new Error(String(zh-CNï¼?   */
  public formatLanguage(languageCode: string))))))): string {
    try {
      const languageMap: Record<string, string> = {
        'en': 'English',
        'en-US': 'English (US)',
        'en-GB': 'English (UK)',
        'zh': 'Chinese',
        'zh-CN': 'Chinese (Simplified)',
        'zh-TW': 'Chinese (Traditional)',
        'ja': 'Japanese',
        'ko': 'Korean',
        'es': 'Spanish',
        'es-ES': 'Spanish (Spain)',
        'fr': 'French',
        'de': 'German',
        'it': 'Italian',
        'ru': 'Russian',
        'pt': 'Portuguese',
        'pt-BR': 'Portuguese (Brazil)',
        'ar': 'Arabic',
        'hi': 'Hindi',
        'th': 'Thai',
        'vi': 'Vietnamese'
      };

      return languageMap[languageCode] || languageCode;
    } catch (error) {
      this.Logger.error('Failed to format language', error as Error);
      return languageCode;
    }
  }

  /**
   * æ ¼å¼åŒ–æ—¥æœŸèŒƒå›?   * @param startDate å¼€å§‹æ—¥æœ?   * @param endDate ç»“æŸæ—¥æœŸ
   */
  public formatDateRange(startDate: Date | string | number, endDate: Date | string | number instanceof Error ? endDate: Date | string | number : new Error(String(endDate: Date | string | number instanceof Error ? endDate: Date | string | number instanceof Error ? endDate: Date | string | number : new Error(String(endDate: Date | string | number : new Error(String(endDate: Date | string | number instanceof Error ? endDate: Date | string | number : new Error(String(endDate: Date | string | number instanceof Error ? endDate: Date | string | number instanceof Error ? endDate: Date | string | number : new Error(String(endDate: Date | string | number instanceof Error ? endDate: Date | string | number instanceof Error ? endDate: Date | string | number : new Error(String(endDate: Date | string | number : new Error(String(endDate: Date | string | number instanceof Error ? endDate: Date | string | number : new Error(String(endDate: Date | string | number : new Error(String(endDate: Date | string | number instanceof Error ? endDate: Date | string | number : new Error(String(endDate: Date | string | number instanceof Error ? endDate: Date | string | number instanceof Error ? endDate: Date | string | number : new Error(String(endDate: Date | string | number : new Error(String(endDate: Date | string | number instanceof Error ? endDate: Date | string | number : new Error(String(endDate: Date | string | number))))))): string {
    try {
      const start = new Date(startDate);
      const end = new Date(endDate);

      if (isNaN(start.getTime()) || isNaN(end.getTime())) {
        return '';
      }

      const startYear = start.getFullYear();
      const endYear = end.getFullYear();

      if (startYear === endYear) {
        // åŒä¸€å¹?        return `${startYear}`;
      } else if (endYear === new Date().getFullYear()) {
        // ç»“æŸå¹´ä»½æ˜¯å½“å‰å¹´ï¼Œæ˜¾ç¤ºè‡³ä»?        return `${startYear} - Present`;
      } else {
        // ä¸åŒå¹´ä»½
        return `${startYear} - ${endYear}`;
      }
    } catch (error) {
      this.Logger.error('Failed to format date range', error as Error);
      return '';
    }
  }

  /**
   * æ ¼å¼åŒ–æœç´¢å…³é”®è¯ï¼ˆé«˜äº®ç­‰ï¼?   * @param text åŸå§‹æ–‡æœ¬
   * @param keyword å…³é”®è¯?   * @param highlight æ˜¯å¦é«˜äº®
   */
  public formatSearchKeyword(text: string, keyword: string, highlight: boolean = true instanceof Error ? keyword: string, highlight: boolean = true : new Error(String(keyword: string, highlight: boolean = true instanceof Error ? keyword: string, highlight: boolean = true instanceof Error ? keyword: string, highlight: boolean = true : new Error(String(keyword: string, highlight: boolean = true : new Error(String(keyword: string, highlight: boolean = true instanceof Error ? keyword: string, highlight: boolean = true : new Error(String(keyword: string, highlight: boolean = true instanceof Error ? keyword: string, highlight: boolean = true instanceof Error ? keyword: string, highlight: boolean = true : new Error(String(keyword: string, highlight: boolean = true instanceof Error ? keyword: string, highlight: boolean = true instanceof Error ? keyword: string, highlight: boolean = true : new Error(String(keyword: string, highlight: boolean = true : new Error(String(keyword: string, highlight: boolean = true instanceof Error ? keyword: string, highlight: boolean = true : new Error(String(keyword: string, highlight: boolean = true : new Error(String(keyword: string, highlight: boolean = true instanceof Error ? keyword: string, highlight: boolean = true : new Error(String(keyword: string, highlight: boolean = true instanceof Error ? keyword: string, highlight: boolean = true instanceof Error ? keyword: string, highlight: boolean = true : new Error(String(keyword: string, highlight: boolean = true : new Error(String(keyword: string, highlight: boolean = true instanceof Error ? keyword: string, highlight: boolean = true : new Error(String(keyword: string, highlight: boolean = true))))))): string {
    try {
      if (!text || !keyword) {
        return text || '';
      }

      if (!highlight) {
        return text;
      }

      // ä¸ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ï¼Œæ”¹ç”¨å­—ç¬¦ä¸²æ–¹æ³•å®ç°å…³é”®è¯é«˜äº?      const lowerText = text.toLowerCase();
      const lowerKeyword = keyword.toLowerCase();
      let result = '';
      let lastIndex = 0;
      let currentIndex = lowerText.indexOf(lowerKeyword, lastIndex);
      
      while (currentIndex !== -1) {
        // æ·»åŠ å…³é”®è¯å‰çš„æ–‡æœ?        result += text.substring(lastIndex, currentIndex);
        // æ·»åŠ é«˜äº®çš„å…³é”®è¯
        result += '<mark>' + text.substring(currentIndex, currentIndex + keyword.length) + '</mark>';
        // æ›´æ–°ç´¢å¼•ç»§ç»­æŸ¥æ‰¾
        lastIndex = currentIndex + keyword.length;
        currentIndex = lowerText.indexOf(lowerKeyword, lastIndex);
      }
      
      // æ·»åŠ æœ€åä¸€éƒ¨åˆ†æ–‡æœ¬
      result += text.substring(lastIndex);
      return result;
    } catch (error) {
      this.Logger.error('Failed to format search keyword', error as Error);
      return text || '';
    }
  }

  /**
   * æ ¼å¼åŒ–æ–‡ä»¶æ‰©å±•åï¼ˆå¤§å†™ï¼‰
   * @param extension æ‰©å±•å?   */
  public formatExtension(extension: string): string {
    try {
      return extension ? extension.toUpperCase().replace(/^./, '' instanceof Error ? '' : new Error(String('' instanceof Error ? '' instanceof Error ? '' : new Error(String('' : new Error(String('' instanceof Error ? '' : new Error(String('' instanceof Error ? '' instanceof Error ? '' : new Error(String('' instanceof Error ? '' instanceof Error ? '' : new Error(String('' : new Error(String('' instanceof Error ? '' : new Error(String('' : new Error(String('' instanceof Error ? '' : new Error(String('' instanceof Error ? '' instanceof Error ? '' : new Error(String('' : new Error(String('' instanceof Error ? '' : new Error(String(''))))))) : '';
    } catch (error) {
      this.Logger.error('Failed to format extension', error as Error);
      return '';
    }
  }

  /**
   * æ ¼å¼åŒ–è¯„åˆ?   * @param score è¯„åˆ†å€?   * @param maxScore æœ€å¤§è¯„åˆ†å€?   * @param decimals å°æ•°ä½æ•°
   */
  public formatRating(score: number, maxScore: number = 10, decimals: number = 1 instanceof Error ? maxScore: number = 10, decimals: number = 1 : new Error(String(maxScore: number = 10, decimals: number = 1 instanceof Error ? maxScore: number = 10, decimals: number = 1 instanceof Error ? maxScore: number = 10, decimals: number = 1 : new Error(String(maxScore: number = 10, decimals: number = 1 : new Error(String(maxScore: number = 10, decimals: number = 1 instanceof Error ? maxScore: number = 10, decimals: number = 1 : new Error(String(maxScore: number = 10, decimals: number = 1 instanceof Error ? maxScore: number = 10, decimals: number = 1 instanceof Error ? maxScore: number = 10, decimals: number = 1 : new Error(String(maxScore: number = 10, decimals: number = 1 instanceof Error ? maxScore: number = 10, decimals: number = 1 instanceof Error ? maxScore: number = 10, decimals: number = 1 : new Error(String(maxScore: number = 10, decimals: number = 1 : new Error(String(maxScore: number = 10, decimals: number = 1 instanceof Error ? maxScore: number = 10, decimals: number = 1 : new Error(String(maxScore: number = 10, decimals: number = 1 : new Error(String(maxScore: number = 10, decimals: number = 1 instanceof Error ? maxScore: number = 10, decimals: number = 1 : new Error(String(maxScore: number = 10, decimals: number = 1 instanceof Error ? maxScore: number = 10, decimals: number = 1 instanceof Error ? maxScore: number = 10, decimals: number = 1 : new Error(String(maxScore: number = 10, decimals: number = 1 : new Error(String(maxScore: number = 10, decimals: number = 1 instanceof Error ? maxScore: number = 10, decimals: number = 1 : new Error(String(maxScore: number = 10, decimals: number = 1))))))): string {
    try {
      if (isNaN(score) || score < 0) {
        return '0';
      }

      const normalizedScore = Math.min(score, maxScore);
      return normalizedScore.toFixed(decimals);
    } catch (error) {
      this.Logger.error('Failed to format rating', error as Error);
      return '0';
    }
  }

  /**
   * æ ¼å¼åŒ–å›½å®?åœ°åŒºä»£ç 
   * @param countryCode å›½å®¶/åœ°åŒºä»£ç 
   */
  public formatCountry(countryCode: string): string {
    try {
      const countryMap: Record<string, string> = {
        'US': 'United States',
        'CN': 'China',
        'JP': 'Japan',
        'KR': 'South Korea',
        'UK': 'United Kingdom',
        'FR': 'France',
        'DE': 'Germany',
        'IT': 'Italy',
        'ES': 'Spain',
        'RU': 'Russia',
        'BR': 'Brazil',
        'IN': 'India',
        'AU': 'Australia',
        'CA': 'Canada',
        'MX': 'Mexico',
        'TH': 'Thailand',
        'VN': 'Vietnam',
        'SG': 'Singapore',
        'HK': 'Hong Kong',
        'TW': 'Taiwan'
      };

      return countryMap[countryCode] || countryCode;
    } catch (error instanceof Error ? string> = {
        'US': 'United States',
        'CN': 'China',
        'JP': 'Japan',
        'KR': 'South Korea',
        'UK': 'United Kingdom',
        'FR': 'France',
        'DE': 'Germany',
        'IT': 'Italy',
        'ES': 'Spain',
        'RU': 'Russia',
        'BR': 'Brazil',
        'IN': 'India',
        'AU': 'Australia',
        'CA': 'Canada',
        'MX': 'Mexico',
        'TH': 'Thailand',
        'VN': 'Vietnam',
        'SG': 'Singapore',
        'HK': 'Hong Kong',
        'TW': 'Taiwan'
      };

      return countryMap[countryCode] || countryCode;
    } catch (error : new Error(String(string> = {
        'US': 'United States',
        'CN': 'China',
        'JP': 'Japan',
        'KR': 'South Korea',
        'UK': 'United Kingdom',
        'FR': 'France',
        'DE': 'Germany',
        'IT': 'Italy',
        'ES': 'Spain',
        'RU': 'Russia',
        'BR': 'Brazil',
        'IN': 'India',
        'AU': 'Australia',
        'CA': 'Canada',
        'MX': 'Mexico',
        'TH': 'Thailand',
        'VN': 'Vietnam',
        'SG': 'Singapore',
        'HK': 'Hong Kong',
        'TW': 'Taiwan'
      };

      return countryMap[countryCode] || countryCode;
    } catch (error instanceof Error ? string> = {
        'US': 'United States',
        'CN': 'China',
        'JP': 'Japan',
        'KR': 'South Korea',
        'UK': 'United Kingdom',
        'FR': 'France',
        'DE': 'Germany',
        'IT': 'Italy',
        'ES': 'Spain',
        'RU': 'Russia',
        'BR': 'Brazil',
        'IN': 'India',
        'AU': 'Australia',
        'CA': 'Canada',
        'MX': 'Mexico',
        'TH': 'Thailand',
        'VN': 'Vietnam',
        'SG': 'Singapore',
        'HK': 'Hong Kong',
        'TW': 'Taiwan'
      };

      return countryMap[countryCode] || countryCode;
    } catch (error instanceof Error ? string> = {
        'US': 'United States',
        'CN': 'China',
        'JP': 'Japan',
        'KR': 'South Korea',
        'UK': 'United Kingdom',
        'FR': 'France',
        'DE': 'Germany',
        'IT': 'Italy',
        'ES': 'Spain',
        'RU': 'Russia',
        'BR': 'Brazil',
        'IN': 'India',
        'AU': 'Australia',
        'CA': 'Canada',
        'MX': 'Mexico',
        'TH': 'Thailand',
        'VN': 'Vietnam',
        'SG': 'Singapore',
        'HK': 'Hong Kong',
        'TW': 'Taiwan'
      };

      return countryMap[countryCode] || countryCode;
    } catch (error : new Error(String(string> = {
        'US': 'United States',
        'CN': 'China',
        'JP': 'Japan',
        'KR': 'South Korea',
        'UK': 'United Kingdom',
        'FR': 'France',
        'DE': 'Germany',
        'IT': 'Italy',
        'ES': 'Spain',
        'RU': 'Russia',
        'BR': 'Brazil',
        'IN': 'India',
        'AU': 'Australia',
        'CA': 'Canada',
        'MX': 'Mexico',
        'TH': 'Thailand',
        'VN': 'Vietnam',
        'SG': 'Singapore',
        'HK': 'Hong Kong',
        'TW': 'Taiwan'
      };

      return countryMap[countryCode] || countryCode;
    } catch (error : new Error(String(string> = {
        'US': 'United States',
        'CN': 'China',
        'JP': 'Japan',
        'KR': 'South Korea',
        'UK': 'United Kingdom',
        'FR': 'France',
        'DE': 'Germany',
        'IT': 'Italy',
        'ES': 'Spain',
        'RU': 'Russia',
        'BR': 'Brazil',
        'IN': 'India',
        'AU': 'Australia',
        'CA': 'Canada',
        'MX': 'Mexico',
        'TH': 'Thailand',
        'VN': 'Vietnam',
        'SG': 'Singapore',
        'HK': 'Hong Kong',
        'TW': 'Taiwan'
      };

      return countryMap[countryCode] || countryCode;
    } catch (error instanceof Error ? string> = {
        'US': 'United States',
        'CN': 'China',
        'JP': 'Japan',
        'KR': 'South Korea',
        'UK': 'United Kingdom',
        'FR': 'France',
        'DE': 'Germany',
        'IT': 'Italy',
        'ES': 'Spain',
        'RU': 'Russia',
        'BR': 'Brazil',
        'IN': 'India',
        'AU': 'Australia',
        'CA': 'Canada',
        'MX': 'Mexico',
        'TH': 'Thailand',
        'VN': 'Vietnam',
        'SG': 'Singapore',
        'HK': 'Hong Kong',
        'TW': 'Taiwan'
      };

      return countryMap[countryCode] || countryCode;
    } catch (error : new Error(String(string> = {
        'US': 'United States',
        'CN': 'China',
        'JP': 'Japan',
        'KR': 'South Korea',
        'UK': 'United Kingdom',
        'FR': 'France',
        'DE': 'Germany',
        'IT': 'Italy',
        'ES': 'Spain',
        'RU': 'Russia',
        'BR': 'Brazil',
        'IN': 'India',
        'AU': 'Australia',
        'CA': 'Canada',
        'MX': 'Mexico',
        'TH': 'Thailand',
        'VN': 'Vietnam',
        'SG': 'Singapore',
        'HK': 'Hong Kong',
        'TW': 'Taiwan'
      };

      return countryMap[countryCode] || countryCode;
    } catch (error instanceof Error ? string> = {
        'US': 'United States',
        'CN': 'China',
        'JP': 'Japan',
        'KR': 'South Korea',
        'UK': 'United Kingdom',
        'FR': 'France',
        'DE': 'Germany',
        'IT': 'Italy',
        'ES': 'Spain',
        'RU': 'Russia',
        'BR': 'Brazil',
        'IN': 'India',
        'AU': 'Australia',
        'CA': 'Canada',
        'MX': 'Mexico',
        'TH': 'Thailand',
        'VN': 'Vietnam',
        'SG': 'Singapore',
        'HK': 'Hong Kong',
        'TW': 'Taiwan'
      };

      return countryMap[countryCode] || countryCode;
    } catch (error instanceof Error ? string> = {
        'US': 'United States',
        'CN': 'China',
        'JP': 'Japan',
        'KR': 'South Korea',
        'UK': 'United Kingdom',
        'FR': 'France',
        'DE': 'Germany',
        'IT': 'Italy',
        'ES': 'Spain',
        'RU': 'Russia',
        'BR': 'Brazil',
        'IN': 'India',
        'AU': 'Australia',
        'CA': 'Canada',
        'MX': 'Mexico',
        'TH': 'Thailand',
        'VN': 'Vietnam',
        'SG': 'Singapore',
        'HK': 'Hong Kong',
        'TW': 'Taiwan'
      };

      return countryMap[countryCode] || countryCode;
    } catch (error : new Error(String(string> = {
        'US': 'United States',
        'CN': 'China',
        'JP': 'Japan',
        'KR': 'South Korea',
        'UK': 'United Kingdom',
        'FR': 'France',
        'DE': 'Germany',
        'IT': 'Italy',
        'ES': 'Spain',
        'RU': 'Russia',
        'BR': 'Brazil',
        'IN': 'India',
        'AU': 'Australia',
        'CA': 'Canada',
        'MX': 'Mexico',
        'TH': 'Thailand',
        'VN': 'Vietnam',
        'SG': 'Singapore',
        'HK': 'Hong Kong',
        'TW': 'Taiwan'
      };

      return countryMap[countryCode] || countryCode;
    } catch (error instanceof Error ? string> = {
        'US': 'United States',
        'CN': 'China',
        'JP': 'Japan',
        'KR': 'South Korea',
        'UK': 'United Kingdom',
        'FR': 'France',
        'DE': 'Germany',
        'IT': 'Italy',
        'ES': 'Spain',
        'RU': 'Russia',
        'BR': 'Brazil',
        'IN': 'India',
        'AU': 'Australia',
        'CA': 'Canada',
        'MX': 'Mexico',
        'TH': 'Thailand',
        'VN': 'Vietnam',
        'SG': 'Singapore',
        'HK': 'Hong Kong',
        'TW': 'Taiwan'
      };

      return countryMap[countryCode] || countryCode;
    } catch (error instanceof Error ? string> = {
        'US': 'United States',
        'CN': 'China',
        'JP': 'Japan',
        'KR': 'South Korea',
        'UK': 'United Kingdom',
        'FR': 'France',
        'DE': 'Germany',
        'IT': 'Italy',
        'ES': 'Spain',
        'RU': 'Russia',
        'BR': 'Brazil',
        'IN': 'India',
        'AU': 'Australia',
        'CA': 'Canada',
        'MX': 'Mexico',
        'TH': 'Thailand',
        'VN': 'Vietnam',
        'SG': 'Singapore',
        'HK': 'Hong Kong',
        'TW': 'Taiwan'
      };

      return countryMap[countryCode] || countryCode;
    } catch (error : new Error(String(string> = {
        'US': 'United States',
        'CN': 'China',
        'JP': 'Japan',
        'KR': 'South Korea',
        'UK': 'United Kingdom',
        'FR': 'France',
        'DE': 'Germany',
        'IT': 'Italy',
        'ES': 'Spain',
        'RU': 'Russia',
        'BR': 'Brazil',
        'IN': 'India',
        'AU': 'Australia',
        'CA': 'Canada',
        'MX': 'Mexico',
        'TH': 'Thailand',
        'VN': 'Vietnam',
        'SG': 'Singapore',
        'HK': 'Hong Kong',
        'TW': 'Taiwan'
      };

      return countryMap[countryCode] || countryCode;
    } catch (error : new Error(String(string> = {
        'US': 'United States',
        'CN': 'China',
        'JP': 'Japan',
        'KR': 'South Korea',
        'UK': 'United Kingdom',
        'FR': 'France',
        'DE': 'Germany',
        'IT': 'Italy',
        'ES': 'Spain',
        'RU': 'Russia',
        'BR': 'Brazil',
        'IN': 'India',
        'AU': 'Australia',
        'CA': 'Canada',
        'MX': 'Mexico',
        'TH': 'Thailand',
        'VN': 'Vietnam',
        'SG': 'Singapore',
        'HK': 'Hong Kong',
        'TW': 'Taiwan'
      };

      return countryMap[countryCode] || countryCode;
    } catch (error instanceof Error ? string> = {
        'US': 'United States',
        'CN': 'China',
        'JP': 'Japan',
        'KR': 'South Korea',
        'UK': 'United Kingdom',
        'FR': 'France',
        'DE': 'Germany',
        'IT': 'Italy',
        'ES': 'Spain',
        'RU': 'Russia',
        'BR': 'Brazil',
        'IN': 'India',
        'AU': 'Australia',
        'CA': 'Canada',
        'MX': 'Mexico',
        'TH': 'Thailand',
        'VN': 'Vietnam',
        'SG': 'Singapore',
        'HK': 'Hong Kong',
        'TW': 'Taiwan'
      };

      return countryMap[countryCode] || countryCode;
    } catch (error : new Error(String(string> = {
        'US': 'United States',
        'CN': 'China',
        'JP': 'Japan',
        'KR': 'South Korea',
        'UK': 'United Kingdom',
        'FR': 'France',
        'DE': 'Germany',
        'IT': 'Italy',
        'ES': 'Spain',
        'RU': 'Russia',
        'BR': 'Brazil',
        'IN': 'India',
        'AU': 'Australia',
        'CA': 'Canada',
        'MX': 'Mexico',
        'TH': 'Thailand',
        'VN': 'Vietnam',
        'SG': 'Singapore',
        'HK': 'Hong Kong',
        'TW': 'Taiwan'
      };

      return countryMap[countryCode] || countryCode;
    } catch (error : new Error(String(string> = {
        'US': 'United States',
        'CN': 'China',
        'JP': 'Japan',
        'KR': 'South Korea',
        'UK': 'United Kingdom',
        'FR': 'France',
        'DE': 'Germany',
        'IT': 'Italy',
        'ES': 'Spain',
        'RU': 'Russia',
        'BR': 'Brazil',
        'IN': 'India',
        'AU': 'Australia',
        'CA': 'Canada',
        'MX': 'Mexico',
        'TH': 'Thailand',
        'VN': 'Vietnam',
        'SG': 'Singapore',
        'HK': 'Hong Kong',
        'TW': 'Taiwan'
      };

      return countryMap[countryCode] || countryCode;
    } catch (error instanceof Error ? string> = {
        'US': 'United States',
        'CN': 'China',
        'JP': 'Japan',
        'KR': 'South Korea',
        'UK': 'United Kingdom',
        'FR': 'France',
        'DE': 'Germany',
        'IT': 'Italy',
        'ES': 'Spain',
        'RU': 'Russia',
        'BR': 'Brazil',
        'IN': 'India',
        'AU': 'Australia',
        'CA': 'Canada',
        'MX': 'Mexico',
        'TH': 'Thailand',
        'VN': 'Vietnam',
        'SG': 'Singapore',
        'HK': 'Hong Kong',
        'TW': 'Taiwan'
      };

      return countryMap[countryCode] || countryCode;
    } catch (error : new Error(String(string> = {
        'US': 'United States',
        'CN': 'China',
        'JP': 'Japan',
        'KR': 'South Korea',
        'UK': 'United Kingdom',
        'FR': 'France',
        'DE': 'Germany',
        'IT': 'Italy',
        'ES': 'Spain',
        'RU': 'Russia',
        'BR': 'Brazil',
        'IN': 'India',
        'AU': 'Australia',
        'CA': 'Canada',
        'MX': 'Mexico',
        'TH': 'Thailand',
        'VN': 'Vietnam',
        'SG': 'Singapore',
        'HK': 'Hong Kong',
        'TW': 'Taiwan'
      };

      return countryMap[countryCode] || countryCode;
    } catch (error instanceof Error ? string> = {
        'US': 'United States',
        'CN': 'China',
        'JP': 'Japan',
        'KR': 'South Korea',
        'UK': 'United Kingdom',
        'FR': 'France',
        'DE': 'Germany',
        'IT': 'Italy',
        'ES': 'Spain',
        'RU': 'Russia',
        'BR': 'Brazil',
        'IN': 'India',
        'AU': 'Australia',
        'CA': 'Canada',
        'MX': 'Mexico',
        'TH': 'Thailand',
        'VN': 'Vietnam',
        'SG': 'Singapore',
        'HK': 'Hong Kong',
        'TW': 'Taiwan'
      };

      return countryMap[countryCode] || countryCode;
    } catch (error instanceof Error ? string> = {
        'US': 'United States',
        'CN': 'China',
        'JP': 'Japan',
        'KR': 'South Korea',
        'UK': 'United Kingdom',
        'FR': 'France',
        'DE': 'Germany',
        'IT': 'Italy',
        'ES': 'Spain',
        'RU': 'Russia',
        'BR': 'Brazil',
        'IN': 'India',
        'AU': 'Australia',
        'CA': 'Canada',
        'MX': 'Mexico',
        'TH': 'Thailand',
        'VN': 'Vietnam',
        'SG': 'Singapore',
        'HK': 'Hong Kong',
        'TW': 'Taiwan'
      };

      return countryMap[countryCode] || countryCode;
    } catch (error : new Error(String(string> = {
        'US': 'United States',
        'CN': 'China',
        'JP': 'Japan',
        'KR': 'South Korea',
        'UK': 'United Kingdom',
        'FR': 'France',
        'DE': 'Germany',
        'IT': 'Italy',
        'ES': 'Spain',
        'RU': 'Russia',
        'BR': 'Brazil',
        'IN': 'India',
        'AU': 'Australia',
        'CA': 'Canada',
        'MX': 'Mexico',
        'TH': 'Thailand',
        'VN': 'Vietnam',
        'SG': 'Singapore',
        'HK': 'Hong Kong',
        'TW': 'Taiwan'
      };

      return countryMap[countryCode] || countryCode;
    } catch (error : new Error(String(string> = {
        'US': 'United States',
        'CN': 'China',
        'JP': 'Japan',
        'KR': 'South Korea',
        'UK': 'United Kingdom',
        'FR': 'France',
        'DE': 'Germany',
        'IT': 'Italy',
        'ES': 'Spain',
        'RU': 'Russia',
        'BR': 'Brazil',
        'IN': 'India',
        'AU': 'Australia',
        'CA': 'Canada',
        'MX': 'Mexico',
        'TH': 'Thailand',
        'VN': 'Vietnam',
        'SG': 'Singapore',
        'HK': 'Hong Kong',
        'TW': 'Taiwan'
      };

      return countryMap[countryCode] || countryCode;
    } catch (error instanceof Error ? string> = {
        'US': 'United States',
        'CN': 'China',
        'JP': 'Japan',
        'KR': 'South Korea',
        'UK': 'United Kingdom',
        'FR': 'France',
        'DE': 'Germany',
        'IT': 'Italy',
        'ES': 'Spain',
        'RU': 'Russia',
        'BR': 'Brazil',
        'IN': 'India',
        'AU': 'Australia',
        'CA': 'Canada',
        'MX': 'Mexico',
        'TH': 'Thailand',
        'VN': 'Vietnam',
        'SG': 'Singapore',
        'HK': 'Hong Kong',
        'TW': 'Taiwan'
      };

      return countryMap[countryCode] || countryCode;
    } catch (error : new Error(String(string> = {
        'US': 'United States',
        'CN': 'China',
        'JP': 'Japan',
        'KR': 'South Korea',
        'UK': 'United Kingdom',
        'FR': 'France',
        'DE': 'Germany',
        'IT': 'Italy',
        'ES': 'Spain',
        'RU': 'Russia',
        'BR': 'Brazil',
        'IN': 'India',
        'AU': 'Australia',
        'CA': 'Canada',
        'MX': 'Mexico',
        'TH': 'Thailand',
        'VN': 'Vietnam',
        'SG': 'Singapore',
        'HK': 'Hong Kong',
        'TW': 'Taiwan'
      };

      return countryMap[countryCode] || countryCode;
    } catch (error))))))) {
      this.Logger.error('Failed to format country', error as Error);
      return countryCode;
    }
  }

  /**
   * æ ¼å¼åŒ–å­—ç¬¦ä¸²é¦–å­—æ¯å¤§å†?   * @param text æ–‡æœ¬
   * @param allWords æ˜¯å¦æ‰€æœ‰å•è¯éƒ½é¦–å­—æ¯å¤§å†?   */
  public capitalize(text: string, allWords: boolean = false instanceof Error ? allWords: boolean = false : new Error(String(allWords: boolean = false instanceof Error ? allWords: boolean = false instanceof Error ? allWords: boolean = false : new Error(String(allWords: boolean = false : new Error(String(allWords: boolean = false instanceof Error ? allWords: boolean = false : new Error(String(allWords: boolean = false instanceof Error ? allWords: boolean = false instanceof Error ? allWords: boolean = false : new Error(String(allWords: boolean = false instanceof Error ? allWords: boolean = false instanceof Error ? allWords: boolean = false : new Error(String(allWords: boolean = false : new Error(String(allWords: boolean = false instanceof Error ? allWords: boolean = false : new Error(String(allWords: boolean = false : new Error(String(allWords: boolean = false instanceof Error ? allWords: boolean = false : new Error(String(allWords: boolean = false instanceof Error ? allWords: boolean = false instanceof Error ? allWords: boolean = false : new Error(String(allWords: boolean = false : new Error(String(allWords: boolean = false instanceof Error ? allWords: boolean = false : new Error(String(allWords: boolean = false))))))): string {
    try {
      if (!text) {
        return '';
      }

      if (allWords) {
        return text.toLowerCase().replace(/\b\w/g, (char) => char.toUpperCase());
      } else {
        return text.charAt(0).toUpperCase() + text.slice(1).toLowerCase();
      }
    } catch (error) {
      this.Logger.error('Failed to capitalize text', error as Error);
      return text || '';
    }
  }

  /**
   * æ ¼å¼åŒ–é”™è¯¯æ¶ˆæ?   * @param error é”™è¯¯å¯¹è±¡æˆ–æ¶ˆæ?   */
  public formatErrorMessage(error: Record<string, string | number | boolean | null> instanceof Error ? string | number | boolean | null> : new Error(String(string | number | boolean | null>))): string {
    try {
      if (!error) {
        return 'Unknown error';
      }

      if (error instanceof Error) {
        return error.message || 'Unknown error';
      } else if (typeof error === 'string') {
        return error;
      } else if (error.message) {
        return error.message;
      } else {
        return String(error);
      }
    } catch (error) {
      this.Logger.error('Failed to format error message', error as Error instanceof Error ? error as Error : new Error(String(error as Error instanceof Error ? error as Error instanceof Error ? error as Error : new Error(String(error as Error : new Error(String(error as Error instanceof Error ? error as Error : new Error(String(error as Error)))));
      return 'Unknown error';
    }
  }

  /**
   * æ ¼å¼åŒ–æ–‡ä»¶è·¯å¾„ï¼ˆçŸ­è·¯å¾„æ˜¾ç¤ºï¼‰
   * @param path æ–‡ä»¶è·¯å¾„
   * @param maxLength æœ€å¤§é•¿åº?   */
  public formatPath(path: string, maxLength: number = 40 instanceof Error ? maxLength: number = 40 : new Error(String(maxLength: number = 40))): string {
    try {
      if (!path) {
        return '';
      }

      if (path.length <= maxLength) {
        return path;
      }

      const ellipsis = '...';
      const availableLength = maxLength - ellipsis.length;
      const firstPartLength = Math.floor(availableLength * 0.3);
      const lastPartLength = Math.ceil(availableLength * 0.7);

      return path.slice(0, firstPartLength) + ellipsis + path.slice(-lastPartLength);
    } catch (error) {
      this.Logger.error('Failed to format path', error as Error);
      return path || '';
    }
  }

  /**
   * æ ¼å¼åŒ–JSONå­—ç¬¦ä¸²ï¼ˆç¾åŒ–ï¼?   * @param json JSONå­—ç¬¦ä¸²æˆ–å¯¹è±¡
   * @param indent ç¼©è¿›ç©ºæ ¼æ•?   */
  public formatJSON(json: string | object, indent: number = 2 instanceof Error ? indent: number = 2 : new Error(String(indent: number = 2 instanceof Error ? indent: number = 2 instanceof Error ? indent: number = 2 : new Error(String(indent: number = 2 : new Error(String(indent: number = 2 instanceof Error ? indent: number = 2 : new Error(String(indent: number = 2 instanceof Error ? indent: number = 2 instanceof Error ? indent: number = 2 : new Error(String(indent: number = 2 instanceof Error ? indent: number = 2 instanceof Error ? indent: number = 2 : new Error(String(indent: number = 2 : new Error(String(indent: number = 2 instanceof Error ? indent: number = 2 : new Error(String(indent: number = 2 : new Error(String(indent: number = 2 instanceof Error ? indent: number = 2 : new Error(String(indent: number = 2 instanceof Error ? indent: number = 2 instanceof Error ? indent: number = 2 : new Error(String(indent: number = 2 : new Error(String(indent: number = 2 instanceof Error ? indent: number = 2 : new Error(String(indent: number = 2))))))): string {
    try {
      let obj: Record<string, string | number | boolean | null>;
      if (typeof json === 'string') {
        obj = JSON.parse(json);
      } else {
        obj = json;
      }

      return JSON.stringify(obj, null, indent);
    } catch (error) {
      this.Logger.error('Failed to format JSON', error as Error);
      return typeof json === 'string' ? json : '';
    }
  }

  /**
   * æ ¼å¼åŒ–ç‰ˆæœ¬å·
   * @param version ç‰ˆæœ¬å?   */
  public formatVersion(version: string): string {
    try {
      if (!version) {
        return '0.0.0';
      }

      // ç¡®ä¿ç‰ˆæœ¬å·æ ¼å¼æ­£ç¡?      const parts = version.split('.').map(p => parseInt(p, 10 instanceof Error ? 10 : new Error(String(10 instanceof Error ? 10 instanceof Error ? 10 : new Error(String(10 : new Error(String(10 instanceof Error ? 10 : new Error(String(10 instanceof Error ? 10 instanceof Error ? 10 : new Error(String(10 instanceof Error ? 10 instanceof Error ? 10 : new Error(String(10 : new Error(String(10 instanceof Error ? 10 : new Error(String(10 : new Error(String(10 instanceof Error ? 10 : new Error(String(10 instanceof Error ? 10 instanceof Error ? 10 : new Error(String(10 : new Error(String(10 instanceof Error ? 10 : new Error(String(10))))))) || 0);
      while (parts.length < 3) {
        parts.push(0);
      }

      return parts.slice(0, 3).join('.');
    } catch (error) {
      this.Logger.error('Failed to format version', error as Error);
      return '0.0.0';
    }
  }

  /**
   * æ ¼å¼åŒ–æ’­æ”¾æ¬¡æ•?   * @param count æ’­æ”¾æ¬¡æ•°
   */
  public formatPlayCount(count: number): string {
    try {
      if (isNaN(count) || count < 0) {
        return '0';
      }

      if (count === 0) {
        return 'Never played';
      } else if (count === 1) {
        return 'Played once';
      } else if (count < 1000) {
        return `${count} plays`;
      } else {
        return this.formatLargeNumber(count) + ' plays';
      }
    } catch (error) {
      this.logger.error('Failed to format play count', error as Error instanceof Error ? error as Error : new Error(String(error as Error instanceof Error ? error as Error instanceof Error ? error as Error : new Error(String(error as Error : new Error(String(error as Error instanceof Error ? error as Error : new Error(String(error as Error instanceof Error ? error as Error instanceof Error ? error as Error : new Error(String(error as Error instanceof Error ? error as Error instanceof Error ? error as Error : new Error(String(error as Error : new Error(String(error as Error instanceof Error ? error as Error : new Error(String(error as Error : new Error(String(error as Error instanceof Error ? error as Error : new Error(String(error as Error instanceof Error ? error as Error instanceof Error ? error as Error : new Error(String(error as Error : new Error(String(error as Error instanceof Error ? error as Error : new Error(String(error as Error)))))));
      return '0';
    }
  }

  /**
   * æ ¼å¼åŒ–ç›¸å¯¹æ—¶é—?   * @param date æ—¥æœŸ
   */
  public formatRelativeTime(date: Date | number | string): string {
    try {
      const now = new Date();
      const target = new Date(date);
      
      if (isNaN(target.getTime())) {
        return '';
      }

      const seconds = Math.floor((now.getTime() - target.getTime()) / 1000);

      if (seconds < 60) {
        return seconds === 0 ? 'Just now' : `${seconds} second${seconds > 1 ? 's' : ''} ago`;
      } else if (seconds < 3600) {
        const minutes = Math.floor(seconds / 60);
        return `${minutes} minute${minutes > 1 ? 's' : ''} ago`;
      } else if (seconds < 86400) {
        const hours = Math.floor(seconds / 3600);
        return `${hours} hour${hours > 1 ? 's' : ''} ago`;
      } else if (seconds < 604800) {
        const days = Math.floor(seconds / 86400);
        return `${days} day${days > 1 ? 's' : ''} ago`;
      } else if (seconds < 2592000) {
        const weeks = Math.floor(seconds / 604800);
        return `${weeks} week${weeks > 1 ? 's' : ''} ago`;
      } else if (seconds < 31536000) {
        const months = Math.floor(seconds / 2592000);
        return `${months} month${months > 1 ? 's' : ''} ago`;
      } else {
        const years = Math.floor(seconds / 31536000);
        return `${years} year${years > 1 ? 's' : ''} ago`;
      }
    } catch (error) {
      this.logger.error('Failed to format relative time', error as Error);
      return '';
    }
  }
}


