/**
 * Day 3 ç»„ä»¶éªŒè¯é¡µé¢ | Day 3 Component Validation Page
 * éªŒè¯æ–°åˆ›å»ºçš„ç»„ä»¶åŠŸèƒ½
 * Validate the functionality of newly created components
 */

import { Button, PrimaryButton, SecondaryButton } from './components/Button.ets';
import { Input, TextInput, PasswordInput } from './components/Input.ets';
import { Logger } from './common/utils/Logger.ets';

@Entry
@Component
struct Day3ValidationPage {
  @State validationResults: string[] = [];
  @State isRunning: boolean = false;
  @State inputValue: string = '';
  @State buttonClicked: boolean = false;

  aboutToAppear() {
    this.runValidation();
  }

  async runValidation() {
    this.isRunning = true;
    this.validationResults = ['ðŸš€ å¼€å§‹Day 3ç»„ä»¶éªŒè¯...'];
    
    try {
      // éªŒè¯æŒ‰é’®ç»„ä»¶
      await this.validateButtons();
      
      // éªŒè¯è¾“å…¥æ¡†ç»„ä»¶
      await this.validateInputs();
      
      // éªŒè¯ç»„ä»¶é›†æˆ
      await this.validateIntegration();
      
      this.validationResults.push('ðŸŽ‰ æ‰€æœ‰ç»„ä»¶éªŒè¯å®Œæˆï¼');
      
    } catch (error) {
      this.validationResults.push(`âŒ éªŒè¯è¿‡ç¨‹ä¸­å‡ºçŽ°é”™è¯¯: ${error}`);
    } finally {
      this.isRunning = false;
    }
  }

  async validateButtons() {
    this.validationResults.push('\nðŸ§ª éªŒè¯æŒ‰é’®ç»„ä»¶...');
    
    try {
      // æµ‹è¯•æŒ‰é’®åˆ›å»º
      const primaryBtn = new PrimaryButton({
        children: 'ä¸»è¦æŒ‰é’®',
        onClick: () => {
          this.buttonClicked = true;
          this.validationResults.push('âœ… ä¸»è¦æŒ‰é’®ç‚¹å‡»äº‹ä»¶æ­£å¸¸');
        }
      });
      
      const secondaryBtn = new SecondaryButton({
        children: 'æ¬¡è¦æŒ‰é’®',
        onClick: () => {
          this.validationResults.push('âœ… æ¬¡è¦æŒ‰é’®ç‚¹å‡»äº‹ä»¶æ­£å¸¸');
        }
      });
      
      // æµ‹è¯•æŒ‰é’®å±žæ€§æ›´æ–°
      primaryBtn.updateProps({ disabled: true });
      secondaryBtn.updateProps({ loading: true });
      
      this.validationResults.push('âœ… æŒ‰é’®ç»„ä»¶åˆ›å»ºå’Œå±žæ€§æ›´æ–°æ­£å¸¸');
      
    } catch (error) {
      this.validationResults.push(`âŒ æŒ‰é’®ç»„ä»¶éªŒè¯å¤±è´¥: ${error}`);
    }
  }

  async validateInputs() {
    this.validationResults.push('\nðŸ§ª éªŒè¯è¾“å…¥æ¡†ç»„ä»¶...');
    
    try {
      // æµ‹è¯•è¾“å…¥æ¡†åˆ›å»º
      const textInput = new TextInput({
        placeholder: 'è¯·è¾“å…¥æ–‡æœ¬',
        onInput: (value: string) => {
          this.inputValue = value;
          this.validationResults.push(`âœ… æ–‡æœ¬è¾“å…¥: ${value}`);
        }
      });
      
      const pwdInput = new PasswordInput({
        placeholder: 'è¯·è¾“å…¥å¯†ç ',
        onInput: (value: string) => {
          this.validationResults.push(`âœ… å¯†ç è¾“å…¥: ${'*'.repeat(value.length)}`);
        }
      });
      
      // æµ‹è¯•è¾“å…¥æ¡†æ–¹æ³•
      textInput.setValue('æµ‹è¯•å€¼');
      const value = textInput.getValue();
      
      if (value === 'æµ‹è¯•å€¼') {
        this.validationResults.push('âœ… è¾“å…¥æ¡†å€¼è®¾ç½®å’ŒèŽ·å–æ­£å¸¸');
      }
      
      textInput.clear();
      if (textInput.getValue() === '') {
        this.validationResults.push('âœ… è¾“å…¥æ¡†æ¸…ç©ºåŠŸèƒ½æ­£å¸¸');
      }
      
    } catch (error) {
      this.validationResults.push(`âŒ è¾“å…¥æ¡†ç»„ä»¶éªŒè¯å¤±è´¥: ${error}`);
    }
  }

  async validateIntegration() {
    this.validationResults.push('\nðŸ§ª éªŒè¯ç»„ä»¶é›†æˆ...');
    
    try {
      // æµ‹è¯•ç»„ä»¶é—´çš„äº¤äº’
      const logger = new Logger('ComponentIntegration');
      logger.info('å¼€å§‹ç»„ä»¶é›†æˆæµ‹è¯•');
      
      // æ¨¡æ‹Ÿè¡¨å•åœºæ™¯
      let formData = {
        username: '',
        password: ''
      };
      
      const usernameInput = new TextInput({
        placeholder: 'ç”¨æˆ·å',
        onInput: (value: string) => {
          formData.username = value;
        }
      });
      
      const passwordInput = new PasswordInput({
        placeholder: 'å¯†ç ',
        onInput: (value: string) => {
          formData.password = value;
        }
      });
      
      const submitButton = new PrimaryButton({
        children: 'æäº¤',
        onClick: () => {
          if (formData.username && formData.password) {
            this.validationResults.push(`âœ… è¡¨å•æäº¤æˆåŠŸ: ${JSON.stringify(formData)}`);
          } else {
            this.validationResults.push('âŒ è¡¨å•æ•°æ®ä¸å®Œæ•´');
          }
        }
      });
      
      this.validationResults.push('âœ… ç»„ä»¶é›†æˆå’Œäº¤äº’æ­£å¸¸');
      
    } catch (error) {
      this.validationResults.push(`âŒ ç»„ä»¶é›†æˆéªŒè¯å¤±è´¥: ${error}`);
    }
  }

  build() {
    Column() {
      // æ ‡é¢˜åŒºåŸŸ
      Text('RayTV Day 3 ç»„ä»¶éªŒè¯')
        .fontSize(24)
        .fontWeight(FontWeight.Bold)
        .margin({ bottom: 20 })

      if (this.isRunning) {
        Row() {
          LoadingProgress()
            .width(20)
            .height(20)
            .margin({ right: 10 })
          Text('éªŒè¯è¿›è¡Œä¸­...')
            .fontSize(16)
        }
        .margin({ bottom: 20 })
      }

      // éªŒè¯ç»“æžœæ˜¾ç¤ºåŒºåŸŸ
      Scroller() {
        Column() {
          ForEach(this.validationResults, (result: string, index: number) => {
            Text(result)
              .fontSize(14)
              .textAlign(TextAlign.Start)
              .width('100%')
              .padding(12)
              .backgroundColor(index % 2 === 0 ? '#F8F9FA' : '#FFFFFF')
              .borderRadius(6)
              .margin({ bottom: 4 })
          })
        }
        .width('100%')
        .padding(16)
      }
      .layoutWeight(1)
      .backgroundColor('#F0F2F5')

      // ç»„ä»¶æ¼”ç¤ºåŒºåŸŸ
      Column() {
        Text('ç»„ä»¶æ¼”ç¤ºåŒº')
          .fontSize(18)
          .fontWeight(FontWeight.Medium)
          .margin({ bottom: 16 })

        // æŒ‰é’®æ¼”ç¤º
        Row({ space: 12 }) {
          PrimaryButton({
            children: 'ä¸»è¦æŒ‰é’®',
            onClick: () => {
              this.validationResults.push('âœ… æ¼”ç¤ºæŒ‰é’®è¢«ç‚¹å‡»');
            }
          }).render()

          SecondaryButton({
            children: 'æ¬¡è¦æŒ‰é’®',
            onClick: () => {
              this.validationResults.push('âœ… æ¬¡è¦æŒ‰é’®è¢«ç‚¹å‡»');
            }
          }).render()
        }
        .margin({ bottom: 16 })

        // è¾“å…¥æ¡†æ¼”ç¤º
        Column({ space: 12 }) {
          TextInput({
            placeholder: 'æ¼”ç¤ºè¾“å…¥æ¡†',
            onInput: (value: string) => {
              this.validationResults.push(`âœ… æ¼”ç¤ºè¾“å…¥: ${value}`);
            }
          }).render()

          PasswordInput({
            placeholder: 'æ¼”ç¤ºå¯†ç æ¡†',
            onInput: (value: string) => {
              this.validationResults.push(`âœ… æ¼”ç¤ºå¯†ç è¾“å…¥: ${'*'.repeat(value.length)}`);
            }
          }).render()
        }
      }
      .width('100%')
      .padding(20)
      .backgroundColor('#FFFFFF')
      .borderRadius(12)
      .margin({ bottom: 20 })

      // æŽ§åˆ¶æŒ‰é’®
      Button('é‡æ–°è¿è¡ŒéªŒè¯')
        .width('80%')
        .height(48)
        .backgroundColor('#007AFF')
        .fontColor(Color.White)
        .borderRadius(8)
        .onClick(() => {
          this.runValidation();
        })
    }
    .width('100%')
    .height('100%')
    .padding(20)
    .backgroundColor('#FFFFFF')
  }
}