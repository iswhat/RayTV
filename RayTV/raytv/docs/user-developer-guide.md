# RayTV 用户和开发者指南

## 1. 用户指南

### 1.1 应用介绍

RayTV 是一款基于 HarmonyOS 平台的高性能、安全的多媒体播放应用，支持直播、点播等多种媒体形式，提供丰富的个性化设置和流畅的播放体验。

### 1.2 安装指南

#### 1.2.1 系统要求

- HarmonyOS 2.0 及以上版本
- 至少 2GB RAM
- 至少 50MB 存储空间
- 网络连接（推荐 Wi-Fi 或 4G/5G）

#### 1.2.2 安装步骤

1. 从 HarmonyOS 应用商店搜索 "RayTV"
2. 点击 "安装" 按钮
3. 等待安装完成
4. 点击 "打开" 启动应用

### 1.3 基本使用方法

#### 1.3.1 首次启动

1. 首次启动时，应用会提示您设置基本配置
2. 选择默认播放器和网络设置
3. 点击 "完成" 进入主界面

#### 1.3.2 浏览内容

- **主界面**：展示推荐内容和热门节目
- **分类浏览**：点击底部导航栏的 "分类" 按钮，浏览不同类型的内容
- **搜索**：点击顶部搜索图标，输入关键词搜索内容

#### 1.3.3 播放控制

- **播放/暂停**：点击播放器中央的播放/暂停按钮
- **音量控制**：点击播放器右下角的音量图标，拖动滑块调整音量
- **进度条**：拖动进度条快进或快退
- **全屏**：点击播放器右下角的全屏图标
- **字幕**：点击播放器底部的字幕图标，选择字幕语言和样式

#### 1.3.4 收藏和历史

- **收藏**：在内容详情页点击 "收藏" 按钮，将内容添加到收藏列表
- **查看收藏**：点击底部导航栏的 "我的" 按钮，选择 "我的收藏"
- **播放历史**：在 "我的" 页面查看最近播放的内容
- **清除历史**：在播放历史页面点击 "清除" 按钮

### 1.4 高级功能

#### 1.4.1 个性化设置

1. 点击底部导航栏的 "我的" 按钮
2. 选择 "设置"
3. 可调整以下设置：
   - **播放器设置**：自动播放、硬件解码、字幕样式等
   - **网络设置**：缓存策略、网络类型选择等
   - **显示设置**：主题、字体大小等
   - **安全设置**：隐私保护、访问控制等

#### 1.4.2 设备流转

1. 确保多设备已连接到同一网络
2. 在播放界面点击右上角的 "流转" 图标
3. 选择目标设备
4. 媒体内容将自动流转到目标设备

#### 1.4.3 家长控制

1. 进入 "设置" -> "安全设置"
2. 开启 "家长控制"
3. 设置 PIN 码
4. 选择受限内容类型
5. 确认设置

### 1.5 故障排除

#### 1.5.1 常见问题

| 问题 | 可能原因 | 解决方案 |
|------|----------|----------|
| 无法播放视频 | 网络连接问题 | 检查网络连接，尝试切换网络 |
|  | 视频格式不支持 | 尝试使用其他播放器 |
|  | 版权限制 | 确认内容版权状态 |
| 应用崩溃 | 内存不足 | 关闭其他应用，重启设备 |
|  | 应用版本过旧 | 更新到最新版本 |
| 缓冲缓慢 | 网络速度慢 | 切换到更快的网络 |
|  | 服务器负载高 | 稍后再试 |
| 无法收藏内容 | 存储空间不足 | 清理设备存储空间 |
|  | 网络问题 | 检查网络连接 |

#### 1.5.2 联系支持

- **应用内反馈**：进入 "设置" -> "关于" -> "反馈"
- **邮箱**：support@raytv.com
- **官方网站**：https://www.raytv.com/support

## 2. 开发者指南

### 2.1 开发环境设置

#### 2.1.1 必要工具

- HarmonyOS SDK 3.0 及以上
- DevEco Studio 3.0 及以上
- Node.js 14.0 及以上
- TypeScript 4.0 及以上

#### 2.1.2 环境配置

1. 安装 DevEco Studio
2. 配置 HarmonyOS SDK
3. 克隆项目代码：
   ```bash
   git clone https://github.com/raytv/raytv.git
   ```
4. 安装依赖：
   ```bash
   cd raytv
   npm install
   ```

### 2.2 项目结构

```
raytv/
├── AppScope/
├── entry/
├── raytv/
│   ├── src/
│   │   ├── main/ets/
│   │   │   ├── ability/        # 应用能力
│   │   │   ├── component/      # UI组件
│   │   │   ├── pages/          # 页面
│   │   │   ├── service/        # 服务
│   │   │   ├── common/         # 通用工具
│   │   │   └── model/          # 数据模型
│   │   ├── test/               # 测试代码
│   ├── docs/                   # 文档
│   └── config.json             # 项目配置
├── build.gradle
└── package.json
```

### 2.3 开发流程

#### 2.3.1 分支管理

- **main**：主分支，包含稳定版本
- **develop**：开发分支，包含最新功能
- **feature/***：功能分支，开发新功能
- **bugfix/***：修复分支，修复bug

#### 2.3.2 代码提交规范

使用语义化提交消息格式：

```
<type>(<scope>): <description>

<body>

<footer>
```

**类型**：
- feat: 新功能
- fix: 修复bug
- docs: 文档更新
- style: 代码风格调整
- refactor: 代码重构
- test: 测试代码
- chore: 构建过程或辅助工具的变动

#### 2.3.3 开发步骤

1. 从 develop 分支创建功能分支
2. 实现功能或修复bug
3. 编写测试代码
4. 运行测试确保通过
5. 提交代码到远程仓库
6. 创建 Pull Request 到 develop 分支
7. 代码审查通过后合并

### 2.4 代码规范

#### 2.4.1 TypeScript/ArkTS 规范

- 使用 2 空格缩进
- 使用单引号字符串
- 使用驼峰命名法
- 类名使用 PascalCase
- 变量和函数名使用 camelCase
- 常量使用全大写+下划线
- 接口名使用 I 前缀
- 每行代码不超过 120 字符
- 使用 JSDoc 注释公共接口

#### 2.4.2 最佳实践

- **单一职责原则**：每个类和函数只负责一个功能
- **依赖注入**：使用依赖注入管理服务实例
- **错误处理**：使用 try-catch 捕获异常，记录错误日志
- **安全编码**：避免硬编码敏感信息，使用安全存储
- **性能优化**：避免不必要的网络请求和计算
- **可测试性**：编写可测试的代码，使用单元测试

### 2.5 测试指南

#### 2.5.1 测试框架

- **单元测试**：使用 @ohos/hypium 框架
- **集成测试**：使用 @ohos/hypium 框架
- **UI测试**：使用 @ohos/hypium-ui 框架

#### 2.5.2 运行测试

```bash
# 运行单元测试
npm test

# 运行集成测试
npm run test:integration

# 运行所有测试
npm run test:all

# 生成测试覆盖报告
npm run test:coverage
```

#### 2.5.3 测试覆盖要求

- 核心服务：≥ 80%
- 工具类：≥ 90%
- 数据模型：≥ 70%
- UI组件：≥ 60%

### 2.6 部署指南

#### 2.6.1 构建应用

```bash
# 构建调试版本
npm run build:debug

# 构建发布版本
npm run build:release
```

#### 2.6.2 签名配置

1. 在 DevEco Studio 中打开项目
2. 选择 "Build" -> "Generate Key and CSR"
3. 填写签名信息
4. 生成签名文件
5. 在 build.gradle 中配置签名信息

#### 2.6.3 发布流程

1. 构建发布版本
2. 进行应用预审
3. 提交到 HarmonyOS 应用商店
4. 等待审核通过
5. 发布应用

### 2.7 安全最佳实践

#### 2.7.1 敏感信息保护

- 使用 ConfigService 的安全存储功能存储敏感信息
- 避免在代码中硬编码 API 密钥、密码等
- 使用环境变量或配置文件管理敏感配置
- 加密存储用户凭证和个人信息

#### 2.7.2 网络安全

- 所有网络请求使用 HTTPS
- 验证服务器证书
- 使用安全的 HTTP 头部设置
- 实现请求超时和重试机制
- 对网络输入进行严格验证

#### 2.7.3 输入验证

- 对所有用户输入进行验证
- 使用 URLValidator 验证 URL 安全性
- 防止 SQL 注入、XSS 等攻击
- 限制输入长度和格式

#### 2.7.4 权限管理

- 只请求必要的权限
- 在使用权限前向用户解释原因
- 实现权限请求的错误处理
- 定期审查权限使用情况

### 2.8 性能优化指南

#### 2.8.1 网络优化

- 实现请求合并和批量操作
- 使用缓存减少网络请求
- 实现智能的网络请求重试机制
- 合理设置请求超时

#### 2.8.2 内存管理

- 使用对象池复用频繁创建的对象
- 及时释放不再使用的资源
- 监控内存使用情况
- 对大数据集使用虚拟列表

#### 2.8.3 渲染优化

- 使用懒加载技术
- 优化图片加载
- 减少 DOM 操作
- 使用 CSS 动画代替 JavaScript 动画

### 2.9 扩展开发

#### 2.9.1 插件系统

RayTV 支持通过插件扩展功能：

1. 在 `src/main/ets/plugin` 目录创建插件目录
2. 实现插件接口
3. 在 `src/main/ets/service/PluginManager.ets` 中注册插件

#### 2.9.2 自定义解析器

1. 创建解析器类，实现 `ParserInterface`
2. 在 `src/main/ets/service/ParserManager.ets` 中注册解析器
3. 配置解析器优先级

#### 2.9.3 自定义数据源

1. 创建数据源类，实现 `DataSourceInterface`
2. 在 `src/main/ets/service/ContentAggregator.ets` 中注册数据源
3. 配置数据源参数

### 2.10 常见开发问题

#### 2.10.1 依赖注入问题

**问题**：服务实例无法获取

**解决方案**：
1. 确保服务已在 `AppService` 中注册
2. 检查服务初始化顺序
3. 使用 `getInstance()` 方法获取单例

#### 2.10.2 网络请求问题

**问题**：网络请求失败

**解决方案**：
1. 检查网络连接
2. 验证 URL 格式
3. 检查 HTTPS 证书
4. 查看错误日志

#### 2.10.3 存储问题

**问题**：数据存储失败

**解决方案**：
1. 检查存储权限
2. 确保存储空间充足
3. 验证存储键名格式
4. 对于敏感信息，使用安全存储

### 2.11 贡献指南

#### 2.11.1 提交 Pull Request

1. Fork 项目仓库
2. 创建功能分支
3. 实现功能或修复bug
4. 运行测试确保通过
5. 提交代码
6. 创建 Pull Request

#### 2.11.2 代码审查

- 确保代码符合规范
- 检查测试覆盖情况
- 验证功能正确性
- 评估性能影响
- 审查安全隐患

#### 2.11.3 发布流程

1. 合并功能到 develop 分支
2. 运行集成测试
3. 构建发布版本
4. 进行质量保证测试
5. 合并到 main 分支
6. 打版本标签

## 3. 最佳实践总结

### 3.1 用户最佳实践

- **网络选择**：在观看高清内容时，优先使用 Wi-Fi 网络
- **存储管理**：定期清理播放历史和缓存，释放存储空间
- **个性化设置**：根据设备性能调整播放器设置，平衡画质和流畅度
- **家长控制**：为儿童使用时，开启家长控制功能
- **反馈问题**：遇到问题时，及时通过应用内反馈功能提交

### 3.2 开发者最佳实践

- **代码组织**：遵循项目结构，保持代码整洁
- **测试驱动**：先编写测试，再实现功能
- **安全优先**：始终考虑安全因素，特别是敏感信息和网络请求
- **性能优化**：关注应用性能，优化关键路径
- **文档更新**：及时更新文档，保持与代码同步
- **团队协作**：遵循分支管理和代码审查流程
- **持续集成**：使用 CI/CD 工具自动化测试和构建

## 4. 版本历史

| 版本 | 日期 | 变更描述 |
|------|------|----------|
| 1.0.0 | 2024-01-01 | 初始版本 |
| 1.1.0 | 2024-02-10 | 添加家长控制功能 |
| 1.2.0 | 2024-03-15 | 增强设备流转功能 |
| 1.3.0 | 2024-04-20 | 添加个性化推荐功能 |

## 5. 联系方式

### 5.1 开发者支持

- **邮箱**：dev@raytv.com
- **GitHub**：https://github.com/raytv/raytv
- **开发者论坛**：https://forum.raytv.com/developer

### 5.2 用户支持

- **邮箱**：support@raytv.com
- **官方网站**：https://www.raytv.com
- **用户论坛**：https://forum.raytv.com/user

---

**文档更新时间**：2024-02-10
**文档版本**：1.3.0