# RayTV - 鸿蒙OS应用移植规划文档

## 1. 项目概述

### 1.1 项目背景
本项目旨在将基于Android的影视播放应用移植到华为Harmony OS 5和Harmony OS 6平台，打造一款支持多设备（直板手机、折叠屏手机、三折叠屏手机、阔折叠屏手机、平板和电视）的纯血鸿蒙应用。

### 1.2 项目目标
- 实现Android版功能的1:1复刻，**注：Android版Fongmi仅作为需求实现的逻辑参考，不作为代码实现的参考**
- 采用纯鸿蒙开发语言和技术栈，完全基于HarmonyOS原生API开发
- 确保在所有支持的鸿蒙设备上提供一致的用户体验
- 优化应用性能，充分利用鸿蒙系统特性

### 1.3 功能范围
- 视频点播(VOD)和直播(Live)播放功能
- 配置文件加载与解析，支持远程JSON配置
- 多源爬虫支持
- 广告屏蔽功能
- 自定义壁纸支持
- 多格式视频源解析
- 播放历史记录管理
- 数据库本地存储与备份恢复
- 电视遥控器操作适配（优先考虑）
- 鸿蒙系统特有功能：
  - 小艺语音助手集成（直接进入应用搜索内容）
  - 跨设备应用流转
  - 手势操作支持（手势抓取投送、碰一碰）
  - 鸿蒙系统动画效果增强

## 2. 技术选型

### 2.1 开发语言
- **主要语言**：ArkTS (HarmonyOS的主要开发语言)
- **辅助语言**：TypeScript

### 2.2 核心技术框架
- **UI框架**：ArkUI (声明式UI框架)
- **多媒体**：MediaPlayer、AVPlayer (HarmonyOS原生媒体播放)
- **数据库**：RelationalStore (HarmonyOS关系型数据库)
- **网络请求**：Fetch API / httpClient、@ohos.net.http (高级网络请求)
- **JSON解析**：内置JSON API、@ohos.data.distributedData (分布式数据管理)
- **跨设备适配**：WindowStage、AbilityContext
- **并发处理**：TaskPool、Worker、WorkScheduler
- **安全沙箱**：@ohos.security.sandbox (应用沙箱)
- **内存管理**：@ohos.memory (内存优化)
- **数据共享**：DataAbility、@ohos.data.resultSet
- **鸿蒙特有功能**：
  - 小艺语音助手：@ohos.ai.speech (语音识别)、@ohos.ai.model (语义理解)
  - 设备流转：@ohos.distributedHardware.deviceManager、@ohos.app.ability.abilityRouter
  - 手势操作：@ohos.multimodalInput.gesture (手势识别)、@ohos.nfc (碰一碰)、@ohos.starflash (星闪)
  - 动画效果：@ohos.animator (属性动画)、@ohos.transition (转场动画)
  - 启动优化：AppStartup API
  - JVM交互：NativeAPI (Java虚拟机交互)

### 2.3 第三方库与技术
- **网络请求**：ohhttpclient (增强版网络请求)
- **图片加载**：第三方图片加载库或自定义实现
- **数据解析**：自定义解析器、Fongmi配置文件解析适配器
- **播放器增强**：基于AVPlayer的自定义播放器
- **脚本运行时**：
  - Java：JVM桥接接口
  - JavaScript：ArkTS引擎
  - Python：HarmonyOS Python运行时
- **任务调度**：WorkScheduler、TaskPool优化调度器

## 3. 项目架构设计

### 3.1 整体架构
```
raytv/
├── common/               # 通用组件和工具
│   ├── constant/         # 常量定义
│   ├── util/             # 工具类
│   ├── widget/           # 自定义组件
│   └── security/         # 安全工具
├── data/                 # 数据层
│   ├── bean/             # 数据模型
│   ├── db/               # 数据库相关
│   ├── distributed/      # 分布式数据管理
│   ├── parser/           # 数据解析器
│   └── source/           # 数据源
├── domain/               # 业务逻辑层
│   ├── repository/       # 数据仓库
│   ├── usecase/          # 用例
│   └── sandbox/          # 沙箱隔离环境
├── presentation/         # 表现层
│   ├── ability/          # 应用能力
│   ├── page/             # 页面
│   ├── viewmodel/        # 视图模型
│   ├── state/            # 状态管理
│   └── harmony/          # 鸿蒙特有UI组件
├── service/              # 服务层
│   ├── player/           # 播放器服务
│   ├── spider/           # 爬虫服务（增强版）
│   │   ├── loader/       # 多语言加载器
│   │   │   ├── jar/      # JAR加载器
│   │   │   ├── js/       # JavaScript加载器
│   │   │   └── py/       # Python加载器
│   │   └── adapter/      # Fongmi配置适配器
│   ├── config/           # 配置服务
│   ├── security/         # 安全服务
│   ├── voice/            # 语音助手服务
│   ├── flow/             # 设备流转服务
│   └── gesture/          # 手势操作服务
├── task/                 # 任务调度
│   ├── scheduler/        # WorkScheduler管理
│   └── pool/             # TaskPool优化
└── App.ets               # 应用入口
```

### 3.2 核心模块设计

#### 3.2.1 应用入口模块
- **App.ets**：RayTV应用生命周期管理，全局配置初始化，鸿蒙服务注册
- **MainAbility.ets**：RayTV主应用能力，处理UI初始化和窗口管理，设备流转支持
- **ServiceManager.ets**：统一服务管理，负责各服务的初始化和生命周期控制

#### 3.2.2 数据层模块
- **数据模型**：
  - Vod.ets：点播内容数据模型（支持@Observed装饰器）
  - Live.ets：直播内容数据模型（支持@Observed装饰器）
  - Site.ets：站点数据模型（支持@Observed装饰器）
  - History.ets：历史记录数据模型
  - Config.ets：配置信息数据模型
  - DeviceInfo.ets：设备信息数据模型（用于流转功能）
- **数据库**：
  - 基于RelationalStore实现本地数据持久化
  - 分布式数据同步支持
  - 异步事务管理
- **分布式数据**：
  - 基于@ohos.data.distributedData实现多设备数据共享
  - 支持播放进度、收藏、历史记录的跨设备同步
- **解析器**：
  - 配置解析：Fongmi配置文件解析适配器
  - 内容解析：多格式内容解析器
  - 视频源解析：支持多格式视频源提取

#### 3.2.3 业务逻辑层
- **配置服务**：
  - 处理配置文件加载、解析和管理
  - 支持远程配置和增量更新
  - 配置缓存机制
- **爬虫服务**：
  - ArkJarLoader：基于ArkCompiler的JAR加载器
  - ArkJsLoader：基于ArkTS引擎的JavaScript加载器
  - ArkPyLoader：基于HarmonyOS Python运行时的Python加载器
  - ConfigAdapter：Fongmi配置文件适配器
  - 爬虫任务调度和管理
  - 沙箱隔离执行环境
- **播放服务**：
  - 基于AVPlayer的播放器管理
  - 播放状态同步
  - 多格式视频源支持
  - 播放历史记录和同步

#### 3.2.4 安全与任务调度
- **安全服务**：
  - 应用沙箱管理
  - 权限控制和验证
  - 网络访问安全监控
  - 代码执行安全审计
- **任务调度**：
  - WorkScheduler管理：后台任务调度
  - TaskPool优化：并行任务处理
  - 任务优先级管理

#### 3.2.5 鸿蒙特有服务
- **语音助手服务**：
  - 小艺语音助手接入
  - 语音命令解析和执行
  - 语音反馈生成
- **设备流转服务**：
  - 设备发现和连接管理
  - 应用状态序列化和恢复
  - 跨设备传输协议
  - 流转状态监控
- **手势操作服务**：
  - 手势识别和处理
  - NFC和星闪技术支持
  - 设备能力检测
  - 手势抓取投送实现

#### 3.2.6 表现层
- **页面组件**：
  - 首页、搜索页、播放页、设置页等
  - 多设备适配布局
- **视图模型**：
  - 管理页面状态和数据交互
  - 支持响应式更新
- **自定义组件**：
  - 播放器控件、壁纸视图等
  - 自定义动画组件
- **遥控器适配**：
  - 焦点管理、按键导航、快捷操作
  - 电视遥控器专用交互优化
- **鸿蒙特有UI组件**：
  - 语音交互组件：语音识别按钮、语音反馈UI
  - 流转控制组件：设备选择器、流转状态指示器
  - 手势操作组件：手势识别区域、反馈动画
  - 鸿蒙动画组件：页面转场、列表动画、加载动画
  - 鸿蒙卡片组件：支持服务卡片

## 3.3 避免重复开发的关键策略

### 3.3.1 架构层面的防重复措施
- **统一的目录结构**：严格遵循规划文档中的目录结构，所有工具类放在`common/util/`，所有服务类按功能分类放在`service/`目录下
- **依赖倒置原则**：高层模块依赖于抽象接口，不依赖于具体实现，减少代码耦合
- **单一职责原则**：每个类只负责一个功能领域，避免功能重叠
- **接口隔离原则**：为客户端提供尽可能小的专用接口，而不是提供大的总接口

### 3.3.2 开发规范与最佳实践
- **命名一致性**：所有类、方法、变量遵循统一的命名规范，提高代码可读性和一致性
- **文档先行**：在实现功能前，先完善设计文档，明确接口定义和功能边界
- **代码复用优先**：优先使用已有的工具类和服务，避免重复开发
- **统一异常处理**：建立全局异常处理机制，避免在每个模块中重复实现异常处理逻辑
- **统一的日志系统**：使用集中式日志系统，避免每个模块单独实现日志功能

### 3.3.3 重复代码识别与重构
- **定期代码审查**：团队成员之间进行交叉代码审查，识别潜在的重复代码
- **静态代码分析**：使用代码分析工具检测重复代码和代码异味
- **渐进式重构**：识别到重复代码后，采用渐进式重构策略，确保功能稳定的同时优化代码结构
- **模块化改造**：将重复的功能抽取为独立的模块或服务，供其他组件复用

## 4. 详细移植计划

**重要提示**：在整个移植过程中，Android版Fongmi仅作为需求实现的逻辑参考，不作为代码实现的参考。所有功能模块将完全基于HarmonyOS原生API和技术栈进行设计和实现，充分利用鸿蒙系统的特性和优势。
Fongmi是Fongmi，RayTV是RayTV，开始移植就不再有继承关系

### 4.1 准备阶段

#### 4.1.1 开发环境搭建
- 安装DevEco Studio最新版本
- 配置HarmonyOS SDK (API 9及以上)
- 创建RayTV项目并配置基本信息
- 配置多设备兼容性支持

#### 4.1.2 项目结构创建
- 按照优化后的架构设计创建目录结构
- 配置项目依赖和资源文件
- 设置多设备适配配置
- 初始化Git版本控制

#### 4.1.3 技术栈熟悉与调研
- HarmonyOS API 9+特性学习
- NativeAPI与JVM交互机制研究
- 沙箱隔离技术调研
- WorkScheduler和TaskPool最佳实践学习

### 4.2 基础框架构建

#### 4.2.1 应用入口与生命周期
- 实现App.ets：全局配置和服务注册
- 开发MainAbility.ets：窗口管理和设备流转支持
- 创建ServiceManager.ets：统一服务生命周期管理

#### 4.2.2 数据模型层

**数据模型转换**：
- 将Android Java Bean转换为HarmonyOS数据类
- 使用@Observed装饰器实现可观察数据
- 添加序列化和反序列化支持

**主要数据模型**：
- Vod.ets：点播内容数据模型
- Live.ets：直播内容数据模型
- Site.ets：站点数据模型
- History.ets：历史记录数据模型
- Config.ets：配置信息数据模型
- DeviceInfo.ets：设备信息数据模型

**实现细节**：
- 使用@Observed装饰器实现可观察数据类
- 包含完整的字段定义和序列化方法
- 支持分布式数据同步

#### 4.2.3 数据库层

**数据库设计**：
- 使用RelationalStore替代Room
- 定义数据表结构和索引
- 实现数据访问接口

**主要数据表**：
- site：存储站点信息
- live：存储直播源信息
- history：存储播放历史
- keep：存储收藏信息
- config：存储配置信息
- device：存储设备信息（用于流转）

**实现细节**：
- 采用单例模式管理数据库连接
- 实现异步初始化和事务管理
- 提供统一的数据访问接口
- 实现数据库迁移和升级机制

#### 4.2.4 分布式数据管理
- 集成@ohos.data.distributedData模块
- 实现多设备数据同步机制
- 开发数据冲突解决策略
- 支持播放进度、收藏、历史记录的跨设备同步

### 4.3 核心服务实现

#### 4.3.1 配置服务
- 实现配置文件加载和解析
- 开发Fongmi配置文件适配器
- 实现配置缓存和增量更新机制
- 添加远程配置安全下载和验证

#### 4.3.2 播放器服务
- 基于AVPlayer实现播放器管理
- 开发播放控制和状态管理
- 实现多格式视频源支持
- 优化播放缓存策略
- 集成硬件解码加速

#### 4.3.3 爬虫服务增强

**基础架构**：
- 开发BaseLoader.ets：爬虫加载基类
- 设计爬虫实例管理机制
- 实现爬虫结果缓存

**JAR加载器实现**：
- 基于NativeAPI实现JVM桥接
- 开发ArkJarLoader.ets：JAR文件动态加载
- 实现类加载器隔离机制
- 支持JAR爬虫实例化和方法调用

**JavaScript加载器**：
- 开发ArkJsLoader.ets：基于ArkTS引擎
- 实现JavaScript爬虫安全执行环境
- 提供JS与ArkTS交互接口

**Python加载器**：
- 开发ArkPyLoader.ets：基于HarmonyOS Python运行时
- 实现Python爬虫调用接口
- 支持Python依赖管理

**配置适配器**：
- 开发ConfigAdapter.ets：Fongmi配置文件适配器
- 实现配置格式无损解析
- 支持动态爬虫配置更新

**安全沙箱**：
- 实现爬虫代码隔离执行环境
- 开发网络访问权限控制
- 添加爬虫行为监控和异常拦截

### 4.4 任务调度与安全管理

#### 4.4.1 任务调度系统
- 集成WorkScheduler实现后台任务调度
- 优化TaskPool实现并行任务处理
- 开发任务优先级管理机制
- 实现智能预加载策略

#### 4.4.2 安全服务
- 实现应用沙箱管理
- 开发权限控制和验证机制
- 添加网络访问安全监控
- 实现代码执行安全审计

### 4.5 鸿蒙特有功能实现

#### 4.5.1 语音助手服务
- 集成小艺语音助手API
- 开发语音命令解析和执行
- 实现语音反馈生成
- 添加自定义语音命令支持

#### 4.5.2 设备流转服务
- 集成分布式硬件设备管理API
- 实现设备发现和连接管理
- 开发应用状态序列化和恢复机制
- 添加跨设备传输协议
- 实现流转状态监控和反馈

#### 4.5.3 手势操作服务
- 集成手势识别API
- 实现NFC和星闪技术支持
- 开发设备能力检测逻辑
- 实现手势抓取投送功能
- 添加可视化反馈机制

### 4.6 UI实现与适配

#### 4.6.1 基础页面开发
- 实现首页、搜索页、播放页、设置页等核心页面
- 开发页面路由和导航
- 添加页面状态管理

#### 4.6.2 自定义组件
- 开发播放器控件
- 实现壁纸视图
- 添加自定义动画组件
- 开发鸿蒙卡片组件

#### 4.6.3 多设备适配
- 实现电视、平板、手机多设备布局适配
- 优化电视遥控器交互
- 开发焦点管理和按键导航
- 添加快捷操作支持

#### 4.6.4 鸿蒙特有UI组件
- 开发语音交互组件
- 实现流转控制组件
- 添加手势操作组件
- 开发鸿蒙动画组件

### 4.7 测试与优化

#### 4.7.1 单元测试
- 开发核心功能单元测试用例
- 实现数据模型和解析器测试
- 添加服务层测试

#### 4.7.2 集成测试
- 开发模块间交互测试
- 实现端到端流程测试
- 添加爬虫功能集成测试

#### 4.7.3 性能优化
- 内存管理优化
- 启动优化
- 播放优化
- 爬虫性能优化

#### 4.7.4 兼容性测试
- 在不同尺寸设备上测试适配效果
- 在HarmonyOS 5和HarmonyOS 6上测试兼容性
- 测试不同JAR、JavaScript、Python爬虫的兼容性



**功能实现**：
- 远程配置文件下载和解析
- 配置内容缓存和管理
- 支持多格式配置文件

**核心类**：
- ConfigLoader.ets：配置加载器
- ConfigParser.ets：配置解析器
- LiveConfig.ets：直播配置处理
- VodConfig.ets：点播配置处理
- WallConfig.ets：壁纸配置处理

**实现细节**：
- 异步下载和解析配置文件
- 实现错误处理和重试机制
- 支持配置缓存管理

#### 4.2.4 爬虫功能模块

**功能实现**：
- 基于纯血鸿蒙技术的爬虫模块加载机制
- 爬虫实例管理和安全沙箱隔离
- 高效内容爬取和解析
- 完全兼容Fongmi网络配置文件

**重要提示**：Android版Fongmi仅作为需求实现的逻辑参考，不作为代码实现的参考。所有爬虫相关功能将完全基于HarmonyOS原生技术实现，包括JVM交互、沙箱隔离、任务调度等。

**核心类**：
- BaseLoader.ets：爬虫加载基类（定义统一接口）
- ArkJarLoader.ets：基于ArkCompiler的JAR加载器
- ArkJsLoader.ets：基于ArkTS引擎的JavaScript加载器
- ArkPyLoader.ets：基于HarmonyOS Python运行时的Python加载器
- SpiderManager.ets：爬虫管理器（统一调度和生命周期管理）
- ConfigAdapter.ets：Fongmi配置文件适配器

**实现细节**：

1. **JAR模块加载增强**：
   - 使用HarmonyOS的NativeAPI接口与JVM进行交互
   - 实现JAR文件的动态加载和类实例化
   - 利用TaskPool实现爬虫任务的并行执行
   - 支持类加载器隔离，提高安全性

2. **配置文件完全兼容**：
   - 实现Fongmi网络配置文件格式的无损解析
   - 支持远程配置文件的安全下载和验证
   - 提供配置缓存和增量更新机制

3. **鸿蒙特有优化**：
   - 利用HarmonyOS的网络请求优化机制
   - 集成网络连接状态监听，实现智能重试
   - 使用DataAbility实现爬虫数据的安全共享
   - 支持分布式爬虫任务调度

4. **性能提升**：
   - 实现爬虫结果缓存机制
   - 利用WorkScheduler实现后台预加载
   - 使用内存管理API优化大内存使用场景
   - 支持爬虫任务优先级调度

5. **安全机制**：
   - 实现爬虫代码沙箱隔离
   - 提供网络访问权限控制
   - 支持爬虫行为监控和异常拦截
   - 实现动态权限申请和验证
```

#### 4.2.5 视频播放模块

**功能实现**：
- 基于AVPlayer的视频播放
- 播放控制和状态管理
- 多格式视频源支持
- 视频源解析和处理

**核心类**：
- PlayerManager.ets：播放器管理器
- VideoPlayer.ets：自定义播放器组件
- SourceManager.ets：视频源管理器
- VideoExtractor.ets：视频提取器基类

**实现细节**：
- 基于AVPlayer实现视频播放控制
- 支持播放状态监听和事件回调
- 实现播放源管理和格式适配

#### 4.2.6 广告屏蔽模块

**功能实现**：
- 广告规则加载和管理
- URL拦截和过滤
- 广告内容识别

**核心类**：
- AdBlockManager.ets：广告屏蔽管理器
- AdRule.ets：广告规则模型
- UrlFilter.ets：URL过滤器

**实现细节**：
- 广告规则加载和缓存管理
- URL模式匹配和过滤
- 规则更新和优化机制

#### 4.2.7 壁纸功能模块

**功能实现**：
- 壁纸加载和缓存
- 壁纸类型识别（图片、GIF、视频）
- 壁纸显示和管理

**核心类**：
- WallManager.ets：壁纸管理器
- WallView.ets：自定义壁纸视图
- WallTypeDetector.ets：壁纸类型检测器

**实现细节**：
- 壁纸资源加载和缓存管理
- 支持多种壁纸类型（图片、GIF、视频）
- 壁纸应用和显示控制
```

### 4.3 UI界面移植

#### 4.3.0 电视界面与遥控器操作适配

#### 4.3.0.1 鸿蒙特有功能实现

**1. 小艺语音助手集成**

**功能说明**：
- 支持通过小艺语音助手直接进入RayTV并搜索内容
- 支持语音控制播放、暂停、下一集等操作
- 支持语音切换分类、查看历史等功能

**实现方案**：
- 注册语音意图处理：配置语音技能和意图
- 实现语音识别和语义理解
- 建立语音命令到应用功能的映射关系

**核心实现要点**：
- 初始化语音识别服务和语义理解处理器
- 实现语音命令的识别和解析
- 建立语音意图到应用功能的映射关系
- 提供语音识别控制接口（开始、停止）
- 处理语音服务初始化和命令执行的异常情况

**2. 设备流转功能**

**功能说明**：
- 支持RayTV应用在不同HarmonyOS设备间无缝流转
- 支持视频播放状态、进度等信息的同步
- 提供流转控制和设备选择界面

**实现方案**：
- 集成HarmonyOS分布式能力
- 实现设备发现和连接管理
- 开发应用状态序列化和恢复机制

**核心实现要点**：
- 初始化设备管理器获取分布式设备能力
- 实现可用设备列表获取功能
- 提供应用状态序列化和流转启动接口
- 支持从流转参数恢复应用状态
- 处理设备管理和应用流转过程中的异常情况

**3. 手势操作支持**

**功能说明**：
- 支持手势抓取投送实现程序的跨设备流转，用户通过手势操作将当前应用状态（包括播放进度、当前页面、用户配置等）无缝迁移到目标设备
- 支持NFC和星闪技术的碰一碰快速传输内容
- 支持特定手势控制播放行为
- 支持跨设备播放连续性，确保用户在不同设备间切换时观看体验无中断
- 支持流转过程中的可视化反馈，显示流转进度和状态
- 支持多设备间的智能设备发现和选择

**实现方案**：
- 集成HarmonyOS手势识别API，实现抓取、拖拽、释放等复杂手势识别
- 开发NFC和星闪数据交换功能
- 根据设备能力自动选择合适的传输技术
- 实现手势动作到应用功能的映射
- 设计应用状态序列化机制，支持播放进度、当前页面、用户配置等关键信息的完整保存和恢复
- 实现设备发现和连接管理，支持在手势操作过程中智能识别附近可用设备
- 开发跨设备数据传输协议，确保应用状态信息的高效安全传输
- 实现流转过程中的用户界面反馈机制，提供清晰的视觉引导
- 设计断点续播和状态同步机制，确保用户体验连续性
- 支持流转权限管理和用户确认机制，保护数据安全

**核心实现要点**：
- 集成@ohos.multimodalInput.gesture实现手势识别，支持抓取和投送手势
- 支持NFC和星闪技术的近场通信功能
- 实现设备能力检测，自动选择合适的通信技术
- 设计应用状态序列化机制，保存当前播放内容、进度和配置
- 提供手势操作的视觉反馈系统
- 实现设备选择和内容流转功能
- 支持流转权限管理和用户确认机制

**4. 鸿蒙系统动画效果**

**功能说明**：
- 使用HarmonyOS原生动画API增强用户界面交互
- 实现页面转场动画、组件动画等效果
- 优化动画性能，确保流畅体验

**实现方案**：
- 使用属性动画实现元素变换
- 开发转场动画增强页面切换体验
- 实现基于物理模型的动画效果

**核心实现要点**：
- 使用@ohos.animator创建流畅的属性动画
- 提供页面入场、退场动画配置
- 实现焦点缩放动画增强用户交互体验
- 创建循环加载动画提升视觉反馈
- 支持在组件中集成动画效果
- 实现转场动画增强页面切换体验
```

**设计原则**：
- 优先考虑电视大屏显示效果
- 确保遥控器操作的流畅性和准确性
- 保持与Android版(Fongmi)界面和操作逻辑的一致性
- 提供清晰的焦点状态和视觉反馈

**遥控器适配核心功能**：
- 焦点管理系统：实现全局焦点控制和状态管理
- 按键映射：自定义遥控器按键功能和快捷键
- 自动聚焦：进入页面时自动设置初始焦点
- 焦点联动：多列表间焦点联动和跳转逻辑
- 视觉反馈：明确的选中状态和动画效果

**实现策略**：
1. 使用ArkUI的焦点管理API实现遥控器导航
2. 采用网格布局优化大屏显示效果
3. 增加焦点移动动效提升用户体验
4. 确保所有可操作元素支持键盘导航
5. 为常用功能添加快捷操作支持

#### 4.3.1 页面结构设计

**主要页面**：
- MainPage.ets：首页
- SearchPage.ets：搜索页
- DetailPage.ets：详情页
- PlayPage.ets：播放页
- SettingPage.ets：设置页
- LivePage.ets：直播页

**页面路由配置**：配置应用内各页面的路由映射，支持页面跳转和参数传递

#### 4.3.2 自定义组件开发

**关键组件**：
- CustomPlayer.ets：自定义播放器组件（支持遥控器控制）
- VideoList.ets：视频列表组件（支持焦点导航）
- CategoryBar.ets：分类栏组件（横向滚动导航）
- SearchBox.ets：搜索框组件（支持遥控器输入）
- WallView.ets：壁纸视图组件
- FocusManager.ets：焦点管理组件
- RemoteKeyHandler.ets：遥控器按键处理组件

**核心实现要点**：
- 实现视频列表组件，支持数据绑定和点击事件处理
- 使用List组件展示视频数据
- 提供item点击回调接口
- 支持布局权重自适应

#### 4.3.3 多设备适配实现

**适配策略**：
- 使用Flexbox和GridLayout实现响应式布局
- 利用@ohos.screen接口获取屏幕信息
- 针对不同屏幕尺寸设置不同的布局参数
- 针对电视设备优化焦点移动速度和灵敏度
- 为不同设备类型提供定制的交互模式

**核心实现要点**：
- 使用响应式布局设计，根据屏幕尺寸自动调整布局方向
- 实现设备类型检测，针对电视设备优化交互体验
- 提供焦点管理组件，支持焦点状态变化和视觉反馈
- 实现按键事件处理，支持遥控器导航
- 添加过渡动画增强用户交互体验

### 4.4 测试与优化阶段

#### 4.4.1 功能测试
- 单元测试：核心功能模块测试
- 集成测试：模块间交互测试
- UI测试：界面功能和显示测试

#### 4.4.2 性能优化
- **内存管理**：
  - 利用HarmonyOS内存管理API实现精准内存控制
  - 通过资源池和对象复用减少内存分配
  - 集成内存泄漏自动检测机制
- **启动优化**：
  - 使用AppStartup优化启动流程
  - 实现延迟加载和预加载策略
  - 利用鸿蒙启动器优化机制提升冷启动速度
- **播放优化**：
  - 基于AVPlayer缓存优化提升播放流畅度
  - 使用硬件解码加速提升视频处理性能
  - 实现智能缓冲策略适应网络波动
- **爬虫性能优化**：
  - 利用TaskPool实现并行爬虫任务处理
  - 通过WorkScheduler实现后台预加载
  - 使用网络请求优化和缓存机制减少重复请求
  - 实现爬虫结果增量更新机制

#### 4.4.3 兼容性测试
- 在不同尺寸设备上测试适配效果
- 在HarmonyOS 5和HarmonyOS 6上测试兼容性

## 5. 具体实现时间线

| 阶段 | 任务 | 时间估计 |
|------|------|----------|
| 准备阶段 | 环境搭建、项目结构创建、鸿蒙API熟悉 | 5天 |
| 数据层 | 数据模型转换、数据库实现、分布式数据管理 | 7天 |
| 核心服务 | 配置加载、播放器适配 | 5天 |
| 爬虫功能增强 | 爬虫基类设计、JAR加载器实现、配置适配器开发 | 12天 |
| 鸿蒙特有功能 | 小艺语音、设备流转、手势操作、安全沙箱实现 | 10天 |
| UI实现 | 页面开发、组件实现、多设备适配 | 15天 |
| 性能优化 | TaskPool优化、WorkScheduler集成、内存管理优化 | 7天 |
| 集成测试 | 功能测试、兼容性测试、爬虫性能测试 | 10天 |
| 最终优化 | Bug修复、用户体验提升、安全加固 | 5天 |

## 6. 关键技术难点及解决方案

### 6.1 爬虫功能迁移与增强
- **难点**：
  - Android的JAR动态加载机制与HarmonyOS不兼容
  - 需要完全支持Fongmi的网络配置文件格式和功能
  - 爬虫执行的安全性和性能问题
  - 多种脚本语言运行时环境的集成
- **解决方案**：
  - 基于HarmonyOS NativeAPI实现JVM桥接，支持JAR文件直接加载
  - 开发专用的ConfigAdapter.ets实现Fongmi配置文件的无损解析和适配
  - 利用TaskPool实现爬虫任务的安全隔离和并行执行
  - 采用WorkScheduler实现爬虫任务的智能调度和后台预加载
  - 实现基于沙箱的爬虫代码隔离执行环境
  - 集成HarmonyOS网络优化机制，提供智能重试和缓存策略
  - 使用DataAbility实现跨模块爬虫数据安全共享

### 6.2 播放器适配
- **难点**：Android播放器API与HarmonyOS差异较大
- **解决方案**：
  - 封装AVPlayer实现统一的播放接口
  - 实现自定义播放控制组件
  - 优化播放缓冲策略

### 6.3 多设备适配与鸿蒙特有功能
- **难点**：
  - 需要支持多种屏幕尺寸和设备类型，尤其是电视遥控器操作适配
  - 实现小艺语音助手、设备流转、手势操作等鸿蒙特有功能
  - 确保动画效果在不同设备上的一致性和性能
- **解决方案**：
  - 采用响应式布局设计
  - 利用条件渲染实现设备特定UI
  - 动态调整组件大小和布局
  - 实现统一的焦点管理系统
  - 为电视设备优化操作流程和交互体验
  - 保持与Android版(Fongmi)操作逻辑的一致性
  - 使用HarmonyOS提供的分布式能力API实现设备间通信
  - 实现语音命令与应用功能的映射关系
  - 采用设备能力检测，根据设备特性调整动画效果

## 7. 注意事项

### 7.1 HarmonyOS特有功能利用
- 利用AbilityStage实现应用级配置管理
- 使用WantAgent实现跨应用通信
- 采用DataAbility实现数据共享
- 集成小艺语音助手实现语音控制
- 使用分布式能力实现设备流转
- 利用手势识别API实现高级交互
- 使用动画API增强用户体验

### 7.2 性能优化建议
- 使用懒加载和虚拟列表处理大量数据
- 优化图片加载和缓存策略
- 减少主线程阻塞操作
- 优化电视设备上的焦点移动响应速度
- 减少动画效果对电视设备性能的影响

### 7.3 安全性考虑
- 实现安全的网络请求和数据存储
- 防止恶意配置文件和爬虫代码
- 保护用户隐私数据

### 7.4 电视遥控器操作最佳实践
- 保持焦点移动的逻辑性和可预测性
- 为所有可操作元素提供足够大的焦点区域
- 确保焦点状态有明显的视觉区分
- 支持常用功能的快捷键操作
- 优化列表滚动性能和导航体验
- 最小化遥控器操作步骤，提供便捷的功能访问方式
- 严格遵循Android版(Fongmi)的界面布局和操作逻辑，确保用户体验一致性

## 8.### 8. 成果交付物

1. RayTV鸿蒙应用源代码
2. 应用安装包(.app/.hap)
3. 应用功能测试报告
4. 应用性能测试报告
5. 技术文档和使用说明
6. 鸿蒙特有功能实现文档
7. 语音交互测试用例集
8. 设备流转兼容性测试报告

---

本文档提供了RayTV应用从Android到HarmonyOS的详细移植规划，并增加了鸿蒙特有功能的实现方案。在实际开发过程中，可能需要根据具体情况进行调整和优化。本规划旨在指导开发团队有序、高效地完成移植工作，并充分利用HarmonyOS特有的功能，提升用户体验，确保最终产品质量和用户体验。

---

本文档提供了RayTV应用从Android到HarmonyOS的详细移植规划。在实际开发过程中，可能需要根据具体情况进行调整和优化。本规划旨在指导开发团队有序、高效地完成移植工作，确保最终产品质量和用户体验。